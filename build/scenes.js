/**
 * dat-gui JavaScript Controller Library
 * http://code.google.com/p/dat-gui
 *
 * Copyright 2011 Data Arts Team, Google Creative Lab
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */

/** @license
 * RequireJS Image Plugin
 * Author: Miller Medeiros
 * Version: 0.2.2 (2013/02/08)
 * Released under the MIT license
 */

(function(){var e=e||{REVISION:"58"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},e.extend=function(e,t){if(Object.keys)for(var n=Object.keys(t),r=0,i=n.length;r<i;r++){var s=n[r];Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}else for(s in n={}.hasOwnProperty,t)n.call(t,s)&&(e[s]=t[s]);return e},function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.NoShading=0,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.UVMapping=function(){},e.CubeReflectionMapping=function(){},e.CubeRefractionMapping=function(){},e.SphericalReflectionMapping=function(){},e.SphericalRefractionMapping=function(){},e.RepeatWrapping=1e3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.UnsignedShort4444Type=1016,e.UnsignedShort5551Type=1017,e.UnsignedShort565Type=1018,e.AlphaFormat=1019,e.RGBFormat=1020,e.RGBAFormat=1021,e.LuminanceFormat=1022,e.LuminanceAlphaFormat=1023,e.RGB_S3TC_DXT1_Format=2001,e.RGBA_S3TC_DXT1_Format=2002,e.RGBA_S3TC_DXT3_Format=2003,e.RGBA_S3TC_DXT5_Format=2004,e.Color=function(e){return void 0!==e&&this.set(e),this},e.Color.prototype={constructor:e.Color,r:1,g:1,b:1,set:function(t){return t instanceof e.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(0===t)this.r=this.g=this.b=n;else{var r=function(e,t,n){return 0>n&&(n+=1),1<n&&(n-=1),n<1/6?e+6*(t-e)*n:.5>n?t:n<2/3?e+6*(t-e)*(2/3-n):e},t=.5>=n?n*(1+t):n+t-n*t,n=2*n-t;this.r=r(n,t,e+1/3),this.g=r(n,t,e),this.b=r(n,t,e-1/3)}return this},setStyle:function(t){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(t))return t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(t),this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this;if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(t))return t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(t),this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this;if(/^\#([0-9a-f]{6})$/i.test(t))return t=/^\#([0-9a-f]{6})$/i.exec(t),this.setHex(parseInt(t[1],16)),this;if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t))return t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t),this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this;if(/^(\w+)$/i.test(t))return this.setHex(e.ColorKeywords[t]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var e={h:0,s:0,l:0};return function(){var t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),s=Math.min(t,n,r),o,u=(s+i)/2;if(s===i)s=o=0;else{var f=i-s,s=.5>=u?f/(i+s):f/(2-i-s);switch(i){case t:o=(n-r)/f+(n<r?6:0);break;case n:o=(r-t)/f+2;break;case r:o=(t-n)/f+4}o/=6}return e.h=o,e.s=s,e.l=u,e}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},clone:function(){return(new e.Color).setRGB(this.r,this.g,this.b)}},e.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},e.Quaternion=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},e.Quaternion.prototype={constructor:e.Quaternion,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var n=Math.cos(e.x/2),r=Math.cos(e.y/2),i=Math.cos(e.z/2),s=Math.sin(e.x/2),o=Math.sin(e.y/2),u=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=s*r*i+n*o*u,this.y=n*o*i-s*r*u,this.z=n*r*u+s*o*i,this.w=n*r*i-s*o*u):"YXZ"===t?(this.x=s*r*i+n*o*u,this.y=n*o*i-s*r*u,this.z=n*r*u-s*o*i,this.w=n*r*i+s*o*u):"ZXY"===t?(this.x=s*r*i-n*o*u,this.y=n*o*i+s*r*u,this.z=n*r*u+s*o*i,this.w=n*r*i-s*o*u):"ZYX"===t?(this.x=s*r*i-n*o*u,this.y=n*o*i+s*r*u,this.z=n*r*u-s*o*i,this.w=n*r*i+s*o*u):"YZX"===t?(this.x=s*r*i+n*o*u,this.y=n*o*i+s*r*u,this.z=n*r*u-s*o*i,this.w=n*r*i-s*o*u):"XZY"===t&&(this.x=s*r*i-n*o*u,this.y=n*o*i-s*r*u,this.z=n*r*u+s*o*i,this.w=n*r*i+s*o*u),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0],e=t[4],r=t[8],i=t[1],s=t[5],o=t[9],u=t[2],a=t[6],t=t[10],f=n+s+t;return 0<f?(n=.5/Math.sqrt(f+1),this.w=.25/n,this.x=(a-o)*n,this.y=(r-u)*n,this.z=(i-e)*n):n>s&&n>t?(n=2*Math.sqrt(1+n-s-t),this.w=(a-o)/n,this.x=.25*n,this.y=(e+i)/n,this.z=(r+u)/n):s>t?(n=2*Math.sqrt(1+s-n-t),this.w=(r-u)/n,this.x=(e+i)/n,this.y=.25*n,this.z=(o+a)/n):(n=2*Math.sqrt(1+t-n-s),this.w=(i-e)/n,this.x=(r+u)/n,this.y=(o+a)/n,this.z=.25*n),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.z=this.y=this.x=0,this.w=1):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e.x,r=e.y,i=e.z,s=e.w,o=t.x,u=t.y,a=t.z,f=t.w;return this.x=n*f+s*o+r*a-i*u,this.y=r*f+s*u+i*o-n*a,this.z=i*f+s*a+n*u-r*o,this.w=s*f-n*o-r*u-i*a,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var n=this.x,r=this.y,i=this.z,s=this.w,o=s*e.w+n*e.x+r*e.y+i*e.z;0>o?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e);if(1<=o)return this.w=s,this.x=n,this.y=r,this.z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);return.001>Math.abs(a)?(this.w=.5*(s+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this):(o=Math.sin((1-t)*u)/a,u=Math.sin(t*u)/a,this.w=s*o+this.w*u,this.x=n*o+this.x*u,this.y=r*o+this.y*u,this.z=i*o+this.z*u,this)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new e.Quaternion(this.x,this.y,this.z,this.w)}},e.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)},e.Vector2=function(e,t){this.x=e||0,this.y=t||0},e.Vector2.prototype={constructor:e.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new e.Vector2(this.x,this.y)}},e.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},e.Vector3.prototype={constructor:e.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6]*r,this.y=e[1]*t+e[4]*n+e[7]*r,this.z=e[2]*t+e[5]*n+e[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r+e[12],this.y=e[1]*t+e[5]*n+e[9]*r+e[13],this.z=e[2]*t+e[6]*n+e[10]*r+e[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements,i=1/(e[3]*t+e[7]*n+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*r+e[12])*i,this.y=(e[1]*t+e[5]*n+e[9]*r+e[13])*i,this.z=(e[2]*t+e[6]*n+e[10]*r+e[14])*i,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z,e=e.w,u=e*t+s*r-o*n,a=e*n+o*t-i*r,f=e*r+i*n-s*t,t=-i*t-s*n-o*r;return this.x=u*e+t*-i+a*-o-f*-s,this.y=a*e+t*-s+f*-i-u*-o,this.z=f*e+t*-o+u*-s-a*-i,this},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r,this.y=e[1]*t+e[5]*n+e[9]*r,this.z=e[2]*t+e[6]*n+e[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):this.z=this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(t){return t=this.dot(t)/(this.length()*t.length()),Math.acos(e.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,e=this.z-e.z;return t*t+n*n+e*e},setEulerFromRotationMatrix:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,i=r[0],s=r[4],o=r[8],u=r[1],a=r[5],f=r[9],l=r[2],c=r[6],r=r[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(n(o)),.99999>Math.abs(o)?(this.x=Math.atan2(-f,r),this.z=Math.atan2(-s,i)):(this.x=Math.atan2(c,a),this.z=0)):"YXZ"===t?(this.x=Math.asin(-n(f)),.99999>Math.abs(f)?(this.y=Math.atan2(o,r),this.z=Math.atan2(u,a)):(this.y=Math.atan2(-l,i),this.z=0)):"ZXY"===t?(this.x=Math.asin(n(c)),.99999>Math.abs(c)?(this.y=Math.atan2(-l,r),this.z=Math.atan2(-s,a)):(this.y=0,this.z=Math.atan2(u,i))):"ZYX"===t?(this.y=Math.asin(-n(l)),.99999>Math.abs(l)?(this.x=Math.atan2(c,r),this.z=Math.atan2(u,i)):(this.x=0,this.z=Math.atan2(-s,a))):"YZX"===t?(this.z=Math.asin(n(u)),.99999>Math.abs(u)?(this.x=Math.atan2(-f,a),this.y=Math.atan2(-l,i)):(this.x=0,this.y=Math.atan2(o,r))):"XZY"===t&&(this.z=Math.asin(-n(s)),.99999>Math.abs(s)?(this.x=Math.atan2(c,a),this.y=Math.atan2(o,i)):(this.x=Math.atan2(-f,r),this.y=0)),this},setEulerFromQuaternion:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,i=e.y*e.y,s=e.z*e.z,o=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),o-r-i+s),this.y=Math.asin(n(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o+r-i-s)):"YXZ"===t?(this.x=Math.asin(n(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o-r-i+s),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o-r+i-s)):"ZXY"===t?(this.x=Math.asin(n(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),o-r-i+s),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o-r+i-s)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),o-r-i+s),this.y=Math.asin(n(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o+r-i-s)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),o-r+i-s),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),o+r-i-s),this.z=Math.asin(n(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),o-r+i-s),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o+r-i-s),this.z=Math.asin(n(2*(e.z*e.w-e.x*e.y)))),this},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=e,this},getColumnFromMatrix:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new e.Vector3(this.x,this.y,this.z)}},e.extend(e.Vector3.prototype,{applyEuler:function(){var t=new e.Quaternion;return function(e,n){var r=t.setFromEuler(e,n);return this.applyQuaternion(r),this}}(),applyAxisAngle:function(){var t=new e.Quaternion;return function(e,n){var r=t.setFromAxisAngle(e,n);return this.applyQuaternion(r),this}}(),projectOnVector:function(){var t=new e.Vector3;return function(e){return t.copy(e).normalize(),e=this.dot(t),this.copy(t).multiplyScalar(e)}}(),projectOnPlane:function(){var t=new e.Vector3;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new e.Vector3;return function(e){return t.copy(this).projectOnVector(e).multiplyScalar(2),this.subVectors(t,this)}}()}),e.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},e.Vector4.prototype={constructor:e.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r+e[12]*i,this.y=e[1]*t+e[5]*n+e[9]*r+e[13]*i,this.z=e[2]*t+e[6]*n+e[10]*r+e[14]*i,this.w=e[3]*t+e[7]*n+e[11]*r+e[15]*i,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,e=e.elements,i=e[0];r=e[4];var s=e[8],o=e[1],u=e[5],a=e[9];n=e[2],t=e[6];var f=e[10];return.01>Math.abs(r-o)&&.01>Math.abs(s-n)&&.01>Math.abs(a-t)?.1>Math.abs(r+o)&&.1>Math.abs(s+n)&&.1>Math.abs(a+t)&&.1>Math.abs(i+u+f-3)?(this.set(1,0,0,0),this):(e=Math.PI,i=(i+1)/2,u=(u+1)/2,f=(f+1)/2,r=(r+o)/4,s=(s+n)/4,a=(a+t)/4,i>u&&i>f?.01>i?(t=0,r=n=.707106781):(t=Math.sqrt(i),n=r/t,r=s/t):u>f?.01>u?(t=.707106781,n=0,r=.707106781):(n=Math.sqrt(u),t=r/n,r=a/n):.01>f?(n=t=.707106781,r=0):(r=Math.sqrt(f),t=s/r,n=a/r),this.set(t,n,r,e),this):(e=Math.sqrt((t-a)*(t-a)+(s-n)*(s-n)+(o-r)*(o-r)),.001>Math.abs(e)&&(e=1),this.x=(t-a)/e,this.y=(s-n)/e,this.z=(o-r)/e,this.w=Math.acos((i+u+f-1)/2),this)},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new e.Vector4(this.x,this.y,this.z,this.w)}},e.Line3=function(t,n){this.start=void 0!==t?t:new e.Vector3,this.end=void 0!==n?n:new e.Vector3},e.Line3.prototype={constructor:e.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(t){return(t||new e.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new e.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,n){var r=n||new e.Vector3;return this.delta(r).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new e.Vector3,n=new e.Vector3;return function(r,i){t.subVectors(r,this.start),n.subVectors(this.end,this.start);var s=n.dot(n),s=n.dot(t)/s;return i&&(s=e.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(t,n,r){return t=this.closestPointToPointParameter(t,n),r=r||new e.Vector3,this.delta(r).multiplyScalar(t).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new e.Line3).copy(this)}},e.Box2=function(t,n){this.min=void 0!==t?t:new e.Vector2(Infinity,Infinity),this.max=void 0!==n?n:new e.Vector2(-Infinity,-Infinity)},e.Box2.prototype={constructor:e.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)t=e[n],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new e.Vector2;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){return(t||new e.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new e.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(t){return new e.Vector2((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(t,n){return(n||new e.Vector2).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new e.Vector2;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new e.Box2).copy(this)}},e.Box3=function(t,n){this.min=void 0!==t?t:new e.Vector3(Infinity,Infinity,Infinity),this.max=void 0!==n?n:new e.Vector3(-Infinity,-Infinity,-Infinity)},e.Box3.prototype={constructor:e.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)t=e[n],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new e.Vector3;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new e.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new e.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(t){return new e.Vector3((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(t,n){return(n||new e.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new e.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new e.Vector3;return function(n){return n=n||new e.Sphere,n.center=this.center(),n.radius=.5*this.size(t).length(),n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var t=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new e.Box3).copy(this)}},e.Matrix3=function(e,t,n,r,i,s,o,u,a){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,n||0,r||0,void 0!==i?i:1,s||0,o||0,u||0,void 0!==a?a:1)},e.Matrix3.prototype={constructor:e.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var t=new e.Vector3;return function(e){for(var n=0,r=e.length;n<r;n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],t.applyMatrix3(this),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],e=e[8];return t*s*e-t*o*a-n*i*e+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4],n=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(0===n){if(t)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var t=this.elements;return new e.Matrix3(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},e.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements=new Float32Array(16);m[0]=void 0!==e?e:1,m[4]=t||0,m[8]=n||0,m[12]=r||0,m[1]=i||0,m[5]=void 0!==s?s:1,m[9]=o||0,m[13]=u||0,m[2]=a||0,m[6]=f||0,m[10]=void 0!==l?l:1,m[14]=c||0,m[3]=h||0,m[7]=p||0,m[11]=d||0,m[15]=void 0!==v?v:1},e.Matrix4.prototype={constructor:e.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(){var t=new e.Vector3;return function(e){var n=this.elements,e=e.elements,r=1/t.set(e[0],e[1],e[2]).length(),i=1/t.set(e[4],e[5],e[6]).length(),s=1/t.set(e[8],e[9],e[10]).length();return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,this}}(),setRotationFromEuler:function(e,t){return console.warn("DEPRECATED: Matrix4's .setRotationFromEuler() has been deprecated in favor of makeRotationFromEuler.  Please update your code."),this.makeRotationFromEuler(e,t)},makeRotationFromEuler:function(e,t){var n=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),r=Math.sin(r),u=Math.cos(i),i=Math.sin(i),a=Math.cos(s),s=Math.sin(s);if(void 0===t||"XYZ"===t){var f=o*a,l=o*s,c=r*a,h=r*s;n[0]=u*a,n[4]=-u*s,n[8]=i,n[1]=l+c*i,n[5]=f-h*i,n[9]=-r*u,n[2]=h-f*i,n[6]=c+l*i,n[10]=o*u}else"YXZ"===t?(f=u*a,l=u*s,c=i*a,h=i*s,n[0]=f+h*r,n[4]=c*r-l,n[8]=o*i,n[1]=o*s,n[5]=o*a,n[9]=-r,n[2]=l*r-c,n[6]=h+f*r,n[10]=o*u):"ZXY"===t?(f=u*a,l=u*s,c=i*a,h=i*s,n[0]=f-h*r,n[4]=-o*s,n[8]=c+l*r,n[1]=l+c*r,n[5]=o*a,n[9]=h-f*r,n[2]=-o*i,n[6]=r,n[10]=o*u):"ZYX"===t?(f=o*a,l=o*s,c=r*a,h=r*s,n[0]=u*a,n[4]=c*i-l,n[8]=f*i+h,n[1]=u*s,n[5]=h*i+f,n[9]=l*i-c,n[2]=-i,n[6]=r*u,n[10]=o*u):"YZX"===t?(f=o*u,l=o*i,c=r*u,h=r*i,n[0]=u*a,n[4]=h-f*s,n[8]=c*s+l,n[1]=s,n[5]=o*a,n[9]=-r*a,n[2]=-i*a,n[6]=l*s+c,n[10]=f-h*s):"XZY"===t&&(f=o*u,l=o*i,c=r*u,h=r*i,n[0]=u*a,n[4]=-s,n[8]=i*a,n[1]=f*s+h,n[5]=o*a,n[9]=l*s-c,n[2]=c*s-l,n[6]=r*a,n[10]=h*s+f);return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,e=n*o,f=n*u,n=n*a,l=r*u,r=r*a,i=i*a,o=s*o,u=s*u,s=s*a;return t[0]=1-(l+i),t[4]=f-s,t[8]=n+u,t[1]=f+s,t[5]=1-(e+i),t[9]=r-o,t[2]=n-u,t[6]=r+o,t[10]=1-(e+l),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3;return function(e,i,s){var o=this.elements;return r.subVectors(e,i).normalize(),0===r.length()&&(r.z=1),t.crossVectors(s,r).normalize(),0===t.length()&&(r.x+=1e-4,t.crossVectors(s,r).normalize()),n.crossVectors(r,t),o[0]=t.x,o[4]=n.x,o[8]=r.x,o[1]=t.y,o[5]=n.y,o[9]=r.y,o[2]=t.z,o[6]=n.z,o[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],n=n[15],w=r[0],E=r[4],S=r[8],x=r[12],T=r[1],N=r[5],C=r[9],k=r[13],L=r[2],A=r[6],O=r[10],M=r[14],_=r[3],D=r[7],P=r[11],r=r[15];return i[0]=s*w+o*T+u*L+a*_,i[4]=s*E+o*N+u*A+a*D,i[8]=s*S+o*C+u*O+a*P,i[12]=s*x+o*k+u*M+a*r,i[1]=f*w+l*T+c*L+h*_,i[5]=f*E+l*N+c*A+h*D,i[9]=f*S+l*C+c*O+h*P,i[13]=f*x+l*k+c*M+h*r,i[2]=p*w+d*T+v*L+m*_,i[6]=p*E+d*N+v*A+m*D,i[10]=p*S+d*C+v*O+m*P,i[14]=p*x+d*k+v*M+m*r,i[3]=g*w+y*T+b*L+n*_,i[7]=g*E+y*N+b*A+n*D,i[11]=g*S+y*C+b*O+n*P,i[15]=g*x+y*k+b*M+n*r,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var t=new e.Vector3;return function(e){for(var n=0,r=e.length;n<r;n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],t.applyProjection(this),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14];return e[3]*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+e[7]*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+e[11]*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+e[15]*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var t=new e.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],b=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*b+f*d*b,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*b-s*d*b,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*b+s*l*b,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*b-a*d*b,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*b+i*d*b,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*b-i*l*b,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*b+a*p*b,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*b-i*p*b,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*b+i*f*b,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d,n=r[0]*n[0]+r[1]*n[4]+r[2]*n[8]+r[3]*n[12];if(0==n){if(t)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},translate:function(){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,r=e.y,e=e.z;return t[0]*=n,t[4]*=r,t[8]*=e,t[1]*=n,t[5]*=r,t[9]*=e,t[2]*=n,t[6]*=r,t[10]*=e,t[3]*=n,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return console.warn("DEPRECATED: Matrix4's .compose() has been deprecated in favor of makeFromPositionQuaternionScale. Please update your code."),this.makeFromPositionQuaternionScale(e,t,n)},makeFromPositionQuaternionScale:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},makeFromPositionEulerScale:function(e,t,n,r){return this.makeRotationFromEuler(t,n),this.scale(r),this.setPosition(e),this},makeFrustum:function(e,t,n,r,i,s){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(s+i)/(s-i),o[14]=-2*s*i/(s-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,n,r,i){var t=r*Math.tan(e.Math.degToRad(.5*t)),s=-t;return this.makeFrustum(s*n,t*n,s,t,r,i)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-((t+e)/u),o[1]=0,o[5]=2/a,o[9]=0,o[13]=-((n+r)/a),o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-((s+i)/f),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var t=this.elements;return new e.Matrix4(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}},e.extend(e.Matrix4.prototype,{decompose:function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3,i=new e.Matrix4;return function(s,o,u){var f=this.elements;return t.set(f[0],f[1],f[2]),n.set(f[4],f[5],f[6]),r.set(f[8],f[9],f[10]),s=s instanceof e.Vector3?s:new e.Vector3,o=o instanceof e.Quaternion?o:new e.Quaternion,u=u instanceof e.Vector3?u:new e.Vector3,u.x=t.length(),u.y=n.length(),u.z=r.length(),s.x=f[12],s.y=f[13],s.z=f[14],i.copy(this),i.elements[0]/=u.x,i.elements[1]/=u.x,i.elements[2]/=u.x,i.elements[4]/=u.y,i.elements[5]/=u.y,i.elements[6]/=u.y,i.elements[8]/=u.z,i.elements[9]/=u.z,i.elements[10]/=u.z,o.setFromRotationMatrix(i),[s,o,u]}}()}),e.Ray=function(t,n){this.origin=void 0!==t?t:new e.Vector3,this.direction=void 0!==n?n:new e.Vector3},e.Ray.prototype={constructor:e.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(t,n){return(n||new e.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new e.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,n){var r=n||new e.Vector3;r.subVectors(t,this.origin);var i=r.dot(this.direction);return r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var t=new e.Vector3;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceTo(e)}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){return 0!=e.normal.dot(this.direction)||0==e.distanceToPoint(this.origin)?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0!=t)return-(this.origin.dot(e.normal)+e.constant)/t;if(0==e.distanceToPoint(this.origin))return 0},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return void 0===n?void 0:this.at(n,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new e.Ray).copy(this)}},e.Sphere=function(t,n){this.center=void 0!==t?t:new e.Vector3,this.radius=void 0!==n?n:0},e.Sphere.prototype={constructor:e.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var n=0,r=0,i=t.length;r<i;r++)var s=e.distanceToSquared(t[r]),n=Math.max(n,s);return this.center=e,this.radius=Math.sqrt(n),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(t,n){var r=this.center.distanceToSquared(t),i=n||new e.Vector3;return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(t){return t=t||new e.Box3,t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new e.Sphere).copy(this)}},e.Frustum=function(t,n,r,i,s,o){this.planes=[void 0!==t?t:new e.Plane,void 0!==n?n:new e.Plane,void 0!==r?r:new e.Plane,void 0!==i?i:new e.Plane,void 0!==s?s:new e.Plane,void 0!==o?o:new e.Plane]},e.Frustum.prototype={constructor:e.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},copy:function(e){for(var t=this.planes,n=0;6>n;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,e=n[0],r=n[1],i=n[2],s=n[3],o=n[4],u=n[5],a=n[6],f=n[7],l=n[8],c=n[9],h=n[10],p=n[11],d=n[12],v=n[13],m=n[14],n=n[15];return t[0].setComponents(s-e,f-o,p-l,n-d).normalize(),t[1].setComponents(s+e,f+o,p+l,n+d).normalize(),t[2].setComponents(s+r,f+u,p+c,n+v).normalize(),t[3].setComponents(s-r,f-u,p-c,n-v).normalize(),t[4].setComponents(s-i,f-a,p-h,n-m).normalize(),t[5].setComponents(s+i,f+a,p+h,n+m).normalize(),this},intersectsObject:function(){var t=new e.Vector3;return function(e){var n=e.matrixWorld,r=this.planes,e=-e.geometry.boundingSphere.radius*n.getMaxScaleOnAxis();t.getPositionFromMatrix(n);for(n=0;6>n;n++)if(r[n].distanceToPoint(t)<e)return!1;return!0}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,e=-e.radius,r=0;6>r;r++)if(t[r].distanceToPoint(n)<e)return!1;return!0},containsPoint:function(e){for(var t=this.planes,n=0;6>n;n++)if(0>t[n].distanceToPoint(e))return!1;return!0},clone:function(){return(new e.Frustum).copy(this)}},e.Plane=function(t,n){this.normal=void 0!==t?t:new e.Vector3(1,0,0),this.constant=void 0!==n?n:0},e.Plane.prototype={constructor:e.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new e.Vector3,n=new e.Vector3;return function(e,r,i){return r=t.subVectors(i,r).cross(n.subVectors(e,r)).normalize(),this.setFromNormalAndCoplanarPoint(r,e),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(t,n){var r=this.distanceToPoint(t);return(n||new e.Vector3).copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return 0>t&&0<e||0>e&&0<t},intersectLine:function(){var t=new e.Vector3;return function(n,r){var i=r||new e.Vector3,s=n.delta(t),o=this.normal.dot(s);if(0!=o)return o=-(n.start.dot(this.normal)+this.constant)/o,0>o||1<o?void 0:i.copy(s).multiplyScalar(o).add(n.start);if(0==this.distanceToPoint(n.start))return i.copy(n.start)}}(),coplanarPoint:function(t){return(t||new e.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new e.Vector3,n=new e.Vector3;return function(r,i){var i=i||(new e.Matrix3).getNormalMatrix(r),s=t.copy(this.normal).applyMatrix3(i),o=this.coplanarPoint(n);return o.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(s,o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new e.Plane).copy(this)}},e.Math={clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:0<e?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},e.Spline=function(t){function n(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t}this.points=t;var r=[],i={x:0,y:0,z:0},s,o,u,a,f,l,c,h,p;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return s=(this.points.length-1)*e,o=Math.floor(s),u=s-o,r[0]=0===o?o:o-1,r[1]=o,r[2]=o>this.points.length-2?this.points.length-1:o+1,r[3]=o>this.points.length-3?this.points.length-1:o+2,l=this.points[r[0]],c=this.points[r[1]],h=this.points[r[2]],p=this.points[r[3]],a=u*u,f=u*a,i.x=n(l.x,c.x,h.x,p.x,u,a,f),i.y=n(l.y,c.y,h.y,p.y,u,a,f),i.z=n(l.z,c.z,h.z,p.z,u,a,f),i},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(t){var n,r,i,s=n=n=0,o=new e.Vector3,u=new e.Vector3,a=[],f=0;a[0]=0,t||(t=100),r=this.points.length*t,o.copy(this.points[0]);for(t=1;t<r;t++)n=t/r,i=this.getPoint(n),u.copy(i),f+=u.distanceTo(o),o.copy(i),n*=this.points.length-1,n=Math.floor(n),n!=s&&(a[n]=f,s=n);return a[a.length]=f,{chunks:a,total:f}},this.reparametrizeByArcLength=function(t){var n,r,i,s,o,u,a=[],f=new e.Vector3,l=this.getLength();a.push(f.copy(this.points[0]).clone());for(n=1;n<this.points.length;n++){r=l.chunks[n]-l.chunks[n-1],u=Math.ceil(t*r/l.total),s=(n-1)/(this.points.length-1),o=n/(this.points.length-1);for(r=1;r<u-1;r++)i=s+r*(1/u)*(o-s),i=this.getPoint(i),a.push(f.copy(i).clone());a.push(f.copy(this.points[n]).clone())}this.points=a}},e.Triangle=function(t,n,r){this.a=void 0!==t?t:new e.Vector3,this.b=void 0!==n?n:new e.Vector3,this.c=void 0!==r?r:new e.Vector3},e.Triangle.normal=function(){var t=new e.Vector3;return function(n,r,i,s){return s=s||new e.Vector3,s.subVectors(i,r),t.subVectors(n,r),s.cross(t),n=s.lengthSq(),0<n?s.multiplyScalar(1/Math.sqrt(n)):s.set(0,0,0)}}(),e.Triangle.barycoordFromPoint=function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3;return function(i,s,o,u,f){t.subVectors(u,s),n.subVectors(o,s),r.subVectors(i,s);var i=t.dot(t),s=t.dot(n),o=t.dot(r),l=n.dot(n),u=n.dot(r),h=i*l-s*s,f=f||new e.Vector3;return 0==h?f.set(-2,-1,-1):(h=1/h,l=(l*o-s*u)*h,i=(i*u-s*o)*h,f.set(1-l-i,i,l))}}(),e.Triangle.containsPoint=function(){var t=new e.Vector3;return function(n,r,i,s){return n=e.Triangle.barycoordFromPoint(n,r,i,s,t),0<=n.x&&0<=n.y&&1>=n.x+n.y}}(),e.Triangle.prototype={constructor:e.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var t=new e.Vector3,n=new e.Vector3;return function(){return t.subVectors(this.c,this.b),n.subVectors(this.a,this.b),.5*t.cross(n).length()}}(),midpoint:function(t){return(t||new e.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return e.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new e.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,n){return e.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,n)},containsPoint:function(t){return e.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new e.Triangle).copy(this)}},e.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},e.UV=function(t,n){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new e.Vector2(t,n)},e.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},e.Clock.prototype={constructor:e.Clock,start:function(){this.oldTime=this.startTime=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e}},e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners,r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=0,r=t.length;n<r;n++)t[n].call(this,e)}}}},function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n),0<this.ray.direction.lengthSq()&&this.ray.direction.normalize(),this.near=r||0,this.far=i||Infinity};var t=new e.Sphere,n=new e.Ray,r=new e.Plane,i=new e.Vector3,s=new e.Vector3,o=new e.Matrix4,u=function(e,t){return e.distance-t.distance},a=function(u,f,l){if(u instanceof e.Particle){s.getPositionFromMatrix(u.matrixWorld);var h=f.ray.distanceToPoint(s);if(h>u.scale.x)return l;l.push({distance:h,point:u.position,face:null,object:u})}else if(u instanceof e.LOD)s.getPositionFromMatrix(u.matrixWorld),h=f.ray.origin.distanceTo(s),a(u.getObjectForDistance(h),f,l);else if(u instanceof e.Mesh){s.getPositionFromMatrix(u.matrixWorld),t.set(s,u.geometry.boundingSphere.radius*u.matrixWorld.getMaxScaleOnAxis());if(!f.ray.isIntersectionSphere(t))return l;var h=u.geometry,p=h.vertices,v=u.material instanceof e.MeshFaceMaterial,m=!0===v?u.material.materials:null,y=u.material.side,w,E,S,x=f.precision;o.getInverse(u.matrixWorld),n.copy(f.ray).applyMatrix4(o);for(var T=0,N=h.faces.length;T<N;T++){var C=h.faces[T],y=!0===v?m[C.materialIndex]:u.material;if(void 0!==y){r.setFromNormalAndCoplanarPoint(C.normal,p[C.a]);var k=n.distanceToPlane(r);if(!(Math.abs(k)<x)&&!(0>k)){y=y.side;if(!(y===e.DoubleSide||(w=n.direction.dot(r.normal),y===e.FrontSide?0>w:0<w)))continue;if(!(k<f.near||k>f.far)){i=n.at(k,i);if(C instanceof e.Face3){if(y=p[C.a],w=p[C.b],E=p[C.c],!e.Triangle.containsPoint(i,y,w,E))continue}else{if(!(C instanceof e.Face4))throw Error("face type not supported");if(y=p[C.a],w=p[C.b],E=p[C.c],S=p[C.d],!e.Triangle.containsPoint(i,y,w,S)&&!e.Triangle.containsPoint(i,w,E,S))continue}l.push({distance:k,point:f.ray.at(k),face:C,faceIndex:T,object:u})}}}}}},f=function(e,t,n){for(var e=e.getDescendants(),r=0,i=e.length;r<i;r++)a(e[r],t,n)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),0<this.ray.direction.length()&&this.ray.direction.normalize()},e.Raycaster.prototype.intersectObject=function(e,t){var n=[];return!0===t&&f(e,this,n),a(e,this,n),n.sort(u),n},e.Raycaster.prototype.intersectObjects=function(e,t){for(var n=[],r=0,i=e.length;r<i;r++)a(e[r],this,n),!0===t&&f(e[r],this,n);return n.sort(u),n}}(e),e.Object3D=function(){this.id=e.Object3DIdCount++,this.name="",this.parent=void 0,this.children=[],this.up=new e.Vector3(0,1,0),this.position=new e.Vector3,this.rotation=new e.Vector3,this.eulerOrder=e.Object3D.defaultEulerOrder,this.scale=new e.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new e.Matrix4,this.matrixWorld=new e.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new e.Quaternion,this.useQuaternion=!1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},e.Object3D.prototype={constructor:e.Object3D,applyMatrix:function(){var t=new e.Matrix4;return function(e){this.matrix.multiplyMatrices(e,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),t.extractRotation(this.matrix),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),rotateOnAxis:function(){var t=new e.Quaternion,n=new e.Quaternion;return function(e,r){return t.setFromAxisAngle(e,r),!0===this.useQuaternion?this.quaternion.multiply(t):(n.setFromEuler(this.rotation,this.eulerOrder),n.multiply(t),this.rotation.setEulerFromQuaternion(n,this.eulerOrder)),this}}(),translateOnAxis:function(){var t=new e.Vector3;return function(e,n){return t.copy(e),!0===this.useQuaternion?t.applyQuaternion(this.quaternion):t.applyEuler(this.rotation,this.eulerOrder),this.position.add(t.multiplyScalar(n)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var t=new e.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new e.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new e.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new e.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new e.Matrix4;return function(e){t.lookAt(e,this.position,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),add:function(t){if(t===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(t instanceof e.Object3D){void 0!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t);for(var n=this;void 0!==n.parent;)n=n.parent;void 0!==n&&n instanceof e.Scene&&n.__addObject(t)}},remove:function(t){var n=this.children.indexOf(t);if(-1!==n){t.parent=void 0,this.children.splice(n,1);for(n=this;void 0!==n.parent;)n=n.parent;void 0!==n&&n instanceof e.Scene&&n.__removeObject(t)}},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.id===e||!0===t&&(i=i.getObjectById(e,t),void 0!==i))return i}},getObjectByName:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.name===e||!0===t&&(i=i.getObjectByName(e,t),void 0!==i))return i}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,n=this.children.length;t<n;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){!1===this.useQuaternion?this.matrix.makeFromPositionEulerScale(this.position,this.rotation,this.eulerOrder,this.scale):this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===e)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},clone:function(t){void 0===t&&(t=new e.Object3D),t.name=this.name,t.up.copy(this.up),t.position.copy(this.position),t.rotation instanceof e.Vector3&&t.rotation.copy(this.rotation),t.eulerOrder=this.eulerOrder,t.scale.copy(this.scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.matrixWorld.copy(this.matrixWorld),t.matrixAutoUpdate=this.matrixAutoUpdate,t.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,t.quaternion.copy(this.quaternion),t.useQuaternion=this.useQuaternion,t.visible=this.visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.userData=JSON.parse(JSON.stringify(this.userData));for(var n=0;n<this.children.length;n++)t.add(this.children[n].clone());return t}},e.Object3D.defaultEulerOrder="XYZ",e.Object3DIdCount=0,e.Projector=function(){function t(){if(o===a){var t=new e.RenderableObject;return u.push(t),a++,o++,t}return u[o++]}function n(){if(l===h){var t=new e.RenderableVertex;return c.push(t),h++,l++,t}return c[l++]}function r(e,t){return t.z-e.z}function i(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return 0<=i&&0<=s&&0<=o&&0<=u?!0:0>i&&0>s||0>o&&0>u?!1:(0>i?n=Math.max(n,i/(i-s)):0>s&&(r=Math.min(r,i/(i-s))),0>o?n=Math.max(n,o/(o-u)):0>u&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerp(t,n),t.lerp(e,1-r),!0))}var s,o,u=[],a=0,f,l,c=[],h=0,p,d,v=[],m=0,g,y=[],b=0,w,E,S=[],x=0,T,N,C=[],k=0,L={objects:[],sprites:[],lights:[],elements:[]},A=new e.Vector3,O=new e.Vector4,M=new e.Box3(new e.Vector3(-1,-1,-1),new e.Vector3(1,1,1)),_=new e.Box3,D=Array(3),P=Array(4),H=new e.Matrix4,B=new e.Matrix4,j,F=new e.Matrix4,I=new e.Matrix3,q=new e.Matrix3,R=new e.Vector3,U=new e.Frustum,z=new e.Vector4,W=new e.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(B)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),B.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(B)},this.pickingRay=function(t,n){t.z=-1;var r=new e.Vector3(t.x,t.y,1);return this.unprojectVector(t,n),this.unprojectVector(r,n),r.sub(t).normalize(),new e.Raycaster(t,r)},this.projectScene=function(u,a,h,X){var $=!1,Q,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft;N=E=g=d=0,L.elements.length=0,!0===u.autoUpdate&&u.updateMatrixWorld(),void 0===a.parent&&a.updateMatrixWorld(),H.copy(a.matrixWorldInverse.getInverse(a.matrixWorld)),B.multiplyMatrices(a.projectionMatrix,H),q.getNormalMatrix(H),U.setFromMatrix(B),o=0,L.objects.length=0,L.sprites.length=0,L.lights.length=0;var lt=function(n){for(var r=0,i=n.children.length;r<i;r++){var o=n.children[r];if(!1!==o.visible){if(o instanceof e.Light)L.lights.push(o);else if(o instanceof e.Mesh||o instanceof e.Line){if(!1===o.frustumCulled||!0===U.intersectsObject(o))s=t(),s.object=o,null!==o.renderDepth?s.z=o.renderDepth:(A.getPositionFromMatrix(o.matrixWorld),A.applyProjection(B),s.z=A.z),L.objects.push(s)}else o instanceof e.Sprite||o instanceof e.Particle?(s=t(),s.object=o,null!==o.renderDepth?s.z=o.renderDepth:(A.getPositionFromMatrix(o.matrixWorld),A.applyProjection(B),s.z=A.z),L.sprites.push(s)):(s=t(),s.object=o,null!==o.renderDepth?s.z=o.renderDepth:(A.getPositionFromMatrix(o.matrixWorld),A.applyProjection(B),s.z=A.z),L.objects.push(s));lt(o)}}};lt(u),!0===h&&L.objects.sort(r),u=0;for(h=L.objects.length;u<h;u++)if(it=L.objects[u].object,j=it.matrixWorld,l=0,it instanceof e.Mesh){st=it.geometry,Z=st.vertices,ot=st.faces,st=st.faceVertexUvs,I.getNormalMatrix(j),at=it.material instanceof e.MeshFaceMaterial,ft=!0===at?it.material:null,Q=0;for(Y=Z.length;Q<Y;Q++)f=n(),f.positionWorld.copy(Z[Q]).applyMatrix4(j),f.positionScreen.copy(f.positionWorld).applyMatrix4(B),f.positionScreen.x/=f.positionScreen.w,f.positionScreen.y/=f.positionScreen.w,f.positionScreen.z/=f.positionScreen.w,f.visible=!(-1>f.positionScreen.x||1<f.positionScreen.x||-1>f.positionScreen.y||1<f.positionScreen.y||-1>f.positionScreen.z||1<f.positionScreen.z);Z=0;for(Q=ot.length;Z<Q;Z++){Y=ot[Z];var ct=!0===at?ft.materials[Y.materialIndex]:it.material;if(void 0!==ct){nt=ct.side;if(Y instanceof e.Face3){if(et=c[Y.a],tt=c[Y.b],rt=c[Y.c],D[0]=et.positionScreen,D[1]=tt.positionScreen,D[2]=rt.positionScreen,!0!==et.visible&&!0!==tt.visible&&!0!==rt.visible&&!M.isIntersectionBox(_.setFromPoints(D)))continue;if($=0>(rt.positionScreen.x-et.positionScreen.x)*(tt.positionScreen.y-et.positionScreen.y)-(rt.positionScreen.y-et.positionScreen.y)*(tt.positionScreen.x-et.positionScreen.x),nt!==e.DoubleSide&&$!==(nt===e.FrontSide))continue;d===m?(ut=new e.RenderableFace3,v.push(ut),m++,d++,p=ut):p=v[d++],p.v1.copy(et),p.v2.copy(tt),p.v3.copy(rt)}else if(Y instanceof e.Face4){if(et=c[Y.a],tt=c[Y.b],rt=c[Y.c],ut=c[Y.d],P[0]=et.positionScreen,P[1]=tt.positionScreen,P[2]=rt.positionScreen,P[3]=ut.positionScreen,!0!==et.visible&&!0!==tt.visible&&!0!==rt.visible&&!0!==ut.visible&&!M.isIntersectionBox(_.setFromPoints(P)))continue;if($=0>(ut.positionScreen.x-et.positionScreen.x)*(tt.positionScreen.y-et.positionScreen.y)-(ut.positionScreen.y-et.positionScreen.y)*(tt.positionScreen.x-et.positionScreen.x)||0>(tt.positionScreen.x-rt.positionScreen.x)*(ut.positionScreen.y-rt.positionScreen.y)-(tt.positionScreen.y-rt.positionScreen.y)*(ut.positionScreen.x-rt.positionScreen.x),nt!==e.DoubleSide&&$!==(nt===e.FrontSide))continue;if(g===b){var ht=new e.RenderableFace4;y.push(ht),b++,g++,p=ht}else p=y[g++];p.v1.copy(et),p.v2.copy(tt),p.v3.copy(rt),p.v4.copy(ut)}p.normalModel.copy(Y.normal),!1===$&&(nt===e.BackSide||nt===e.DoubleSide)&&p.normalModel.negate(),p.normalModel.applyMatrix3(I).normalize(),p.normalModelView.copy(p.normalModel).applyMatrix3(q),p.centroidModel.copy(Y.centroid).applyMatrix4(j),rt=Y.vertexNormals,et=0;for(tt=rt.length;et<tt;et++)ut=p.vertexNormalsModel[et],ut.copy(rt[et]),!1===$&&(nt===e.BackSide||nt===e.DoubleSide)&&ut.negate(),ut.applyMatrix3(I).normalize(),p.vertexNormalsModelView[et].copy(ut).applyMatrix3(q);p.vertexNormalsLength=rt.length,et=0;for(tt=st.length;et<tt;et++)if(ut=st[et][Z],void 0!==ut){nt=0;for(rt=ut.length;nt<rt;nt++)p.uvs[et][nt]=ut[nt]}p.color=Y.color,p.material=ct,R.copy(p.centroidModel).applyProjection(B),p.z=R.z,L.elements.push(p)}}}else if(it instanceof e.Line){F.multiplyMatrices(B,j),Z=it.geometry.vertices,et=n(),et.positionScreen.copy(Z[0]).applyMatrix4(F),ot=it.type===e.LinePieces?2:1,Q=1;for(Y=Z.length;Q<Y;Q++)et=n(),et.positionScreen.copy(Z[Q]).applyMatrix4(F),0<(Q+1)%ot||(tt=c[l-2],z.copy(et.positionScreen),W.copy(tt.positionScreen),!0===i(z,W)&&(z.multiplyScalar(1/z.w),W.multiplyScalar(1/W.w),E===x?(st=new e.RenderableLine,S.push(st),x++,E++,w=st):w=S[E++],w.v1.positionScreen.copy(z),w.v2.positionScreen.copy(W),w.z=Math.max(z.z,W.z),w.material=it.material,it.material.vertexColors===e.VertexColors&&(w.vertexColors[0].copy(it.geometry.colors[Q]),w.vertexColors[1].copy(it.geometry.colors[Q-1])),L.elements.push(w)))}u=0;for(h=L.sprites.length;u<h;u++)it=L.sprites[u].object,j=it.matrixWorld,it instanceof e.Particle&&(O.set(j.elements[12],j.elements[13],j.elements[14],1),O.applyMatrix4(B),O.z/=O.w,0<O.z&&1>O.z&&(N===k?($=new e.RenderableParticle,C.push($),k++,N++,T=$):T=C[N++],T.object=it,T.x=O.x/O.w,T.y=O.y/O.w,T.z=O.z,T.rotation=it.rotation.z,T.scale.x=it.scale.x*Math.abs(T.x-(O.x+a.projectionMatrix.elements[0])/(O.w+a.projectionMatrix.elements[12])),T.scale.y=it.scale.y*Math.abs(T.y-(O.y+a.projectionMatrix.elements[5])/(O.w+a.projectionMatrix.elements[13])),T.material=it.material,L.elements.push(T)));return!0===X&&L.elements.sort(r),L}},e.Face3=function(t,n,r,i,s,o){this.a=t,this.b=n,this.c=r,this.normal=i instanceof e.Vector3?i:new e.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=s instanceof e.Color?s:new e.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0,this.centroid=new e.Vector3},e.Face3.prototype={constructor:e.Face3,clone:function(){var t=new e.Face3(this.a,this.b,this.c);t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex;var n,r;n=0;for(r=this.vertexNormals.length;n<r;n++)t.vertexNormals[n]=this.vertexNormals[n].clone();n=0;for(r=this.vertexColors.length;n<r;n++)t.vertexColors[n]=this.vertexColors[n].clone();n=0;for(r=this.vertexTangents.length;n<r;n++)t.vertexTangents[n]=this.vertexTangents[n].clone();return t}},e.Face4=function(t,n,r,i,s,o,u){this.a=t,this.b=n,this.c=r,this.d=i,this.normal=s instanceof e.Vector3?s:new e.Vector3,this.vertexNormals=s instanceof Array?s:[],this.color=o instanceof e.Color?o:new e.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==u?u:0,this.centroid=new e.Vector3},e.Face4.prototype={constructor:e.Face4,clone:function(){var t=new e.Face4(this.a,this.b,this.c,this.d);t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex;var n,r;n=0;for(r=this.vertexNormals.length;n<r;n++)t.vertexNormals[n]=this.vertexNormals[n].clone();n=0;for(r=this.vertexColors.length;n<r;n++)t.vertexColors[n]=this.vertexColors[n].clone();n=0;for(r=this.vertexTangents.length;n<r;n++)t.vertexTangents[n]=this.vertexTangents[n].clone();return t}},e.Geometry=function(){this.id=e.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},e.Geometry.prototype={constructor:e.Geometry,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(t){for(var n=(new e.Matrix3).getNormalMatrix(t),r=0,i=this.vertices.length;r<i;r++)this.vertices[r].applyMatrix4(t);r=0;for(i=this.faces.length;r<i;r++){var s=this.faces[r];s.normal.applyMatrix3(n).normalize();for(var o=0,u=s.vertexNormals.length;o<u;o++)s.vertexNormals[o].applyMatrix3(n).normalize();s.centroid.applyMatrix4(t)}},computeCentroids:function(){var t,n,r;t=0;for(n=this.faces.length;t<n;t++)r=this.faces[t],r.centroid.set(0,0,0),r instanceof e.Face3?(r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.divideScalar(3)):r instanceof e.Face4&&(r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.add(this.vertices[r.d]),r.centroid.divideScalar(4))},computeFaceNormals:function(){for(var t=new e.Vector3,n=new e.Vector3,r=0,i=this.faces.length;r<i;r++){var s=this.faces[r],o=this.vertices[s.a],u=this.vertices[s.b];t.subVectors(this.vertices[s.c],u),n.subVectors(o,u),t.cross(n),t.normalize(),s.normal.copy(t)}},computeVertexNormals:function(t){var n,r,i,s;if(void 0===this.__tmpVertices){s=this.__tmpVertices=Array(this.vertices.length),n=0;for(r=this.vertices.length;n<r;n++)s[n]=new e.Vector3;n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i instanceof e.Face3?i.vertexNormals=[new e.Vector3,new e.Vector3,new e.Vector3]:i instanceof e.Face4&&(i.vertexNormals=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3])}else{s=this.__tmpVertices,n=0;for(r=this.vertices.length;n<r;n++)s[n].set(0,0,0)}if(t){var o,u,a,f=new e.Vector3,l=new e.Vector3,c=new e.Vector3,h=new e.Vector3,p=new e.Vector3;n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i instanceof e.Face3?(t=this.vertices[i.a],o=this.vertices[i.b],u=this.vertices[i.c],f.subVectors(u,o),l.subVectors(t,o),f.cross(l),s[i.a].add(f),s[i.b].add(f),s[i.c].add(f)):i instanceof e.Face4&&(t=this.vertices[i.a],o=this.vertices[i.b],u=this.vertices[i.c],a=this.vertices[i.d],c.subVectors(a,o),l.subVectors(t,o),c.cross(l),s[i.a].add(c),s[i.b].add(c),s[i.d].add(c),h.subVectors(a,u),p.subVectors(o,u),h.cross(p),s[i.b].add(h),s[i.c].add(h),s[i.d].add(h))}else{n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i instanceof e.Face3?(s[i.a].add(i.normal),s[i.b].add(i.normal),s[i.c].add(i.normal)):i instanceof e.Face4&&(s[i.a].add(i.normal),s[i.b].add(i.normal),s[i.c].add(i.normal),s[i.d].add(i.normal))}n=0;for(r=this.vertices.length;n<r;n++)s[n].normalize();n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i instanceof e.Face3?(i.vertexNormals[0].copy(s[i.a]),i.vertexNormals[1].copy(s[i.b]),i.vertexNormals[2].copy(s[i.c])):i instanceof e.Face4&&(i.vertexNormals[0].copy(s[i.a]),i.vertexNormals[1].copy(s[i.b]),i.vertexNormals[2].copy(s[i.c]),i.vertexNormals[3].copy(s[i.d]))},computeMorphNormals:function(){var t,n,r,i,s;r=0;for(i=this.faces.length;r<i;r++){s=this.faces[r],s.__originalFaceNormal?s.__originalFaceNormal.copy(s.normal):s.__originalFaceNormal=s.normal.clone(),s.__originalVertexNormals||(s.__originalVertexNormals=[]),t=0;for(n=s.vertexNormals.length;t<n;t++)s.__originalVertexNormals[t]?s.__originalVertexNormals[t].copy(s.vertexNormals[t]):s.__originalVertexNormals[t]=s.vertexNormals[t].clone()}var o=new e.Geometry;o.faces=this.faces,t=0;for(n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var u=this.morphNormals[t].faceNormals,a=this.morphNormals[t].vertexNormals,f,l;r=0;for(i=this.faces.length;r<i;r++)s=this.faces[r],f=new e.Vector3,l=s instanceof e.Face3?{a:new e.Vector3,b:new e.Vector3,c:new e.Vector3}:{a:new e.Vector3,b:new e.Vector3,c:new e.Vector3,d:new e.Vector3},u.push(f),a.push(l)}u=this.morphNormals[t],o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0;for(i=this.faces.length;r<i;r++)s=this.faces[r],f=u.faceNormals[r],l=u.vertexNormals[r],f.copy(s.normal),s instanceof e.Face3?(l.a.copy(s.vertexNormals[0]),l.b.copy(s.vertexNormals[1]),l.c.copy(s.vertexNormals[2])):(l.a.copy(s.vertexNormals[0]),l.b.copy(s.vertexNormals[1]),l.c.copy(s.vertexNormals[2]),l.d.copy(s.vertexNormals[3]))}r=0;for(i=this.faces.length;r<i;r++)s=this.faces[r],s.normal=s.__originalFaceNormal,s.vertexNormals=s.__originalVertexNormals},computeTangents:function(){function t(e,t,n,r,i,s,o){a=e.vertices[t],f=e.vertices[n],l=e.vertices[r],c=u[i],h=u[s],p=u[o],d=f.x-a.x,v=l.x-a.x,m=f.y-a.y,g=l.y-a.y,y=f.z-a.z,b=l.z-a.z,w=h.x-c.x,E=p.x-c.x,S=h.y-c.y,x=p.y-c.y,T=1/(w*x-E*S),L.set((x*d-S*v)*T,(x*m-S*g)*T,(x*y-S*b)*T),A.set((w*v-E*d)*T,(w*g-E*m)*T,(w*b-E*y)*T),C[t].add(L),C[n].add(L),C[r].add(L),k[t].add(A),k[n].add(A),k[r].add(A)}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=[],k=[],L=new e.Vector3,A=new e.Vector3,O=new e.Vector3,M=new e.Vector3,_=new e.Vector3;n=0;for(r=this.vertices.length;n<r;n++)C[n]=new e.Vector3,k[n]=new e.Vector3;n=0;for(r=this.faces.length;n<r;n++)o=this.faces[n],u=this.faceVertexUvs[0][n],o instanceof e.Face3?t(this,o.a,o.b,o.c,0,1,2):o instanceof e.Face4&&(t(this,o.a,o.b,o.d,0,1,3),t(this,o.b,o.c,o.d,1,2,3));var D=["a","b","c","d"];n=0;for(r=this.faces.length;n<r;n++){o=this.faces[n];for(i=0;i<o.vertexNormals.length;i++)_.copy(o.vertexNormals[i]),s=o[D[i]],N=C[s],O.copy(N),O.sub(_.multiplyScalar(_.dot(N))).normalize(),M.crossVectors(o.vertexNormals[i],N),s=M.dot(k[s]),s=0>s?-1:1,o.vertexTangents[i]=new e.Vector4(O.x,O.y,O.z,s)}this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,r=t.length;n<r;n++)0<n&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new e.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var t={},n=[],r=[],i,s=Math.pow(10,4),o,u,a,f,l;this.__tmpVertices=void 0,o=0;for(u=this.vertices.length;o<u;o++)i=this.vertices[o],i=[Math.round(i.x*s),Math.round(i.y*s),Math.round(i.z*s)].join("_"),void 0===t[i]?(t[i]=o,n.push(this.vertices[o]),r[o]=n.length-1):r[o]=r[t[i]];s=[],o=0;for(u=this.faces.length;o<u;o++)if(t=this.faces[o],t instanceof e.Face3){t.a=r[t.a],t.b=r[t.b],t.c=r[t.c],a=[t.a,t.b,t.c],i=-1;for(f=0;3>f;f++)if(a[f]==a[(f+1)%3]){s.push(o);break}}else if(t instanceof e.Face4){t.a=r[t.a],t.b=r[t.b],t.c=r[t.c],t.d=r[t.d],a=[t.a,t.b,t.c,t.d],i=-1;for(f=0;4>f;f++)a[f]==a[(f+1)%4]&&(0<=i&&s.push(o),i=f);if(0<=i){a.splice(i,1);var c=new e.Face3(a[0],a[1],a[2],t.normal,t.color,t.materialIndex);a=0;for(f=this.faceVertexUvs.length;a<f;a++)(l=this.faceVertexUvs[a][o])&&l.splice(i,1);t.vertexNormals&&0<t.vertexNormals.length&&(c.vertexNormals=t.vertexNormals,c.vertexNormals.splice(i,1)),t.vertexColors&&0<t.vertexColors.length&&(c.vertexColors=t.vertexColors,c.vertexColors.splice(i,1)),this.faces[o]=c}}for(o=s.length-1;0<=o;o--){this.faces.splice(o,1),a=0;for(f=this.faceVertexUvs.length;a<f;a++)this.faceVertexUvs[a].splice(o,1)}return r=this.vertices.length-n.length,this.vertices=n,r},clone:function(){for(var t=new e.Geometry,n=this.vertices,r=0,i=n.length;r<i;r++)t.vertices.push(n[r].clone());n=this.faces,r=0;for(i=n.length;r<i;r++)t.faces.push(n[r].clone());n=this.faceVertexUvs[0],r=0;for(i=n.length;r<i;r++){for(var s=n[r],o=[],u=0,a=s.length;u<a;u++)o.push(new e.Vector2(s[u].x,s[u].y));t.faceVertexUvs[0].push(o)}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.GeometryIdCount=0,e.BufferGeometry=function(){this.id=e.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.morphTargets=[]},e.BufferGeometry.prototype={constructor:e.BufferGeometry,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(t){var n,r;this.attributes.position&&(n=this.attributes.position.array),this.attributes.normal&&(r=this.attributes.normal.array),void 0!==n&&(t.multiplyVector3Array(n),this.verticesNeedUpdate=!0),void 0!==r&&((new e.Matrix3).getNormalMatrix(t).multiplyVector3Array(r),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new e.Box3);var t=this.attributes.position.array;if(t){var n=this.boundingBox,r,i,s;3<=t.length&&(n.min.x=n.max.x=t[0],n.min.y=n.max.y=t[1],n.min.z=n.max.z=t[2]);for(var o=3,u=t.length;o<u;o+=3)r=t[o],i=t[o+1],s=t[o+2],r<n.min.x?n.min.x=r:r>n.max.x&&(n.max.x=r),i<n.min.y?n.min.y=i:i>n.max.y&&(n.max.y=i),s<n.min.z?n.min.z=s:s>n.max.z&&(n.max.z=s)}if(void 0===t||0===t.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere);var t=this.attributes.position.array;if(t){for(var n,r=0,i,s,o=0,u=t.length;o<u;o+=3)n=t[o],i=t[o+1],s=t[o+2],n=n*n+i*i+s*s,n>r&&(r=n);this.boundingSphere.radius=Math.sqrt(r)}},computeVertexNormals:function(){if(this.attributes.position){var t,n,r,i;t=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(t),numItems:t};else{t=0;for(n=this.attributes.normal.array.length;t<n;t++)this.attributes.normal.array[t]=0}var s=this.attributes.position.array,o=this.attributes.normal.array,u,a,f,l,c,h,p=new e.Vector3,d=new e.Vector3,v=new e.Vector3,m=new e.Vector3,g=new e.Vector3;if(this.attributes.index){var y=this.attributes.index.array,b=this.offsets;r=0;for(i=b.length;r<i;++r){n=b[r].start,u=b[r].count;var w=b[r].index;t=n;for(n+=u;t<n;t+=3)u=w+y[t],a=w+y[t+1],f=w+y[t+2],l=s[3*u],c=s[3*u+1],h=s[3*u+2],p.set(l,c,h),l=s[3*a],c=s[3*a+1],h=s[3*a+2],d.set(l,c,h),l=s[3*f],c=s[3*f+1],h=s[3*f+2],v.set(l,c,h),m.subVectors(v,d),g.subVectors(p,d),m.cross(g),o[3*u]+=m.x,o[3*u+1]+=m.y,o[3*u+2]+=m.z,o[3*a]+=m.x,o[3*a+1]+=m.y,o[3*a+2]+=m.z,o[3*f]+=m.x,o[3*f+1]+=m.y,o[3*f+2]+=m.z}}else{t=0;for(n=s.length;t<n;t+=9)l=s[t],c=s[t+1],h=s[t+2],p.set(l,c,h),l=s[t+3],c=s[t+4],h=s[t+5],d.set(l,c,h),l=s[t+6],c=s[t+7],h=s[t+8],v.set(l,c,h),m.subVectors(v,d),g.subVectors(p,d),m.cross(g),o[t]=m.x,o[t+1]=m.y,o[t+2]=m.z,o[t+3]=m.x,o[t+4]=m.y,o[t+5]=m.z,o[t+6]=m.x,o[t+7]=m.y,o[t+8]=m.z}this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e=this.attributes.normal.array,t,n,r,i=0,s=e.length;i<s;i+=3)t=e[i],n=e[i+1],r=e[i+2],t=1/Math.sqrt(t*t+n*n+r*r),e[i]*=t,e[i+1]*=t,e[i+2]*=t},computeTangents:function(){function t(e){j.x=i[3*e],j.y=i[3*e+1],j.z=i[3*e+2],F.copy(j),q=f[e],H.copy(q),H.sub(j.multiplyScalar(j.dot(q))).normalize(),B.crossVectors(F,q),R=B.dot(l[e]),I=0>R?-1:1,a[4*e]=H.x,a[4*e+1]=H.y,a[4*e+2]=H.z,a[4*e+3]=I}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var n=this.attributes.index.array,r=this.attributes.position.array,i=this.attributes.normal.array,s=this.attributes.uv.array,o=r.length/3;if(void 0===this.attributes.tangent){var u=4*o;this.attributes.tangent={itemSize:4,array:new Float32Array(u),numItems:u}}for(var a=this.attributes.tangent.array,f=[],l=[],u=0;u<o;u++)f[u]=new e.Vector3,l[u]=new e.Vector3;var c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,o=new e.Vector3,u=new e.Vector3,C,k,L,A,O,M,_,D=this.offsets;L=0;for(A=D.length;L<A;++L){k=D[L].start,O=D[L].count;var P=D[L].index;C=k;for(k+=O;C<k;C+=3)O=P+n[C],M=P+n[C+1],_=P+n[C+2],c=r[3*O],h=r[3*O+1],p=r[3*O+2],d=r[3*M],v=r[3*M+1],m=r[3*M+2],g=r[3*_],y=r[3*_+1],b=r[3*_+2],w=s[2*O],E=s[2*O+1],S=s[2*M],x=s[2*M+1],T=s[2*_],N=s[2*_+1],d-=c,c=g-c,v-=h,h=y-h,m-=p,p=b-p,S-=w,w=T-w,x-=E,E=N-E,N=1/(S*E-w*x),o.set((E*d-x*c)*N,(E*v-x*h)*N,(E*m-x*p)*N),u.set((S*c-w*d)*N,(S*h-w*v)*N,(S*p-w*m)*N),f[O].add(o),f[M].add(o),f[_].add(o),l[O].add(u),l[M].add(u),l[_].add(u)}var H=new e.Vector3,B=new e.Vector3,j=new e.Vector3,F=new e.Vector3,I,q,R;L=0;for(A=D.length;L<A;++L){k=D[L].start,O=D[L].count,P=D[L].index,C=k;for(k+=O;C<k;C+=3)O=P+n[C],M=P+n[C+1],_=P+n[C+2],t(O),t(M),t(_)}this.tangentsNeedUpdate=this.hasTangents=!0}},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.Camera=function(){e.Object3D.call(this),this.matrixWorldInverse=new e.Matrix4,this.projectionMatrix=new e.Matrix4,this.projectionMatrixInverse=new e.Matrix4},e.Camera.prototype=Object.create(e.Object3D.prototype),e.Camera.prototype.lookAt=function(){var t=new e.Matrix4;return function(e){t.lookAt(this.position,e,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),e.OrthographicCamera=function(t,n,r,i,s,o){e.Camera.call(this),this.left=t,this.right=n,this.top=r,this.bottom=i,this.near=void 0!==s?s:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},e.OrthographicCamera.prototype=Object.create(e.Camera.prototype),e.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},e.PerspectiveCamera=function(t,n,r,i){e.Camera.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==n?n:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype=Object.create(e.Camera.prototype),e.PerspectiveCamera.prototype.setLens=function(t,n){void 0===n&&(n=24),this.fov=2*e.Math.radToDeg(Math.atan(n/(2*t))),this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,n=Math.tan(e.Math.degToRad(.5*this.fov))*this.near,r=-n,i=t*r,t=Math.abs(t*n-i),r=Math.abs(n-r);this.projectionMatrix.makeFrustum(i+this.x*t/this.fullWidth,i+(this.x+this.width)*t/this.fullWidth,n-(this.y+this.height)*r/this.fullHeight,n-this.y*r/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},e.Light=function(t){e.Object3D.call(this),this.color=new e.Color(t)},e.Light.prototype=Object.create(e.Object3D.prototype),e.Light.prototype.clone=function(t){return void 0===t&&(t=new e.Light),e.Object3D.prototype.clone.call(this,t),t.color.copy(this.color),t},e.AmbientLight=function(t){e.Light.call(this,t)},e.AmbientLight.prototype=Object.create(e.Light.prototype),e.AmbientLight.prototype.clone=function(){var t=new e.AmbientLight;return e.Light.prototype.clone.call(this,t),t},e.AreaLight=function(t,n){e.Light.call(this,t),this.normal=new e.Vector3(0,-1,0),this.right=new e.Vector3(1,0,0),this.intensity=void 0!==n?n:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},e.AreaLight.prototype=Object.create(e.Light.prototype),e.DirectionalLight=function(t,n){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=void 0!==n?n:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new e.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},e.DirectionalLight.prototype=Object.create(e.Light.prototype),e.DirectionalLight.prototype.clone=function(){var t=new e.DirectionalLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},e.HemisphereLight=function(t,n,r){e.Light.call(this,t),this.position.set(0,100,0),this.groundColor=new e.Color(n),this.intensity=void 0!==r?r:1},e.HemisphereLight.prototype=Object.create(e.Light.prototype),e.HemisphereLight.prototype.clone=function(){var t=new e.PointLight;return e.Light.prototype.clone.call(this,t),t.groundColor.copy(this.groundColor),t.intensity=this.intensity,t},e.PointLight=function(t,n,r){e.Light.call(this,t),this.intensity=void 0!==n?n:1,this.distance=void 0!==r?r:0},e.PointLight.prototype=Object.create(e.Light.prototype),e.PointLight.prototype.clone=function(){var t=new e.PointLight;return e.Light.prototype.clone.call(this,t),t.intensity=this.intensity,t.distance=this.distance,t},e.SpotLight=function(t,n,r,i,s){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=void 0!==n?n:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==s?s:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},e.SpotLight.prototype=Object.create(e.Light.prototype),e.SpotLight.prototype.clone=function(){var t=new e.SpotLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.distance=this.distance,t.angle=this.angle,t.exponent=this.exponent,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t},e.Loader=function(t){this.statusDomElement=(this.showStatus=t)?e.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},e.Loader.prototype={constructor:e.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(1>e.length?".":e.join("/"))+"/"},initMaterials:function(t,n){for(var r=[],i=0;i<t.length;++i)r[i]=e.Loader.prototype.createMaterial(t[i],n);return r},needsTangents:function(t){for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof e.ShaderMaterial)return!0;return!1},createMaterial:function(t,n){function r(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function i(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function s(t,s,o,a,f,l,h){var p=/\.dds$/i.test(o),v=n+"/"+o;if(p){var m=e.ImageUtils.loadCompressedTexture(v);t[s]=m}else m=document.createElement("canvas"),t[s]=new e.Texture(m);t[s].sourceFile=o,a&&(t[s].repeat.set(a[0],a[1]),1!==a[0]&&(t[s].wrapS=e.RepeatWrapping),1!==a[1]&&(t[s].wrapT=e.RepeatWrapping)),f&&t[s].offset.set(f[0],f[1]),l&&(o={repeat:e.RepeatWrapping,mirror:e.MirroredRepeatWrapping},void 0!==o[l[0]]&&(t[s].wrapS=o[l[0]]),void 0!==o[l[1]]&&(t[s].wrapT=o[l[1]])),h&&(t[s].anisotropy=h);if(!p){var y=t[s],t=new Image;t.onload=function(){if(!r(this.width)||!r(this.height)){var e=i(this.width),t=i(this.height);y.image.width=e,y.image.height=t,y.image.getContext("2d").drawImage(this,0,0,e,t)}else y.image=this;y.needsUpdate=!0},t.crossOrigin=u.crossOrigin,t.src=v}}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var u=this,a="MeshLambertMaterial",f={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(t.shading){var l=t.shading.toLowerCase();"phong"===l?a="MeshPhongMaterial":"basic"===l&&(a="MeshBasicMaterial")}void 0!==t.blending&&void 0!==e[t.blending]&&(f.blending=e[t.blending]);if(void 0!==t.transparent||1>t.opacity)f.transparent=t.transparent;return void 0!==t.depthTest&&(f.depthTest=t.depthTest),void 0!==t.depthWrite&&(f.depthWrite=t.depthWrite),void 0!==t.visible&&(f.visible=t.visible),void 0!==t.flipSided&&(f.side=e.BackSide),void 0!==t.doubleSided&&(f.side=e.DoubleSide),void 0!==t.wireframe&&(f.wireframe=t.wireframe),void 0!==t.vertexColors&&("face"===t.vertexColors?f.vertexColors=e.FaceColors:t.vertexColors&&(f.vertexColors=e.VertexColors)),t.colorDiffuse?f.color=o(t.colorDiffuse):t.DbgColor&&(f.color=t.DbgColor),t.colorSpecular&&(f.specular=o(t.colorSpecular)),t.colorAmbient&&(f.ambient=o(t.colorAmbient)),t.transparency&&(f.opacity=t.transparency),t.specularCoef&&(f.shininess=t.specularCoef),t.mapDiffuse&&n&&s(f,"map",t.mapDiffuse,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy),t.mapLight&&n&&s(f,"lightMap",t.mapLight,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy),t.mapBump&&n&&s(f,"bumpMap",t.mapBump,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy),t.mapNormal&&n&&s(f,"normalMap",t.mapNormal,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy),t.mapSpecular&&n&&s(f,"specularMap",t.mapSpecular,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy),t.mapBumpScale&&(f.bumpScale=t.mapBumpScale),t.mapNormal?(a=e.ShaderLib.normalmap,l=e.UniformsUtils.clone(a.uniforms),l.tNormal.value=f.normalMap,t.mapNormalFactor&&l.uNormalScale.value.set(t.mapNormalFactor,t.mapNormalFactor),f.map&&(l.tDiffuse.value=f.map,l.enableDiffuse.value=!0),f.specularMap&&(l.tSpecular.value=f.specularMap,l.enableSpecular.value=!0),f.lightMap&&(l.tAO.value=f.lightMap,l.enableAO.value=!0),l.uDiffuseColor.value.setHex(f.color),l.uSpecularColor.value.setHex(f.specular),l.uAmbientColor.value.setHex(f.ambient),l.uShininess.value=f.shininess,void 0!==f.opacity&&(l.uOpacity.value=f.opacity),a=new e.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:l,lights:!0,fog:!0}),f.transparent&&(a.transparent=!0)):a=new e[a](f),void 0!==t.DbgName&&(a.name=t.DbgName),a}},e.ImageLoader=function(){this.crossOrigin=null},e.ImageLoader.prototype={constructor:e.ImageLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(e,t){var n=this;void 0===t&&(t=new Image),t.addEventListener("load",function(){n.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){n.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),n.crossOrigin&&(t.crossOrigin=n.crossOrigin),t.src=e}},e.JSONLoader=function(t){e.Loader.call(this,t),this.withCredentials=!1},e.JSONLoader.prototype=Object.create(e.Loader.prototype),e.JSONLoader.prototype.load=function(e,t,n){n=n&&"string"==typeof n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},e.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(200===s.status||0===s.status){if(s.responseText){var u=JSON.parse(s.responseText),u=e.parse(u,r);n(u.geometry,u.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+s.status+"]");else s.readyState===s.LOADING?i&&(0===o&&(o=s.getResponseHeader("Content-Length")),i({total:o,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&void 0!==i&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.withCredentials=this.withCredentials,s.send(null)},e.JSONLoader.prototype.parse=function(t,n){var r=new e.Geometry,i=void 0!==t.scale?1/t.scale:1,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=t.faces;d=t.vertices;var E=t.normals,S=t.colors,x=0;for(s=0;s<t.uvs.length;s++)t.uvs[s].length&&x++;for(s=0;s<x;s++)r.faceUvs[s]=[],r.faceVertexUvs[s]=[];a=0;for(f=d.length;a<f;)l=new e.Vector3,l.x=d[a++]*i,l.y=d[a++]*i,l.z=d[a++]*i,r.vertices.push(l);a=0;for(f=w.length;a<f;){d=w[a++],l=d&1,u=d&2,s=d&4,o=d&8,h=d&16,c=d&32,v=d&64,d&=128,l?(m=new e.Face4,m.a=w[a++],m.b=w[a++],m.c=w[a++],m.d=w[a++],l=4):(m=new e.Face3,m.a=w[a++],m.b=w[a++],m.c=w[a++],l=3),u&&(u=w[a++],m.materialIndex=u),u=r.faces.length;if(s)for(s=0;s<x;s++)g=t.uvs[s],p=w[a++],b=g[2*p],p=g[2*p+1],r.faceUvs[s][u]=new e.Vector2(b,p);if(o)for(s=0;s<x;s++){g=t.uvs[s],y=[];for(o=0;o<l;o++)p=w[a++],b=g[2*p],p=g[2*p+1],y[o]=new e.Vector2(b,p);r.faceVertexUvs[s][u]=y}h&&(h=3*w[a++],o=new e.Vector3,o.x=E[h++],o.y=E[h++],o.z=E[h],m.normal=o);if(c)for(s=0;s<l;s++)h=3*w[a++],o=new e.Vector3,o.x=E[h++],o.y=E[h++],o.z=E[h],m.vertexNormals.push(o);v&&(c=w[a++],c=new e.Color(S[c]),m.color=c);if(d)for(s=0;s<l;s++)c=w[a++],c=new e.Color(S[c]),m.vertexColors.push(c);r.faces.push(m)}if(t.skinWeights){a=0;for(f=t.skinWeights.length;a<f;a+=2)w=t.skinWeights[a],E=t.skinWeights[a+1],r.skinWeights.push(new e.Vector4(w,E,0,0))}if(t.skinIndices){a=0;for(f=t.skinIndices.length;a<f;a+=2)w=t.skinIndices[a],E=t.skinIndices[a+1],r.skinIndices.push(new e.Vector4(w,E,0,0))}r.bones=t.bones,r.animation=t.animation;if(void 0!==t.morphTargets){a=0;for(f=t.morphTargets.length;a<f;a++){r.morphTargets[a]={},r.morphTargets[a].name=t.morphTargets[a].name,r.morphTargets[a].vertices=[],S=r.morphTargets[a].vertices,x=t.morphTargets[a].vertices,w=0;for(E=x.length;w<E;w+=3)d=new e.Vector3,d.x=x[w]*i,d.y=x[w+1]*i,d.z=x[w+2]*i,S.push(d)}}if(void 0!==t.morphColors){a=0;for(f=t.morphColors.length;a<f;a++){r.morphColors[a]={},r.morphColors[a].name=t.morphColors[a].name,r.morphColors[a].colors=[],E=r.morphColors[a].colors,S=t.morphColors[a].colors,i=0;for(w=S.length;i<w;i+=3)x=new e.Color(16755200),x.setRGB(S[i],S[i+1],S[i+2]),E.push(x)}}return r.computeCentroids(),r.computeFaceNormals(),void 0===t.materials?{geometry:r}:(i=this.initMaterials(t.materials,n),this.needsTangents(i)&&r.computeTangents(),{geometry:r,materials:i})},e.LoadingMonitor=function(){var e=this,t=0,n=0,r=function(){t++,e.dispatchEvent({type:"progress",loaded:t,total:n}),t===n&&e.dispatchEvent({type:"load"})};this.add=function(e){n++,e.addEventListener("load",r,!1)}},e.LoadingMonitor.prototype={constructor:e.LoadingMonitor,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent},e.GeometryLoader=function(){},e.GeometryLoader.prototype={constructor:e.GeometryLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,n=new XMLHttpRequest;n.addEventListener("load",function(e){e=t.parse(JSON.parse(e.target.responseText)),t.dispatchEvent({type:"load",content:e})},!1),n.addEventListener("progress",function(e){t.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),n.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),n.open("GET",e,!0),n.send(null)},parse:function(){}},e.MaterialLoader=function(){},e.MaterialLoader.prototype={constructor:e.MaterialLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,n=new XMLHttpRequest;n.addEventListener("load",function(e){e=t.parse(JSON.parse(e.target.responseText)),t.dispatchEvent({type:"load",content:e})},!1),n.addEventListener("progress",function(e){t.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),n.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),n.open("GET",e,!0),n.send(null)},parse:function(t){var n;switch(t.type){case"MeshBasicMaterial":n=new e.MeshBasicMaterial({color:t.color,opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshLambertMaterial":n=new e.MeshLambertMaterial({color:t.color,ambient:t.ambient,emissive:t.emissive,opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshPhongMaterial":n=new e.MeshPhongMaterial({color:t.color,ambient:t.ambient,emissive:t.emissive,specular:t.specular,shininess:t.shininess,opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshNormalMaterial":n=new e.MeshNormalMaterial({opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe});break;case"MeshDepthMaterial":n=new e.MeshDepthMaterial({opacity:t.opacity,transparent:t.transparent,wireframe:t.wireframe})}return n}},e.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",e.JSONLoader)},e.SceneLoader.prototype.constructor=e.SceneLoader,e.SceneLoader.prototype.load=function(e,t){var n=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status){var i=JSON.parse(r.responseText);n.parse(i,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+r.status+"]")},r.open("GET",e,!0),r.send(null)},e.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},e.SceneLoader.prototype.addHierarchyHandler=function(e,t){this.hierarchyHandlerMap[e]={loaderClass:t}},e.SceneLoader.prototype.parse=function(t,n,r){function i(e,t){return"relativeToHTML"==t?e:h+"/"+e}function s(){o(N.scene,k.objects)}function o(t,n){var r,s,u,f,l,h,m;for(m in n)if(void 0===N.objects[m]){var g=n[m],E=null;if(g.type&&g.type in c.hierarchyHandlerMap){if(void 0===g.loading){s={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},u={};for(var S in g)S in s||(u[S]=g[S]);d=N.materials[g.material],g.loading=!0,s=c.hierarchyHandlerMap[g.type].loaderObject,s.options?s.load(i(g.url,k.urlBaseType),a(m,t,d,g)):s.load(i(g.url,k.urlBaseType),a(m,t,d,g),u)}}else if(void 0!==g.geometry){if(p=N.geometries[g.geometry]){E=!1,d=N.materials[g.material],E=d instanceof e.ShaderMaterial,u=g.position,f=g.rotation,l=g.scale,r=g.matrix,h=g.quaternion,g.material||(d=new e.MeshFaceMaterial(N.face_materials[g.geometry])),d instanceof e.MeshFaceMaterial&&0===d.materials.length&&(d=new e.MeshFaceMaterial(N.face_materials[g.geometry]));if(d instanceof e.MeshFaceMaterial)for(s=0;s<d.materials.length;s++)E=E||d.materials[s]instanceof e.ShaderMaterial;E&&p.computeTangents(),g.skin?E=new e.SkinnedMesh(p,d):g.morph?(E=new e.MorphAnimMesh(p,d),void 0!==g.duration&&(E.duration=g.duration),void 0!==g.time&&(E.time=g.time),void 0!==g.mirroredLoop&&(E.mirroredLoop=g.mirroredLoop),d.morphNormals&&p.computeMorphNormals()):E=new e.Mesh(p,d),E.name=m,r?(E.matrixAutoUpdate=!1,E.matrix.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])):(E.position.set(u[0],u[1],u[2]),h?(E.quaternion.set(h[0],h[1],h[2],h[3]),E.useQuaternion=!0):E.rotation.set(f[0],f[1],f[2]),E.scale.set(l[0],l[1],l[2])),E.visible=g.visible,E.castShadow=g.castShadow,E.receiveShadow=g.receiveShadow,t.add(E),N.objects[m]=E}}else"DirectionalLight"===g.type||"PointLight"===g.type||"AmbientLight"===g.type?(b=void 0!==g.color?g.color:16777215,w=void 0!==g.intensity?g.intensity:1,"DirectionalLight"===g.type?(u=g.direction,y=new e.DirectionalLight(b,w),y.position.set(u[0],u[1],u[2]),g.target&&(C.push({object:y,targetName:g.target}),y.target=null)):"PointLight"===g.type?(u=g.position,s=g.distance,y=new e.PointLight(b,w,s),y.position.set(u[0],u[1],u[2])):"AmbientLight"===g.type&&(y=new e.AmbientLight(b)),t.add(y),y.name=m,N.lights[m]=y,N.objects[m]=y):"PerspectiveCamera"===g.type||"OrthographicCamera"===g.type?(u=g.position,f=g.rotation,h=g.quaternion,"PerspectiveCamera"===g.type?v=new e.PerspectiveCamera(g.fov,g.aspect,g.near,g.far):"OrthographicCamera"===g.type&&(v=new e.OrthographicCamera(g.left,g.right,g.top,g.bottom,g.near,g.far)),v.name=m,v.position.set(u[0],u[1],u[2]),void 0!==h?(v.quaternion.set(h[0],h[1],h[2],h[3]),v.useQuaternion=!0):void 0!==f&&v.rotation.set(f[0],f[1],f[2]),t.add(v),N.cameras[m]=v,N.objects[m]=v):(u=g.position,f=g.rotation,l=g.scale,h=g.quaternion,E=new e.Object3D,E.name=m,E.position.set(u[0],u[1],u[2]),h?(E.quaternion.set(h[0],h[1],h[2],h[3]),E.useQuaternion=!0):E.rotation.set(f[0],f[1],f[2]),E.scale.set(l[0],l[1],l[2]),E.visible=void 0!==g.visible?g.visible:!1,t.add(E),N.objects[m]=E,N.empties[m]=E);if(E){if(void 0!==g.userData)for(var x in g.userData)E.userData[x]=g.userData[x];if(void 0!==g.groups)for(s=0;s<g.groups.length;s++)u=g.groups[s],void 0===N.groups[u]&&(N.groups[u]=[]),N.groups[u].push(m);void 0!==g.children&&o(E,g.children)}}}function u(e){return function(t,n){t.name=e,N.geometries[e]=t,N.face_materials[e]=n,s(),E-=1,c.onLoadComplete(),l()}}function a(e,t,n,r){return function(i){var i=i.content?i.content:i.dae?i.scene:i,o=r.position,u=r.rotation,a=r.quaternion,f=r.scale;i.position.set(o[0],o[1],o[2]),a?(i.quaternion.set(a[0],a[1],a[2],a[3]),i.useQuaternion=!0):i.rotation.set(u[0],u[1],u[2]),i.scale.set(f[0],f[1],f[2]),n&&i.traverse(function(e){e.material=n});var h=void 0!==r.visible?r.visible:!0;i.traverse(function(e){e.visible=h}),t.add(i),i.name=e,N.objects[e]=i,s(),E-=1,c.onLoadComplete(),l()}}function f(e){return function(t,n){t.name=e,N.geometries[e]=t,N.face_materials[e]=n}}function l(){c.callbackProgress({totalModels:x,totalTextures:T,loadedModels:x-E,loadedTextures:T-S},N),c.onLoadProgress();if(0===E&&0===S){for(var t=0;t<C.length;t++){var r=C[t],i=N.objects[r.targetName];i?r.object.target=i:(r.object.target=new e.Object3D,N.scene.add(r.object.target)),r.object.target.userData.targetInverse=r.object}n(N)}}var c=this,h=e.Loader.prototype.extractUrlBase(r),p,d,v,m,g,y,b,w,E,S,x,T,N,C=[],k=t,L;for(L in this.geometryHandlerMap)t=this.geometryHandlerMap[L].loaderClass,this.geometryHandlerMap[L].loaderObject=new t;for(L in this.hierarchyHandlerMap)t=this.hierarchyHandlerMap[L].loaderClass,this.hierarchyHandlerMap[L].loaderObject=new t;S=E=0,N={scene:new e.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},k.transform&&(L=k.transform.position,t=k.transform.rotation,r=k.transform.scale,L&&N.scene.position.set(L[0],L[1],L[2]),t&&N.scene.rotation.set(t[0],t[1],t[2]),r&&N.scene.scale.set(r[0],r[1],r[2]),L||t||r)&&(N.scene.updateMatrix(),N.scene.updateMatrixWorld()),L=function(e){return function(){S-=e,l(),c.onLoadComplete()}};for(var A in k.fogs)t=k.fogs[A],"linear"===t.type?m=new e.Fog(0,t.near,t.far):"exp2"===t.type&&(m=new e.FogExp2(0,t.density)),t=t.color,m.color.setRGB(t[0],t[1],t[2]),N.fogs[A]=m;for(var O in k.geometries)m=k.geometries[O],m.type in this.geometryHandlerMap&&(E+=1,c.onLoadStart());for(var M in k.objects)m=k.objects[M],m.type&&m.type in this.hierarchyHandlerMap&&(E+=1,c.onLoadStart());x=E;for(O in k.geometries)if(m=k.geometries[O],"cube"===m.type)p=new e.CubeGeometry(m.width,m.height,m.depth,m.widthSegments,m.heightSegments,m.depthSegments),p.name=O,N.geometries[O]=p;else if("plane"===m.type)p=new e.PlaneGeometry(m.width,m.height,m.widthSegments,m.heightSegments),p.name=O,N.geometries[O]=p;else if("sphere"===m.type)p=new e.SphereGeometry(m.radius,m.widthSegments,m.heightSegments),p.name=O,N.geometries[O]=p;else if("cylinder"===m.type)p=new e.CylinderGeometry(m.topRad,m.botRad,m.height,m.radSegs,m.heightSegs),p.name=O,N.geometries[O]=p;else if("torus"===m.type)p=new e.TorusGeometry(m.radius,m.tube,m.segmentsR,m.segmentsT),p.name=O,N.geometries[O]=p;else if("icosahedron"===m.type)p=new e.IcosahedronGeometry(m.radius,m.subdivisions),p.name=O,N.geometries[O]=p;else if(m.type in this.geometryHandlerMap){M={};for(g in m)"type"!==g&&"url"!==g&&(M[g]=m[g]);this.geometryHandlerMap[m.type].loaderObject.load(i(m.url,k.urlBaseType),u(O),M)}else"embedded"===m.type&&(M=k.embeds[m.id],M.metadata=k.metadata,M&&(M=this.geometryHandlerMap.ascii.loaderObject.parse(M,""),f(O)(M.geometry,M.materials)));for(var _ in k.textures)if(O=k.textures[_],O.url instanceof Array){S+=O.url.length;for(g=0;g<O.url.length;g++)c.onLoadStart()}else S+=1,c.onLoadStart();T=S;for(_ in k.textures){O=k.textures[_],void 0!==O.mapping&&void 0!==e[O.mapping]&&(O.mapping=new e[O.mapping]);if(O.url instanceof Array){M=O.url.length,m=[];for(g=0;g<M;g++)m[g]=i(O.url[g],k.urlBaseType);g=(g=/\.dds$/i.test(m[0]))?e.ImageUtils.loadCompressedTextureCube(m,O.mapping,L(M)):e.ImageUtils.loadTextureCube(m,O.mapping,L(M))}else g=/\.dds$/i.test(O.url),M=i(O.url,k.urlBaseType),m=L(1),g=g?e.ImageUtils.loadCompressedTexture(M,O.mapping,m):e.ImageUtils.loadTexture(M,O.mapping,m),void 0!==e[O.minFilter]&&(g.minFilter=e[O.minFilter]),void 0!==e[O.magFilter]&&(g.magFilter=e[O.magFilter]),O.anisotropy&&(g.anisotropy=O.anisotropy),O.repeat&&(g.repeat.set(O.repeat[0],O.repeat[1]),1!==O.repeat[0]&&(g.wrapS=e.RepeatWrapping),1!==O.repeat[1]&&(g.wrapT=e.RepeatWrapping)),O.offset&&g.offset.set(O.offset[0],O.offset[1]),O.wrap&&(M={repeat:e.RepeatWrapping,mirror:e.MirroredRepeatWrapping},void 0!==M[O.wrap[0]]&&(g.wrapS=M[O.wrap[0]]),void 0!==M[O.wrap[1]]&&(g.wrapT=M[O.wrap[1]]));N.textures[_]=g}var D,P;for(D in k.materials){_=k.materials[D];for(P in _.parameters)"envMap"===P||"map"===P||"lightMap"===P||"bumpMap"===P?_.parameters[P]=N.textures[_.parameters[P]]:"shading"===P?_.parameters[P]="flat"===_.parameters[P]?e.FlatShading:e.SmoothShading:"side"===P?_.parameters[P]="double"==_.parameters[P]?e.DoubleSide:"back"==_.parameters[P]?e.BackSide:e.FrontSide:"blending"===P?_.parameters[P]=_.parameters[P]in e?e[_.parameters[P]]:e.NormalBlending:"combine"===P?_.parameters[P]=_.parameters[P]in e?e[_.parameters[P]]:e.MultiplyOperation:"vertexColors"===P?"face"==_.parameters[P]?_.parameters[P]=e.FaceColors:_.parameters[P]&&(_.parameters[P]=e.VertexColors):"wrapRGB"===P&&(L=_.parameters[P],_.parameters[P]=new e.Vector3(L[0],L[1],L[2]));void 0!==_.parameters.opacity&&1>_.parameters.opacity&&(_.parameters.transparent=!0),_.parameters.normalMap?(L=e.ShaderLib.normalmap,O=e.UniformsUtils.clone(L.uniforms),g=_.parameters.color,M=_.parameters.specular,m=_.parameters.ambient,A=_.parameters.shininess,O.tNormal.value=N.textures[_.parameters.normalMap],_.parameters.normalScale&&O.uNormalScale.value.set(_.parameters.normalScale[0],_.parameters.normalScale[1]),_.parameters.map&&(O.tDiffuse.value=_.parameters.map,O.enableDiffuse.value=!0),_.parameters.envMap&&(O.tCube.value=_.parameters.envMap,O.enableReflection.value=!0,O.uReflectivity.value=_.parameters.reflectivity),_.parameters.lightMap&&(O.tAO.value=_.parameters.lightMap,O.enableAO.value=!0),_.parameters.specularMap&&(O.tSpecular.value=N.textures[_.parameters.specularMap],O.enableSpecular.value=!0),_.parameters.displacementMap&&(O.tDisplacement.value=N.textures[_.parameters.displacementMap],O.enableDisplacement.value=!0,O.uDisplacementBias.value=_.parameters.displacementBias,O.uDisplacementScale.value=_.parameters.displacementScale),O.uDiffuseColor.value.setHex(g),O.uSpecularColor.value.setHex(M),O.uAmbientColor.value.setHex(m),O.uShininess.value=A,_.parameters.opacity&&(O.uOpacity.value=_.parameters.opacity),d=new e.ShaderMaterial({fragmentShader:L.fragmentShader,vertexShader:L.vertexShader,uniforms:O,lights:!0,fog:!0})):d=new e[_.type](_.parameters),d.name=D,N.materials[D]=d}for(D in k.materials)if(_=k.materials[D],_.parameters.materials){P=[];for(g=0;g<_.parameters.materials.length;g++)P.push(N.materials[_.parameters.materials[g]]);N.materials[D].materials=P}s(),N.cameras&&k.defaults.camera&&(N.currentCamera=N.cameras[k.defaults.camera]),N.fogs&&k.defaults.fog&&(N.scene.fog=N.fogs[k.defaults.fog]),c.callbackSync(N),l()},e.TextureLoader=function(){this.crossOrigin=null},e.TextureLoader.prototype={constructor:e.TextureLoader,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,load:function(t){var n=this,r=new Image;r.addEventListener("load",function(){var t=new e.Texture(r);t.needsUpdate=!0,n.dispatchEvent({type:"load",content:t})},!1),r.addEventListener("error",function(){n.dispatchEvent({type:"error",message:"Couldn't load URL ["+t+"]"})},!1),n.crossOrigin&&(r.crossOrigin=n.crossOrigin),r.src=t}},e.Material=function(){this.id=e.MaterialIdCount++,this.name="",this.side=e.FrontSide,this.opacity=1,this.transparent=!1,this.blending=e.NormalBlending,this.blendSrc=e.SrcAlphaFactor,this.blendDst=e.OneMinusSrcAlphaFactor,this.blendEquation=e.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.overdraw=!1,this.needsUpdate=this.visible=!0},e.Material.prototype={constructor:e.Material,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,setValues:function(t){if(void 0!==t)for(var n in t){var r=t[n];if(void 0===r)console.warn("THREE.Material: '"+n+"' parameter is undefined.");else if(n in this){var i=this[n];i instanceof e.Color?i.set(r):i instanceof e.Vector3&&r instanceof e.Vector3?i.copy(r):this[n]=r}}},clone:function(t){return void 0===t&&(t=new e.Material),t.name=this.name,t.side=this.side,t.opacity=this.opacity,t.transparent=this.transparent,t.blending=this.blending,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.overdraw=this.overdraw,t.visible=this.visible,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.MaterialIdCount=0,e.LineBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineBasicMaterial.prototype=Object.create(e.Material.prototype),e.LineBasicMaterial.prototype.clone=function(){var t=new e.LineBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.linecap=this.linecap,t.linejoin=this.linejoin,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.LineDashedMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineDashedMaterial.prototype=Object.create(e.Material.prototype),e.LineDashedMaterial.prototype.clone=function(){var t=new e.LineDashedMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.scale=this.scale,t.dashSize=this.dashSize,t.gapSize=this.gapSize,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.MeshBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshBasicMaterial.prototype=Object.create(e.Material.prototype),e.MeshBasicMaterial.prototype.clone=function(){var t=new e.MeshBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t},e.MeshLambertMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.wrapAround=!1,this.wrapRGB=new e.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshLambertMaterial.prototype=Object.create(e.Material.prototype),e.MeshLambertMaterial.prototype.clone=function(){var t=new e.MeshLambertMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshPhongMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.specular=new e.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new e.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new e.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshPhongMaterial.prototype=Object.create(e.Material.prototype),e.MeshPhongMaterial.prototype.clone=function(){var t=new e.MeshPhongMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.perPixel=this.perPixel,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalMap=this.normalMap,t.normalScale.copy(this.normalScale),t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshDepthMaterial=function(t){e.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)},e.MeshDepthMaterial.prototype=Object.create(e.Material.prototype),e.MeshDepthMaterial.prototype.clone=function(){var t=new e.MeshDepthMaterial;return e.Material.prototype.clone.call(this,t),t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshNormalMaterial=function(t){e.Material.call(this,t),this.shading=e.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},e.MeshNormalMaterial.prototype=Object.create(e.Material.prototype),e.MeshNormalMaterial.prototype.clone=function(){var t=new e.MeshNormalMaterial;return e.Material.prototype.clone.call(this,t),t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},e.MeshFaceMaterial.prototype.clone=function(){return new e.MeshFaceMaterial(this.materials.slice(0))},e.ParticleBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.ParticleBasicMaterial.prototype=Object.create(e.Material.prototype),e.ParticleBasicMaterial.prototype.clone=function(){var t=new e.ParticleBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.ParticleCanvasMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.program=function(){},this.setValues(t)},e.ParticleCanvasMaterial.prototype=Object.create(e.Material.prototype),e.ParticleCanvasMaterial.prototype.clone=function(){var t=new e.ParticleCanvasMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.program=this.program,t},e.ShaderMaterial=function(t){e.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=e.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.ShaderMaterial.prototype=Object.create(e.Material.prototype),e.ShaderMaterial.prototype.clone=function(){var t=new e.ShaderMaterial;return e.Material.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=e.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.SpriteMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=new e.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=e.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new e.Vector2(0,0),this.uvScale=new e.Vector2(1,1),this.setValues(t),t=t||{},void 0===t.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===t.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===t.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},e.SpriteMaterial.prototype=Object.create(e.Material.prototype),e.SpriteMaterial.prototype.clone=function(){var t=new e.SpriteMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.useScreenCoordinates=this.useScreenCoordinates,t.sizeAttenuation=this.sizeAttenuation,t.scaleByViewport=this.scaleByViewport,t.alignment.copy(this.alignment),t.uvOffset.copy(this.uvOffset),t.uvScale.copy(this.uvScale),t.fog=this.fog,t},e.SpriteAlignment={},e.SpriteAlignment.topLeft=new e.Vector2(1,-1),e.SpriteAlignment.topCenter=new e.Vector2(0,-1),e.SpriteAlignment.topRight=new e.Vector2(-1,-1),e.SpriteAlignment.centerLeft=new e.Vector2(1,0),e.SpriteAlignment.center=new e.Vector2(0,0),e.SpriteAlignment.centerRight=new e.Vector2(-1,0),e.SpriteAlignment.bottomLeft=new e.Vector2(1,1),e.SpriteAlignment.bottomCenter=new e.Vector2(0,1),e.SpriteAlignment.bottomRight=new e.Vector2(-1,1),e.Texture=function(t,n,r,i,s,o,u,a,f){this.id=e.TextureIdCount++,this.name="",this.image=t,this.mipmaps=[],this.mapping=void 0!==n?n:new e.UVMapping,this.wrapS=void 0!==r?r:e.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:e.ClampToEdgeWrapping,this.magFilter=void 0!==s?s:e.LinearFilter,this.minFilter=void 0!==o?o:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==f?f:1,this.format=void 0!==u?u:e.RGBAFormat,this.type=void 0!==a?a:e.UnsignedByteType,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},e.Texture.prototype={constructor:e.Texture,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,clone:function(t){return void 0===t&&(t=new e.Texture),t.image=this.image,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.unpackAlignment=this.unpackAlignment,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.TextureIdCount=0,e.CompressedTexture=function(t,n,r,i,s,o,u,a,f,l,c){e.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={width:n,height:r},this.mipmaps=t,this.generateMipmaps=!1},e.CompressedTexture.prototype=Object.create(e.Texture.prototype),e.CompressedTexture.prototype.clone=function(){var t=new e.CompressedTexture;return e.Texture.prototype.clone.call(this,t),t},e.DataTexture=function(t,n,r,i,s,o,u,a,f,l,c){e.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={data:t,width:n,height:r}},e.DataTexture.prototype=Object.create(e.Texture.prototype),e.DataTexture.prototype.clone=function(){var t=new e.DataTexture;return e.Texture.prototype.clone.call(this,t),t},e.Particle=function(t){e.Object3D.call(this),this.material=t},e.Particle.prototype=Object.create(e.Object3D.prototype),e.Particle.prototype.clone=function(t){return void 0===t&&(t=new e.Particle(this.material)),e.Object3D.prototype.clone.call(this,t),t},e.ParticleSystem=function(t,n){e.Object3D.call(this),this.geometry=t,this.material=void 0!==n?n:new e.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},e.ParticleSystem.prototype=Object.create(e.Object3D.prototype),e.ParticleSystem.prototype.clone=function(t){return void 0===t&&(t=new e.ParticleSystem(this.geometry,this.material)),t.sortParticles=this.sortParticles,e.Object3D.prototype.clone.call(this,t),t},e.Line=function(t,n,r){e.Object3D.call(this),this.geometry=t,this.material=void 0!==n?n:new e.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:e.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},e.LineStrip=0,e.LinePieces=1,e.Line.prototype=Object.create(e.Object3D.prototype),e.Line.prototype.clone=function(t){return void 0===t&&(t=new e.Line(this.geometry,this.material,this.type)),e.Object3D.prototype.clone.call(this,t),t},e.Mesh=function(t,n){e.Object3D.call(this),this.material=this.geometry=null,this.setGeometry(t),this.setMaterial(n)},e.Mesh.prototype=Object.create(e.Object3D.prototype),e.Mesh.prototype.setGeometry=function(e){void 0!==e&&(this.geometry=e,null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},e.Mesh.prototype.setMaterial=function(t){this.material=void 0!==t?t:new e.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0})},e.Mesh.prototype.updateMorphTargets=function(){if(0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},e.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},e.Mesh.prototype.clone=function(t){return void 0===t&&(t=new e.Mesh(this.geometry,this.material)),e.Object3D.prototype.clone.call(this,t),t},e.Bone=function(t){e.Object3D.call(this),this.skin=t,this.skinMatrix=new e.Matrix4},e.Bone.prototype=Object.create(e.Object3D.prototype),e.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix());if(t||this.matrixWorldNeedsUpdate)e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;var n,r=this.children.length;for(n=0;n<r;n++)this.children[n].update(this.skinMatrix,t)},e.SkinnedMesh=function(t,n,r){e.Mesh.call(this,t,n),this.useVertexTexture=void 0!==r?r:!0,this.identityMatrix=new e.Matrix4,this.bones=[],this.boneMatrices=[];var i,s,o;if(this.geometry&&void 0!==this.geometry.bones){for(t=0;t<this.geometry.bones.length;t++)r=this.geometry.bones[t],i=r.pos,s=r.rotq,o=r.scl,n=this.addBone(),n.name=r.name,n.position.set(i[0],i[1],i[2]),n.quaternion.set(s[0],s[1],s[2],s[3]),n.useQuaternion=!0,void 0!==o?n.scale.set(o[0],o[1],o[2]):n.scale.set(1,1,1);for(t=0;t<this.bones.length;t++)r=this.geometry.bones[t],n=this.bones[t],-1===r.parent?this.add(n):this.bones[r.parent].add(n);t=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=t=256<t?64:64<t?32:16<t?16:8,this.boneMatrices=new Float32Array(4*this.boneTextureWidth*this.boneTextureHeight),this.boneTexture=new e.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,e.RGBAFormat,e.FloatType),this.boneTexture.minFilter=e.NearestFilter,this.boneTexture.magFilter=e.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*t),this.pose()}},e.SkinnedMesh.prototype=Object.create(e.Mesh.prototype),e.SkinnedMesh.prototype.addBone=function(t){return void 0===t&&(t=new e.Bone(this)),this.bones.push(t),t},e.SkinnedMesh.prototype.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||t)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;for(var t=0,n=this.children.length;t<n;t++){var r=this.children[t];r instanceof e.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[],t=0;for(n=this.bones.length;t<n;t++)r=new e.Matrix4,r.getInverse(this.bones[t].skinMatrix),this.boneInverses.push(r)}t=0;for(n=this.bones.length;t<n;t++)e.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[t].skinMatrix,this.boneInverses[t]),e.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*t);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},e.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();Infinity!==n?t.multiplyScalar(n):t.set(1)}},e.SkinnedMesh.prototype.clone=function(t){return void 0===t&&(t=new e.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),e.Mesh.prototype.clone.call(this,t),t},e.SkinnedMesh.offsetMatrix=new e.Matrix4,e.MorphAnimMesh=function(t,n){e.Mesh.call(this,t,n),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},e.MorphAnimMesh.prototype=Object.create(e.Mesh.prototype),e.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},e.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},e.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},e.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,r=/([a-z]+)(\d+)/,i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i].name.match(r);if(o&&1<o.length){o=o[1],n[o]||(n[o]={start:Infinity,end:-Infinity});var u=n[o];i<u.start&&(u.start=i),i>u.end&&(u.end=i),t||(t=o)}}e.firstAnimation=t},e.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},e.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=1e3*((n.end-n.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},e.MorphAnimMesh.prototype.updateAnimation=function(t){var n=this.duration/this.length;this.time+=this.direction*t;if(this.mirroredLoop){if(this.time>this.duration||0>this.time)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration,0>this.time&&(this.time+=this.duration);t=this.startKeyframe+e.Math.clamp(Math.floor(this.time/n),0,this.length-1),t!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[t]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=t),n=this.time%n/n,this.directionBackwards&&(n=1-n),this.morphTargetInfluences[this.currentKeyframe]=n,this.morphTargetInfluences[this.lastKeyframe]=1-n},e.MorphAnimMesh.prototype.clone=function(t){return void 0===t&&(t=new e.MorphAnimMesh(this.geometry,this.material)),t.duration=this.duration,t.mirroredLoop=this.mirroredLoop,t.time=this.time,t.lastKeyframe=this.lastKeyframe,t.currentKeyframe=this.currentKeyframe,t.direction=this.direction,t.directionBackwards=this.directionBackwards,e.Mesh.prototype.clone.call(this,t),t},e.Ribbon=function(t,n){e.Object3D.call(this),this.geometry=t,this.material=n},e.Ribbon.prototype=Object.create(e.Object3D.prototype),e.Ribbon.prototype.clone=function(t){return void 0===t&&(t=new e.Ribbon(this.geometry,this.material)),e.Object3D.prototype.clone.call(this,t),t},e.LOD=function(){e.Object3D.call(this),this.objects=[]},e.LOD.prototype=Object.create(e.Object3D.prototype),e.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),n=0;n<this.objects.length&&!(t<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},e.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},e.LOD.prototype.update=function(){var t=new e.Vector3,n=new e.Vector3;return function(e){if(1<this.objects.length){t.getPositionFromMatrix(e.matrixWorld),n.getPositionFromMatrix(this.matrixWorld),e=t.distanceTo(n),this.objects[0].object.visible=!0;for(var r=1,i=this.objects.length;r<i;r++){if(!(e>=this.objects[r].distance))break;this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0}for(;r<i;r++)this.objects[r].object.visible=!1}}}(),e.LOD.prototype.clone=function(){},e.Sprite=function(t){e.Object3D.call(this),this.material=void 0!==t?t:new e.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},e.Sprite.prototype=Object.create(e.Object3D.prototype),e.Sprite.prototype.updateMatrix=function(){this.rotation3d.set(0,0,this.rotation),this.quaternion.setFromEuler(this.rotation3d,this.eulerOrder),this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},e.Sprite.prototype.clone=function(t){return void 0===t&&(t=new e.Sprite(this.material)),e.Object3D.prototype.clone.call(this,t),t},e.Scene=function(){e.Object3D.call(this),this.overrideMaterial=this.fog=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},e.Scene.prototype=Object.create(e.Object3D.prototype),e.Scene.prototype.__addObject=function(t){if(t instanceof e.Light)-1===this.__lights.indexOf(t)&&this.__lights.push(t),t.target&&void 0===t.target.parent&&this.add(t.target);else if(!(t instanceof e.Camera||t instanceof e.Bone)&&-1===this.__objects.indexOf(t)){this.__objects.push(t),this.__objectsAdded.push(t);var n=this.__objectsRemoved.indexOf(t);-1!==n&&this.__objectsRemoved.splice(n,1)}for(n=0;n<t.children.length;n++)this.__addObject(t.children[n])},e.Scene.prototype.__removeObject=function(t){if(t instanceof e.Light){var n=this.__lights.indexOf(t);-1!==n&&this.__lights.splice(n,1)}else t instanceof e.Camera||(n=this.__objects.indexOf(t),-1!==n&&(this.__objects.splice(n,1),this.__objectsRemoved.push(t),n=this.__objectsAdded.indexOf(t),-1!==n&&this.__objectsAdded.splice(n,1)));for(n=0;n<t.children.length;n++)this.__removeObject(t.children[n])},e.Fog=function(t,n,r){this.name="",this.color=new e.Color(t),this.near=void 0!==n?n:1,this.far=void 0!==r?r:1e3},e.Fog.prototype.clone=function(){return new e.Fog(this.color.getHex(),this.near,this.far)},e.FogExp2=function(t,n){this.name="",this.color=new e.Color(t),this.density=void 0!==n?n:25e-5},e.FogExp2.prototype.clone=function(){return new e.FogExp2(this.color.getHex(),this.density)},e.CanvasRenderer=function(t){function n(e){T!==e&&(T=E.globalAlpha=e)}function r(t){N!==t&&(t===e.NormalBlending?E.globalCompositeOperation="source-over":t===e.AdditiveBlending?E.globalCompositeOperation="lighter":t===e.SubtractiveBlending&&(E.globalCompositeOperation="darker"),N=t)}function i(e){L!==e&&(L=E.lineWidth=e)}function s(e){A!==e&&(A=E.lineCap=e)}function o(e){O!==e&&(O=E.lineJoin=e)}function u(e){C!==e&&(C=E.strokeStyle=e)}function a(e){k!==e&&(k=E.fillStyle=e)}function f(e,t){if(M!==e||_!==t)E.setLineDash([e,t]),M=e,_=t}console.log("THREE.CanvasRenderer",e.REVISION);var l=e.Math.smoothstep,t=t||{},c=this,h,p,d,v=new e.Projector,m=void 0!==t.canvas?t.canvas:document.createElement("canvas"),g,y,b,w,E=m.getContext("2d"),S=new e.Color(0),x=0,T=1,N=0,C=null,k=null,L=null,A=null,O=null,M=null,_=0,D,P,H,B,j=new e.RenderableVertex,F=new e.RenderableVertex,I,q,R,U,z,W,X,V,$,J,K,Q,G=new e.Color,Y=new e.Color,Z=new e.Color,et=new e.Color,tt=new e.Color,nt=new e.Color,rt=new e.Color,it=new e.Color,st={},ot={},ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt=new e.Box2,yt=new e.Box2,bt=new e.Box2,wt=new e.Color,Et=new e.Color,St=new e.Color,xt=new e.Vector3,Tt,Nt,Ct,kt,Lt,At,Ot=16;Tt=document.createElement("canvas"),Tt.width=Tt.height=2,Nt=Tt.getContext("2d"),Nt.fillStyle="rgba(0,0,0,1)",Nt.fillRect(0,0,2,2),Ct=Nt.getImageData(0,0,2,2),kt=Ct.data,Lt=document.createElement("canvas"),Lt.width=Lt.height=Ot,At=Lt.getContext("2d"),At.translate(-Ot/2,-Ot/2),At.scale(Ot,Ot),Ot--,void 0===E.setLineDash&&(E.setLineDash=void 0!==E.mozDash?function(e){E.mozDash=null!==e[0]?e:null}:function(){}),this.domElement=m,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(t,n,r){g=t*this.devicePixelRatio,y=n*this.devicePixelRatio,b=Math.floor(g/2),w=Math.floor(y/2),m.width=g,m.height=y,1!==this.devicePixelRatio&&!1!==r&&(m.style.width=t+"px",m.style.height=n+"px"),gt.set(new e.Vector2(-b,-w),new e.Vector2(b,w)),yt.set(new e.Vector2(-b,-w),new e.Vector2(b,w)),T=1,N=0,O=A=L=k=C=null},this.setClearColor=function(t,n){S.set(t),x=void 0!==n?n:1,yt.set(new e.Vector2(-b,-w),new e.Vector2(b,w))},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){E.setTransform(1,0,0,-1,b,w),!1===yt.empty()&&(yt.intersect(gt),yt.expandByScalar(2),1>x&&E.clearRect(yt.min.x|0,yt.min.y|0,yt.max.x-yt.min.x|0,yt.max.y-yt.min.y|0),0<x&&(r(e.NormalBlending),n(1),a("rgba("+Math.floor(255*S.r)+","+Math.floor(255*S.g)+","+Math.floor(255*S.b)+","+x+")"),E.fillRect(yt.min.x|0,yt.min.y|0,yt.max.x-yt.min.x|0,yt.max.y-yt.min.y|0)),yt.makeEmpty())},this.render=function(t,m){function g(t,n,r){for(var i=0,s=d.length;i<s;i++){var o=d[i];it.copy(o.color);if(o instanceof e.DirectionalLight){var u=xt.getPositionFromMatrix(o.matrixWorld).normalize(),a=n.dot(u);0>=a||(a*=o.intensity,r.add(it.multiplyScalar(a)))}else o instanceof e.PointLight&&(u=xt.getPositionFromMatrix(o.matrixWorld),a=n.dot(xt.subVectors(u,t).normalize()),0>=a||(a*=0==o.distance?1:1-Math.min(t.distanceTo(u)/o.distance,1),0!=a&&(a*=o.intensity,r.add(it.multiplyScalar(a)))))}}function y(t,i,s,o,u,a,f,h){c.info.render.vertices+=3,c.info.render.faces++,n(h.opacity),r(h.blending),I=t.positionScreen.x,q=t.positionScreen.y,R=i.positionScreen.x,U=i.positionScreen.y,z=s.positionScreen.x,W=s.positionScreen.y,S(I,q,R,U,z,W),(h instanceof e.MeshLambertMaterial||h instanceof e.MeshPhongMaterial)&&null===h.map?(nt.copy(h.color),rt.copy(h.emissive),h.vertexColors===e.FaceColors&&nt.multiply(f.color),!1===h.wireframe&&h.shading==e.SmoothShading&&3==f.vertexNormalsLength?(Y.copy(wt),Z.copy(wt),et.copy(wt),g(f.v1.positionWorld,f.vertexNormalsModel[0],Y),g(f.v2.positionWorld,f.vertexNormalsModel[1],Z),g(f.v3.positionWorld,f.vertexNormalsModel[2],et),Y.multiply(nt).add(rt),Z.multiply(nt).add(rt),et.multiply(nt).add(rt),tt.addColors(Z,et).multiplyScalar(.5),ft=L(Y,Z,et,tt),k(I,q,R,U,z,W,0,0,1,0,0,1,ft)):(G.copy(wt),g(f.centroidModel,f.normalModel,G),G.multiply(nt).add(rt),!0===h.wireframe?T(G,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):N(G))):h instanceof e.MeshBasicMaterial||h instanceof e.MeshLambertMaterial||h instanceof e.MeshPhongMaterial?null!==h.map?h.map.mapping instanceof e.UVMapping&&(lt=f.uvs[0],C(I,q,R,U,z,W,lt[o].x,lt[o].y,lt[u].x,lt[u].y,lt[a].x,lt[a].y,h.map)):null!==h.envMap?h.envMap.mapping instanceof e.SphericalReflectionMapping&&(xt.copy(f.vertexNormalsModelView[o]),ct=.5*xt.x+.5,ht=.5*xt.y+.5,xt.copy(f.vertexNormalsModelView[u]),pt=.5*xt.x+.5,dt=.5*xt.y+.5,xt.copy(f.vertexNormalsModelView[a]),vt=.5*xt.x+.5,mt=.5*xt.y+.5,C(I,q,R,U,z,W,ct,ht,pt,dt,vt,mt,h.envMap)):(G.copy(h.color),h.vertexColors===e.FaceColors&&G.multiply(f.color),!0===h.wireframe?T(G,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):N(G)):h instanceof e.MeshDepthMaterial?(ut=m.near,at=m.far,Y.r=Y.g=Y.b=1-l(t.positionScreen.z*t.positionScreen.w,ut,at),Z.r=Z.g=Z.b=1-l(i.positionScreen.z*i.positionScreen.w,ut,at),et.r=et.g=et.b=1-l(s.positionScreen.z*s.positionScreen.w,ut,at),tt.addColors(Z,et).multiplyScalar(.5),ft=L(Y,Z,et,tt),k(I,q,R,U,z,W,0,0,1,0,0,1,ft)):h instanceof e.MeshNormalMaterial&&(h.shading==e.FlatShading?(t=f.normalModelView,G.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),!0===h.wireframe?T(G,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):N(G)):h.shading==e.SmoothShading&&(t=f.vertexNormalsModelView[o],Y.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),t=f.vertexNormalsModelView[u],Z.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),t=f.vertexNormalsModelView[a],et.setRGB(t.x,t.y,t.z).multiplyScalar(.5).addScalar(.5),tt.addColors(Z,et).multiplyScalar(.5),ft=L(Y,Z,et,tt),k(I,q,R,U,z,W,0,0,1,0,0,1,ft)))}function S(e,t,n,r,i,s){E.beginPath(),E.moveTo(e,t),E.lineTo(n,r),E.lineTo(i,s),E.closePath()}function x(e,t,n,r,i,s,o,u){E.beginPath(),E.moveTo(e,t),E.lineTo(n,r),E.lineTo(i,s),E.lineTo(o,u),E.closePath()}function T(e,t,n,r){i(t),s(n),o(r),u(e.getStyle()),E.stroke(),bt.expandByScalar(2*t)}function N(e){a(e.getStyle()),E.fill()}function C(t,n,r,i,s,o,u,f,l,c,h,p,d){if(!(d instanceof e.DataTexture||void 0===d.image||0==d.image.width)){if(!0===d.needsUpdate){var v=d.wrapS==e.RepeatWrapping,m=d.wrapT==e.RepeatWrapping;st[d.id]=E.createPattern(d.image,!0===v&&!0===m?"repeat":!0===v&&!1===m?"repeat-x":!1===v&&!0===m?"repeat-y":"no-repeat"),d.needsUpdate=!1}void 0===st[d.id]?a("rgba(0,0,0,1)"):a(st[d.id]);var v=d.offset.x/d.repeat.x,m=d.offset.y/d.repeat.y,g=d.image.width*d.repeat.x,y=d.image.height*d.repeat.y,u=(u+v)*g,f=(1-f+m)*y,r=r-t,i=i-n,s=s-t,o=o-n,l=(l+v)*g-u,c=(1-c+m)*y-f,h=(h+v)*g-u,p=(1-p+m)*y-f,v=l*p-h*c;0===v?(void 0===ot[d.id]&&(n=document.createElement("canvas"),n.width=d.image.width,n.height=d.image.height,n=n.getContext("2d"),n.drawImage(d.image,0,0),ot[d.id]=n.getImageData(0,0,d.image.width,d.image.height).data),n=ot[d.id],u=4*(Math.floor(u)+Math.floor(f)*d.image.width),G.setRGB(n[u]/255,n[u+1]/255,n[u+2]/255),N(G)):(v=1/v,d=(p*r-c*s)*v,c=(p*i-c*o)*v,r=(l*s-h*r)*v,i=(l*o-h*i)*v,t=t-d*u-r*f,u=n-c*u-i*f,E.save(),E.transform(d,c,r,i,t,u),E.fill(),E.restore())}}function k(e,t,n,r,i,s,o,u,a,f,l,c,h){var p,d;p=h.width-1,d=h.height-1,o*=p,u*=d,n-=e,r-=t,i-=e,s-=t,a=a*p-o,f=f*d-u,l=l*p-o,c=c*d-u,d=1/(a*c-l*f),p=(c*n-f*i)*d,f=(c*r-f*s)*d,n=(a*i-l*n)*d,r=(a*s-l*r)*d,e=e-p*o-n*u,t=t-f*o-r*u,E.save(),E.transform(p,f,n,r,e,t),E.clip(),E.drawImage(h,0,0),E.restore()}function L(e,t,n,r){return kt[0]=255*e.r|0,kt[1]=255*e.g|0,kt[2]=255*e.b|0,kt[4]=255*t.r|0,kt[5]=255*t.g|0,kt[6]=255*t.b|0,kt[8]=255*n.r|0,kt[9]=255*n.g|0,kt[10]=255*n.b|0,kt[12]=255*r.r|0,kt[13]=255*r.g|0,kt[14]=255*r.b|0,Nt.putImageData(Ct,0,0),At.drawImage(Tt,0,0),Lt}function A(e,t){var n=t.x-e.x,r=t.y-e.y,i=n*n+r*r;0!==i&&(i=1/Math.sqrt(i),n*=i,r*=i,t.x+=n,t.y+=r,e.x-=n,e.y-=r)}if(0==m instanceof e.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),E.setTransform(1,0,0,-1,b,w),c.info.render.vertices=0,c.info.render.faces=0,h=v.projectScene(t,m,this.sortObjects,this.sortElements),p=h.elements,d=h.lights,wt.setRGB(0,0,0),Et.setRGB(0,0,0),St.setRGB(0,0,0);for(var O=0,M=d.length;O<M;O++){var _=d[O],Ot=_.color;_ instanceof e.AmbientLight?wt.add(Ot):_ instanceof e.DirectionalLight?Et.add(Ot):_ instanceof e.PointLight&&St.add(Ot)}O=0;for(M=p.length;O<M;O++){var Mt=p[O],_=Mt.material;if(void 0!==_&&!1!==_.visible){bt.makeEmpty();if(Mt instanceof e.RenderableParticle){D=Mt,D.x*=b,D.y*=w,Ot=D,n(_.opacity),r(_.blending);var _t=void 0,Dt=void 0,Pt=void 0,Ht=void 0,Bt=void 0,jt=void 0,Ft=void 0;_ instanceof e.ParticleBasicMaterial?null===_.map?(Pt=Mt.object.scale.x,Ht=Mt.object.scale.y,Pt*=Mt.scale.x*b,Ht*=Mt.scale.y*w,bt.min.set(Ot.x-Pt,Ot.y-Ht),bt.max.set(Ot.x+Pt,Ot.y+Ht),!1===gt.isIntersectionBox(bt)?bt.makeEmpty():(a(_.color.getStyle()),E.save(),E.translate(Ot.x,Ot.y),E.rotate(-Mt.rotation),E.scale(Pt,Ht),E.fillRect(-1,-1,2,2),E.restore())):(Bt=_.map.image,jt=Bt.width>>1,Ft=Bt.height>>1,Pt=Mt.scale.x*b,Ht=Mt.scale.y*w,_t=Pt*jt,Dt=Ht*Ft,bt.min.set(Ot.x-_t,Ot.y-Dt),bt.max.set(Ot.x+_t,Ot.y+Dt),!1===gt.isIntersectionBox(bt)?bt.makeEmpty():(E.save(),E.translate(Ot.x,Ot.y),E.rotate(-Mt.rotation),E.scale(Pt,-Ht),E.translate(-jt,-Ft),E.drawImage(Bt,0,0),E.restore())):_ instanceof e.ParticleCanvasMaterial&&(_t=Mt.scale.x*b,Dt=Mt.scale.y*w,bt.min.set(Ot.x-_t,Ot.y-Dt),bt.max.set(Ot.x+_t,Ot.y+Dt),!1===gt.isIntersectionBox(bt)?bt.makeEmpty():(u(_.color.getStyle()),a(_.color.getStyle()),E.save(),E.translate(Ot.x,Ot.y),E.rotate(-Mt.rotation),E.scale(_t,Dt),_.program(E),E.restore()))}else if(Mt instanceof e.RenderableLine){if(D=Mt.v1,P=Mt.v2,D.positionScreen.x*=b,D.positionScreen.y*=w,P.positionScreen.x*=b,P.positionScreen.y*=w,bt.setFromPoints([D.positionScreen,P.positionScreen]),!0===gt.isIntersectionBox(bt))if(Ot=D,_t=P,n(_.opacity),r(_.blending),E.beginPath(),E.moveTo(Ot.positionScreen.x,Ot.positionScreen.y),E.lineTo(_t.positionScreen.x,_t.positionScreen.y),_ instanceof e.LineBasicMaterial){i(_.linewidth),s(_.linecap),o(_.linejoin);if(_.vertexColors!==e.VertexColors)u(_.color.getStyle());else if(Dt=Mt.vertexColors[0].getStyle(),Mt=Mt.vertexColors[1].getStyle(),Dt===Mt)u(Dt);else{try{var It=E.createLinearGradient(Ot.positionScreen.x,Ot.positionScreen.y,_t.positionScreen.x,_t.positionScreen.y);It.addColorStop(0,Dt),It.addColorStop(1,Mt)}catch(qt){It=Dt}u(It)}E.stroke(),bt.expandByScalar(2*_.linewidth)}else _ instanceof e.LineDashedMaterial&&(i(_.linewidth),s(_.linecap),o(_.linejoin),u(_.color.getStyle()),f(_.dashSize,_.gapSize),E.stroke(),bt.expandByScalar(2*_.linewidth),f(null,null))}else if(Mt instanceof e.RenderableFace3){D=Mt.v1,P=Mt.v2,H=Mt.v3;if(-1>D.positionScreen.z||1<D.positionScreen.z)continue;if(-1>P.positionScreen.z||1<P.positionScreen.z)continue;if(-1>H.positionScreen.z||1<H.positionScreen.z)continue;D.positionScreen.x*=b,D.positionScreen.y*=w,P.positionScreen.x*=b,P.positionScreen.y*=w,H.positionScreen.x*=b,H.positionScreen.y*=w,!0===_.overdraw&&(A(D.positionScreen,P.positionScreen),A(P.positionScreen,H.positionScreen),A(H.positionScreen,D.positionScreen)),bt.setFromPoints([D.positionScreen,P.positionScreen,H.positionScreen]),!0===gt.isIntersectionBox(bt)&&y(D,P,H,0,1,2,Mt,_)}else if(Mt instanceof e.RenderableFace4){D=Mt.v1,P=Mt.v2,H=Mt.v3,B=Mt.v4;if(-1>D.positionScreen.z||1<D.positionScreen.z)continue;if(-1>P.positionScreen.z||1<P.positionScreen.z)continue;if(-1>H.positionScreen.z||1<H.positionScreen.z)continue;if(-1>B.positionScreen.z||1<B.positionScreen.z)continue;D.positionScreen.x*=b,D.positionScreen.y*=w,P.positionScreen.x*=b,P.positionScreen.y*=w,H.positionScreen.x*=b,H.positionScreen.y*=w,B.positionScreen.x*=b,B.positionScreen.y*=w,j.positionScreen.copy(P.positionScreen),F.positionScreen.copy(B.positionScreen),!0===_.overdraw&&(A(D.positionScreen,P.positionScreen),A(P.positionScreen,B.positionScreen),A(B.positionScreen,D.positionScreen),A(H.positionScreen,j.positionScreen),A(H.positionScreen,F.positionScreen)),bt.setFromPoints([D.positionScreen,P.positionScreen,H.positionScreen,B.positionScreen]),!0===gt.isIntersectionBox(bt)&&(Ot=D,_t=P,Dt=H,Pt=B,Ht=j,Bt=F,c.info.render.vertices+=4,c.info.render.faces++,n(_.opacity),r(_.blending),void 0!==_.map&&null!==_.map||void 0!==_.envMap&&null!==_.envMap?(y(Ot,_t,Pt,0,1,3,Mt,_),y(Ht,Dt,Bt,1,2,3,Mt,_)):(I=Ot.positionScreen.x,q=Ot.positionScreen.y,R=_t.positionScreen.x,U=_t.positionScreen.y,z=Dt.positionScreen.x,W=Dt.positionScreen.y,X=Pt.positionScreen.x,V=Pt.positionScreen.y,$=Ht.positionScreen.x,J=Ht.positionScreen.y,K=Bt.positionScreen.x,Q=Bt.positionScreen.y,_ instanceof e.MeshLambertMaterial||_ instanceof e.MeshPhongMaterial?(nt.copy(_.color),rt.copy(_.emissive),_.vertexColors===e.FaceColors&&nt.multiply(Mt.color),!1===_.wireframe&&_.shading==e.SmoothShading&&4==Mt.vertexNormalsLength?(Y.copy(wt),Z.copy(wt),et.copy(wt),tt.copy(wt),g(Mt.v1.positionWorld,Mt.vertexNormalsModel[0],Y),g(Mt.v2.positionWorld,Mt.vertexNormalsModel[1],Z),g(Mt.v4.positionWorld,Mt.vertexNormalsModel[3],et),g(Mt.v3.positionWorld,Mt.vertexNormalsModel[2],tt),Y.multiply(nt).add(rt),Z.multiply(nt).add(rt),et.multiply(nt).add(rt),tt.multiply(nt).add(rt),ft=L(Y,Z,et,tt),S(I,q,R,U,X,V),k(I,q,R,U,X,V,0,0,1,0,0,1,ft),S($,J,z,W,K,Q),k($,J,z,W,K,Q,1,0,1,1,0,1,ft)):(G.copy(wt),g(Mt.centroidModel,Mt.normalModel,G),G.multiply(nt).add(rt),x(I,q,R,U,z,W,X,V),!0===_.wireframe?T(G,_.wireframeLinewidth,_.wireframeLinecap,_.wireframeLinejoin):N(G))):_ instanceof e.MeshBasicMaterial?(G.copy(_.color),_.vertexColors===e.FaceColors&&G.multiply(Mt.color),x(I,q,R,U,z,W,X,V),!0===_.wireframe?T(G,_.wireframeLinewidth,_.wireframeLinecap,_.wireframeLinejoin):N(G)):_ instanceof e.MeshNormalMaterial?(Ot=void 0,_.shading==e.FlatShading?(Ot=Mt.normalModelView,G.setRGB(Ot.x,Ot.y,Ot.z).multiplyScalar(.5).addScalar(.5),x(I,q,R,U,z,W,X,V),!0===_.wireframe?T(G,_.wireframeLinewidth,_.wireframeLinecap,_.wireframeLinejoin):N(G)):_.shading==e.SmoothShading&&(Ot=Mt.vertexNormalsModelView[0],Y.setRGB(Ot.x,Ot.y,Ot.z).multiplyScalar(.5).addScalar(.5),Ot=Mt.vertexNormalsModelView[1],Z.setRGB(Ot.x,Ot.y,Ot.z).multiplyScalar(.5).addScalar(.5),Ot=Mt.vertexNormalsModelView[3],et.setRGB(Ot.x,Ot.y,Ot.z).multiplyScalar(.5).addScalar(.5),Ot=Mt.vertexNormalsModelView[2],tt.setRGB(Ot.x,Ot.y,Ot.z).multiplyScalar(.5).addScalar(.5),ft=L(Y,Z,et,tt),S(I,q,R,U,X,V),k(I,q,R,U,X,V,0,0,1,0,0,1,ft),S($,J,z,W,K,Q),k($,J,z,W,K,Q,1,0,1,1,0,1,ft))):_ instanceof e.MeshDepthMaterial&&(ut=m.near,at=m.far,Y.r=Y.g=Y.b=1-l(Ot.positionScreen.z*Ot.positionScreen.w,ut,at),Z.r=Z.g=Z.b=1-l(_t.positionScreen.z*_t.positionScreen.w,ut,at),et.r=et.g=et.b=1-l(Pt.positionScreen.z*Pt.positionScreen.w,ut,at),tt.r=tt.g=tt.b=1-l(Dt.positionScreen.z*Dt.positionScreen.w,ut,at),ft=L(Y,Z,et,tt),S(I,q,R,U,X,V),k(I,q,R,U,X,V,0,0,1,0,0,1,ft),S($,J,z,W,K,Q),k($,J,z,W,K,Q,1,0,1,1,0,1,ft))))}yt.union(bt)}}E.setTransform(1,0,0,1,0,0)}}},e.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else if ( combine == 2 ) {\ngl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n#ifdef USE_SKINNING\nvec4 worldPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nworldNormal = normalize( worldNormal );\nvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, worldNormal );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\nvec4 texelColor = texture2D( map, vUv );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, N_BONE_PIXEL_X );\nfloat y = floor( j / N_BONE_PIXEL_X );\nconst float dx = 1.0 / N_BONE_PIXEL_X;\nconst float dy = 1.0 / N_BONE_PIXEL_Y;\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix 	+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#if defined( SHADOWMAP_TYPE_PCF )\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nfloat shadow = 0.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.0 * xPixelOffset;\nfloat dy0 = -1.0 * yPixelOffset;\nfloat dx1 = 1.0 * xPixelOffset;\nfloat dy1 = 1.0 * yPixelOffset;\nmat3 shadowKernel;\nmat3 depthKernel;\ndepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\ndepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\ndepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\ndepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\ndepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\ndepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\ndepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\ndepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\ndepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nvec3 shadowZ = vec3( shadowCoord.z );\nshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\nshadowKernel[0] *= vec3(0.25);\nshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\nshadowKernel[1] *= vec3(0.25);\nshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\nshadowKernel[2] *= vec3(0.25);\nvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\nshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\nshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\nvec4 shadowValues;\nshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\nshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\nshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\nshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\nshadow = dot( shadowValues, vec4( 1.0 ) );\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},e.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++)for(n in r=this.clone(e[t]),r)i[n]=r[n];return i},clone:function(t){var n,r,i,s={};for(n in t)for(r in s[n]={},t[n])i=t[n][r],s[n][r]=i instanceof e.Color||i instanceof e.Vector2||i instanceof e.Vector3||i instanceof e.Vector4||i instanceof e.Matrix4||i instanceof e.Texture?i.clone():i instanceof Array?i.slice():i;return s}},e.UniformsLib={common:{diffuse:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new e.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new e.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},e.ShaderLib={basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.shadowmap]),vertexShader:[e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"#endif",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_lambert_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_lambert_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.bump,e.UniformsLib.normalmap,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},specular:{type:"c",value:new e.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_phong_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_phong_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.lights_phong_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.bumpmap_pars_fragment,e.ShaderChunk.normalmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lights_phong_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.particle,e.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",e.ShaderChunk.color_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_particle_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",e.ShaderChunk.map_particle_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",e.ShaderChunk.color_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.fog_pars_fragment,"void main() {\nif ( mod( vLineDistance, totalSize ) > dashSize ) {\ndiscard;\n}\ngl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.color_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",e.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvNormal = normalize( normalMatrix * normal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},normalmap:{uniforms:e.UniformsUtils.merge([e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new e.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new e.Color(16777215)},uSpecularColor:{type:"c",value:new e.Color(1118481)},uAmbientColor:{type:"c",value:new e.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new e.Vector2(0,0)},uRepeat:{type:"v2",value:new e.Vector2(1,1)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float uRefractionRatio;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += uDiffuseColor * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, uRefractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalize( normalMatrix * skinnedNormal.xyz );\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalize( normalMatrix * skinnedTangent.xyz );\n#else\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\n#endif\nvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = worldPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\nvoid main() {\ngl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n}"},depthRGBA:{uniforms:{},vertexShader:[e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},e.WebGLRenderer=function(t){function n(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Nt.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function r(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;"v2"===s.type?o=2:"v3"===s.type?o=3:"v4"===s.type?o=4:"c"===s.type&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=Nt.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function i(e,t){var n=t.geometry,r=e.faces3,i=e.faces4,a=3*r.length+4*i.length,f=1*r.length+2*i.length,i=3*r.length+4*i.length,r=s(t,e),l=u(r),c=o(r),h=r.vertexColors?r.vertexColors:!1;e.__vertexArray=new Float32Array(3*a),c&&(e.__normalArray=new Float32Array(3*a)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*a)),h&&(e.__colorArray=new Float32Array(3*a));if(l){if(0<n.faceUvs.length||0<n.faceVertexUvs.length)e.__uvArray=new Float32Array(2*a);if(1<n.faceUvs.length||1<n.faceVertexUvs.length)e.__uv2Array=new Float32Array(2*a)}t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*a),e.__skinWeightArray=new Float32Array(4*a)),e.__faceArray=new Uint16Array(3*f),e.__lineArray=new Uint16Array(2*i);if(e.numMorphTargets){e.__morphTargetsArrays=[],n=0;for(l=e.numMorphTargets;n<l;n++)e.__morphTargetsArrays.push(new Float32Array(3*a))}if(e.numMorphNormals){e.__morphNormalsArrays=[],n=0;for(l=e.numMorphNormals;n<l;n++)e.__morphNormalsArrays.push(new Float32Array(3*a))}e.__webglFaceCount=3*f,e.__webglLineCount=2*i;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var p in r.attributes){var f=r.attributes[p],n={},d;for(d in f)n[d]=f[d];if(!n.__webglInitialized||n.createUniqueBuffers)n.__webglInitialized=!0,i=1,"v2"===n.type?i=2:"v3"===n.type?i=3:"v4"===n.type?i=4:"c"===n.type&&(i=3),n.size=i,n.array=new Float32Array(a*i),n.buffer=Nt.createBuffer(),n.buffer.belongsToAttribute=p,f.needsUpdate=!0,n.__original=f;e.__webglCustomAttributesList.push(n)}}e.__inittedArrays=!0}function s(t,n){return t.material instanceof e.MeshFaceMaterial?t.material.materials[n.materialIndex]:t.material}function o(t){return t instanceof e.MeshBasicMaterial&&!t.envMap||t instanceof e.MeshDepthMaterial?!1:t&&void 0!==t.shading&&t.shading===e.SmoothShading?e.SmoothShading:e.FlatShading}function u(t){return t.map||t.lightMap||t.bumpMap||t.normalMap||t.specularMap||t instanceof e.ShaderMaterial?!0:!1}function a(e){gt[e]||(Nt.enableVertexAttribArray(e),gt[e]=!0)}function f(){for(var e in gt)gt[e]&&(Nt.disableVertexAttribArray(e),gt[e]=!1)}function l(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function c(e,t){return t[0]-e[0]}function h(e,t,n){if(e.length)for(var r=0,i=e.length;r<i;r++)Q=V=null,J=K=et=Z=ot=st=tt=-1,xt=!0,e[r].render(t,n,vt,mt),Q=V=null,J=K=et=Z=ot=st=tt=-1,xt=!0}function p(t,n,r,i,s,o,u,a){var f,l,c,h;n?(l=t.length-1,h=n=-1):(l=0,n=t.length,h=1);for(var p=l;p!==n;p+=h)if(f=t[p],f.render){l=f.object,c=f.buffer;if(a)f=a;else{f=f[r];if(!f)continue;u&&z.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),z.setDepthTest(f.depthTest),z.setDepthWrite(f.depthWrite),k(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}z.setMaterialFaces(f),c instanceof e.BufferGeometry?z.renderBufferDirect(i,s,o,f,c,l):z.renderBuffer(i,s,o,f,c,l)}}function d(e,t,n,r,i,s,o){for(var u,a,f=0,l=e.length;f<l;f++)if(u=e[f],a=u.object,a.visible){if(o)u=o;else{u=u[t];if(!u)continue;s&&z.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),z.setDepthTest(u.depthTest),z.setDepthWrite(u.depthWrite),k(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}z.renderImmediateObject(n,r,i,u,a)}}function v(t,n){var s,o,u,a;if(void 0===t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new e.Matrix4,t._normalMatrix=new e.Matrix3,void 0!==t.geometry&&void 0===t.geometry.__webglInit&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",zt)),o=t.geometry,void 0!==o))if(o instanceof e.BufferGeometry){var f,l;for(f in o.attributes)l="index"===f?Nt.ELEMENT_ARRAY_BUFFER:Nt.ARRAY_BUFFER,a=o.attributes[f],a.buffer=Nt.createBuffer(),Nt.bindBuffer(l,a.buffer),Nt.bufferData(l,a.array,Nt.STATIC_DRAW)}else if(t instanceof e.Mesh){u=t.material;if(void 0===o.geometryGroups){f=o;var c,h,p,d,v;l={};var g=f.morphTargets.length,y=f.morphNormals.length,b=u instanceof e.MeshFaceMaterial;f.geometryGroups={},u=0;for(c=f.faces.length;u<c;u++)h=f.faces[u],p=b?h.materialIndex:0,void 0===l[p]&&(l[p]={hash:p,counter:0}),v=l[p].hash+"_"+l[p].counter,void 0===f.geometryGroups[v]&&(f.geometryGroups[v]={faces3:[],faces4:[],materialIndex:p,vertices:0,numMorphTargets:g,numMorphNormals:y}),d=h instanceof e.Face3?3:4,65535<f.geometryGroups[v].vertices+d&&(l[p].counter+=1,v=l[p].hash+"_"+l[p].counter,void 0===f.geometryGroups[v]&&(f.geometryGroups[v]={faces3:[],faces4:[],materialIndex:p,vertices:0,numMorphTargets:g,numMorphNormals:y})),h instanceof e.Face3?f.geometryGroups[v].faces3.push(u):f.geometryGroups[v].faces4.push(u),f.geometryGroups[v].vertices+=d;f.geometryGroupsList=[];for(a in f.geometryGroups)f.geometryGroups[a].id=G++,f.geometryGroupsList.push(f.geometryGroups[a])}for(s in o.geometryGroups)if(a=o.geometryGroups[s],!a.__webglVertexBuffer){f=a,f.__webglVertexBuffer=Nt.createBuffer(),f.__webglNormalBuffer=Nt.createBuffer(),f.__webglTangentBuffer=Nt.createBuffer(),f.__webglColorBuffer=Nt.createBuffer(),f.__webglUVBuffer=Nt.createBuffer(),f.__webglUV2Buffer=Nt.createBuffer(),f.__webglSkinIndicesBuffer=Nt.createBuffer(),f.__webglSkinWeightsBuffer=Nt.createBuffer(),f.__webglFaceBuffer=Nt.createBuffer(),f.__webglLineBuffer=Nt.createBuffer(),g=l=void 0;if(f.numMorphTargets){f.__webglMorphTargetsBuffers=[],l=0;for(g=f.numMorphTargets;l<g;l++)f.__webglMorphTargetsBuffers.push(Nt.createBuffer())}if(f.numMorphNormals){f.__webglMorphNormalsBuffers=[],l=0;for(g=f.numMorphNormals;l<g;l++)f.__webglMorphNormalsBuffers.push(Nt.createBuffer())}z.info.memory.geometries++,i(a,t),o.verticesNeedUpdate=!0,o.morphTargetsNeedUpdate=!0,o.elementsNeedUpdate=!0,o.uvsNeedUpdate=!0,o.normalsNeedUpdate=!0,o.tangentsNeedUpdate=!0,o.colorsNeedUpdate=!0}}else t instanceof e.Ribbon?o.__webglVertexBuffer||(a=o,a.__webglVertexBuffer=Nt.createBuffer(),a.__webglColorBuffer=Nt.createBuffer(),a.__webglNormalBuffer=Nt.createBuffer(),z.info.memory.geometries++,a=o,f=a.vertices.length,a.__vertexArray=new Float32Array(3*f),a.__colorArray=new Float32Array(3*f),a.__normalArray=new Float32Array(3*f),a.__webglVertexCount=f,r(a,t),o.verticesNeedUpdate=!0,o.colorsNeedUpdate=!0,o.normalsNeedUpdate=!0):t instanceof e.Line?o.__webglVertexBuffer||(a=o,a.__webglVertexBuffer=Nt.createBuffer(),a.__webglColorBuffer=Nt.createBuffer(),a.__webglLineDistanceBuffer=Nt.createBuffer(),z.info.memory.geometries++,a=o,f=a.vertices.length,a.__vertexArray=new Float32Array(3*f),a.__colorArray=new Float32Array(3*f),a.__lineDistanceArray=new Float32Array(1*f),a.__webglLineCount=f,r(a,t),o.verticesNeedUpdate=!0,o.colorsNeedUpdate=!0,o.lineDistancesNeedUpdate=!0):t instanceof e.ParticleSystem&&!o.__webglVertexBuffer&&(a=o,a.__webglVertexBuffer=Nt.createBuffer(),a.__webglColorBuffer=Nt.createBuffer(),z.info.memory.geometries++,a=o,f=a.vertices.length,a.__vertexArray=new Float32Array(3*f),a.__colorArray=new Float32Array(3*f),a.__sortArray=[],a.__webglParticleCount=f,r(a,t),o.verticesNeedUpdate=!0,o.colorsNeedUpdate=!0);if(void 0===t.__webglActive){if(t instanceof e.Mesh){if(o=t.geometry,o instanceof e.BufferGeometry)m(n.__webglObjects,o,t);else if(o instanceof e.Geometry)for(s in o.geometryGroups)a=o.geometryGroups[s],m(n.__webglObjects,a,t)}else t instanceof e.Ribbon||t instanceof e.Line||t instanceof e.ParticleSystem?(o=t.geometry,m(n.__webglObjects,o,t)):t instanceof e.ImmediateRenderObject||t.immediateRenderCallback?n.__webglObjectsImmediate.push({object:t,opaque:null,transparent:null}):t instanceof e.Sprite?n.__webglSprites.push(t):t instanceof e.LensFlare&&n.__webglFlares.push(t);t.__webglActive=!0}}function m(e,t,n){e.push({buffer:t,object:n,opaque:null,transparent:null})}function g(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function y(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function b(t,n){t instanceof e.Mesh||t instanceof e.ParticleSystem||t instanceof e.Ribbon||t instanceof e.Line?w(n.__webglObjects,t):t instanceof e.Sprite?E(n.__webglSprites,t):t instanceof e.LensFlare?E(n.__webglFlares,t):(t instanceof e.ImmediateRenderObject||t.immediateRenderCallback)&&w(n.__webglObjectsImmediate,t),delete t.__webglActive}function w(e,t){for(var n=e.length-1;0<=n;n--)e[n].object===t&&e.splice(n,1)}function E(e,t){for(var n=e.length-1;0<=n;n--)e[n]===t&&e.splice(n,1)}function S(t,n,r,i,s){Y=0,i.needsUpdate&&(i.program&&$t(i),z.initMaterial(i,n,r,s),i.needsUpdate=!1),i.morphTargets&&!s.__webglMorphTargetInfluences&&(s.__webglMorphTargetInfluences=new Float32Array(z.maxMorphTargets));var o=!1,u=i.program,a=u.uniforms,f=i.uniforms;u!==V&&(Nt.useProgram(u),V=u,o=!0),i.id!==J&&(J=i.id,o=!0);if(o||t!==Q)Nt.uniformMatrix4fv(a.projectionMatrix,!1,t.projectionMatrix.elements),t!==Q&&(Q=t);if(i.skinning)if(Bt&&s.useVertexTexture){if(null!==a.boneTexture){var l=x();Nt.uniform1i(a.boneTexture,l),z.setTexture(s.boneTexture,l)}}else null!==a.boneGlobalMatrices&&Nt.uniformMatrix4fv(a.boneGlobalMatrices,!1,s.boneMatrices);if(o){r&&i.fog&&(f.fogColor.value=r.color,r instanceof e.Fog?(f.fogNear.value=r.near,f.fogFar.value=r.far):r instanceof e.FogExp2&&(f.fogDensity.value=r.density));if(i instanceof e.MeshPhongMaterial||i instanceof e.MeshLambertMaterial||i.lights){if(xt){for(var c,h=l=0,p=0,d,v,m,g=Tt,y=g.directional.colors,b=g.directional.positions,w=g.point.colors,E=g.point.positions,S=g.point.distances,C=g.spot.colors,k=g.spot.positions,L=g.spot.distances,A=g.spot.directions,M=g.spot.anglesCos,_=g.spot.exponents,H=g.hemi.skyColors,B=g.hemi.groundColors,j=g.hemi.positions,F=0,I=0,q=0,R=0,U=0,W=0,X=0,$=0,K=c=0,r=m=K=0,o=n.length;r<o;r++)c=n[r],c.onlyShadow||(d=c.color,v=c.intensity,m=c.distance,c instanceof e.AmbientLight?c.visible&&(z.gammaInput?(l+=d.r*d.r,h+=d.g*d.g,p+=d.b*d.b):(l+=d.r,h+=d.g,p+=d.b)):c instanceof e.DirectionalLight?(U+=1,c.visible&&(St.getPositionFromMatrix(c.matrixWorld),Et.getPositionFromMatrix(c.target.matrixWorld),St.sub(Et),St.normalize(),0===St.x&&0===St.y&&0===St.z||(c=3*F,b[c]=St.x,b[c+1]=St.y,b[c+2]=St.z,z.gammaInput?T(y,c,d,v*v):N(y,c,d,v),F+=1))):c instanceof e.PointLight?(W+=1,c.visible&&(K=3*I,z.gammaInput?T(w,K,d,v*v):N(w,K,d,v),Et.getPositionFromMatrix(c.matrixWorld),E[K]=Et.x,E[K+1]=Et.y,E[K+2]=Et.z,S[I]=m,I+=1)):c instanceof e.SpotLight?(X+=1,c.visible&&(K=3*q,z.gammaInput?T(C,K,d,v*v):N(C,K,d,v),Et.getPositionFromMatrix(c.matrixWorld),k[K]=Et.x,k[K+1]=Et.y,k[K+2]=Et.z,L[q]=m,St.copy(Et),Et.getPositionFromMatrix(c.target.matrixWorld),St.sub(Et),St.normalize(),A[K]=St.x,A[K+1]=St.y,A[K+2]=St.z,M[q]=Math.cos(c.angle),_[q]=c.exponent,q+=1)):c instanceof e.HemisphereLight&&($+=1,c.visible&&(St.getPositionFromMatrix(c.matrixWorld),St.normalize(),0===St.x&&0===St.y&&0===St.z||(m=3*R,j[m]=St.x,j[m+1]=St.y,j[m+2]=St.z,d=c.color,c=c.groundColor,z.gammaInput?(v*=v,T(H,m,d,v),T(B,m,c,v)):(N(H,m,d,v),N(B,m,c,v)),R+=1))));r=3*F;for(o=Math.max(y.length,3*U);r<o;r++)y[r]=0;r=3*I;for(o=Math.max(w.length,3*W);r<o;r++)w[r]=0;r=3*q;for(o=Math.max(C.length,3*X);r<o;r++)C[r]=0;r=3*R;for(o=Math.max(H.length,3*$);r<o;r++)H[r]=0;r=3*R;for(o=Math.max(B.length,3*$);r<o;r++)B[r]=0;g.directional.length=F,g.point.length=I,g.spot.length=q,g.hemi.length=R,g.ambient[0]=l,g.ambient[1]=h,g.ambient[2]=p,xt=!1}r=Tt,f.ambientLightColor.value=r.ambient,f.directionalLightColor.value=r.directional.colors,f.directionalLightDirection.value=r.directional.positions,f.pointLightColor.value=r.point.colors,f.pointLightPosition.value=r.point.positions,f.pointLightDistance.value=r.point.distances,f.spotLightColor.value=r.spot.colors,f.spotLightPosition.value=r.spot.positions,f.spotLightDistance.value=r.spot.distances,f.spotLightDirection.value=r.spot.directions,f.spotLightAngleCos.value=r.spot.anglesCos,f.spotLightExponent.value=r.spot.exponents,f.hemisphereLightSkyColor.value=r.hemi.skyColors,f.hemisphereLightGroundColor.value=r.hemi.groundColors,f.hemisphereLightDirection.value=r.hemi.positions}if(i instanceof e.MeshBasicMaterial||i instanceof e.MeshLambertMaterial||i instanceof e.MeshPhongMaterial){f.opacity.value=i.opacity,z.gammaInput?f.diffuse.value.copyGammaToLinear(i.color):f.diffuse.value=i.color,f.map.value=i.map,f.lightMap.value=i.lightMap,f.specularMap.value=i.specularMap,i.bumpMap&&(f.bumpMap.value=i.bumpMap,f.bumpScale.value=i.bumpScale),i.normalMap&&(f.normalMap.value=i.normalMap,f.normalScale.value.copy(i.normalScale));var G;i.map?G=i.map:i.specularMap?G=i.specularMap:i.normalMap?G=i.normalMap:i.bumpMap&&(G=i.bumpMap),void 0!==G&&(r=G.offset,G=G.repeat,f.offsetRepeat.value.set(r.x,r.y,G.x,G.y)),f.envMap.value=i.envMap,f.flipEnvMap.value=i.envMap instanceof e.WebGLRenderTargetCube?1:-1,f.reflectivity.value=i.reflectivity,f.refractionRatio.value=i.refractionRatio,f.combine.value=i.combine,f.useRefract.value=i.envMap&&i.envMap.mapping instanceof e.CubeRefractionMapping}i instanceof e.LineBasicMaterial?(f.diffuse.value=i.color,f.opacity.value=i.opacity):i instanceof e.LineDashedMaterial?(f.diffuse.value=i.color,f.opacity.value=i.opacity,f.dashSize.value=i.dashSize,f.totalSize.value=i.dashSize+i.gapSize,f.scale.value=i.scale):i instanceof e.ParticleBasicMaterial?(f.psColor.value=i.color,f.opacity.value=i.opacity,f.size.value=i.size,f.scale.value=P.height/2,f.map.value=i.map):i instanceof e.MeshPhongMaterial?(f.shininess.value=i.shininess,z.gammaInput?(f.ambient.value.copyGammaToLinear(i.ambient),f.emissive.value.copyGammaToLinear(i.emissive),f.specular.value.copyGammaToLinear(i.specular)):(f.ambient.value=i.ambient,f.emissive.value=i.emissive,f.specular.value=i.specular),i.wrapAround&&f.wrapRGB.value.copy(i.wrapRGB)):i instanceof e.MeshLambertMaterial?(z.gammaInput?(f.ambient.value.copyGammaToLinear(i.ambient),f.emissive.value.copyGammaToLinear(i.emissive)):(f.ambient.value=i.ambient,f.emissive.value=i.emissive),i.wrapAround&&f.wrapRGB.value.copy(i.wrapRGB)):i instanceof e.MeshDepthMaterial?(f.mNear.value=t.near,f.mFar.value=t.far,f.opacity.value=i.opacity):i instanceof e.MeshNormalMaterial&&(f.opacity.value=i.opacity);if(s.receiveShadow&&!i._shadowPass&&f.shadowMatrix){r=G=0;for(o=n.length;r<o;r++)if(l=n[r],l.castShadow&&(l instanceof e.SpotLight||l instanceof e.DirectionalLight&&!l.shadowCascade))f.shadowMap.value[G]=l.shadowMap,f.shadowMapSize.value[G]=l.shadowMapSize,f.shadowMatrix.value[G]=l.shadowMatrix,f.shadowDarkness.value[G]=l.shadowDarkness,f.shadowBias.value[G]=l.shadowBias,G++}n=i.uniformsList,f=0;for(G=n.length;f<G;f++)if(o=u.uniforms[n[f][1]])if(r=n[f][0],h=r.type,l=r.value,"i"===h)Nt.uniform1i(o,l);else if("f"===h)Nt.uniform1f(o,l);else if("v2"===h)Nt.uniform2f(o,l.x,l.y);else if("v3"===h)Nt.uniform3f(o,l.x,l.y,l.z);else if("v4"===h)Nt.uniform4f(o,l.x,l.y,l.z,l.w);else if("c"===h)Nt.uniform3f(o,l.r,l.g,l.b);else if("iv1"===h)Nt.uniform1iv(o,l);else if("iv"===h)Nt.uniform3iv(o,l);else if("fv1"===h)Nt.uniform1fv(o,l);else if("fv"===h)Nt.uniform3fv(o,l);else if("v2v"===h){void 0===r._array&&(r._array=new Float32Array(2*l.length)),h=0;for(p=l.length;h<p;h++)g=2*h,r._array[g]=l[h].x,r._array[g+1]=l[h].y;Nt.uniform2fv(o,r._array)}else if("v3v"===h){void 0===r._array&&(r._array=new Float32Array(3*l.length)),h=0;for(p=l.length;h<p;h++)g=3*h,r._array[g]=l[h].x,r._array[g+1]=l[h].y,r._array[g+2]=l[h].z;Nt.uniform3fv(o,r._array)}else if("v4v"===h){void 0===r._array&&(r._array=new Float32Array(4*l.length)),h=0;for(p=l.length;h<p;h++)g=4*h,r._array[g]=l[h].x,r._array[g+1]=l[h].y,r._array[g+2]=l[h].z,r._array[g+3]=l[h].w;Nt.uniform4fv(o,r._array)}else if("m4"===h)void 0===r._array&&(r._array=new Float32Array(16)),l.flattenToArray(r._array),Nt.uniformMatrix4fv(o,!1,r._array);else if("m4v"===h){void 0===r._array&&(r._array=new Float32Array(16*l.length)),h=0;for(p=l.length;h<p;h++)l[h].flattenToArrayOffset(r._array,16*h);Nt.uniformMatrix4fv(o,!1,r._array)}else if("t"===h){if(g=l,l=x(),Nt.uniform1i(o,l),g)if(g.image instanceof Array&&6===g.image.length){if(r=g,o=l,6===r.image.length)if(r.needsUpdate){r.image.__webglTextureCube||(r.image.__webglTextureCube=Nt.createTexture(),z.info.memory.textures++),Nt.activeTexture(Nt.TEXTURE0+o),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,r.image.__webglTextureCube),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,r.flipY),o=r instanceof e.CompressedTexture,l=[];for(h=0;6>h;h++)z.autoScaleCubemaps&&!o?(p=l,g=h,y=r.image[h],w=Dt,y.width<=w&&y.height<=w||(E=Math.max(y.width,y.height),b=Math.floor(y.width*w/E),w=Math.floor(y.height*w/E),E=document.createElement("canvas"),E.width=b,E.height=w,E.getContext("2d").drawImage(y,0,0,y.width,y.height,0,0,b,w),y=E),p[g]=y):l[h]=r.image[h];h=l[0],p=0===(h.width&h.width-1)&&0===(h.height&h.height-1),g=D(r.format),y=D(r.type),O(Nt.TEXTURE_CUBE_MAP,r,p);for(h=0;6>h;h++)if(o){w=l[h].mipmaps,E=0;for(S=w.length;E<S;E++)b=w[E],Nt.compressedTexImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+h,E,g,b.width,b.height,0,b.data)}else Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,g,g,y,l[h]);r.generateMipmaps&&p&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),r.needsUpdate=!1,r.onUpdate&&r.onUpdate()}else Nt.activeTexture(Nt.TEXTURE0+o),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,r.image.__webglTextureCube)}else g instanceof e.WebGLRenderTargetCube?(r=g,Nt.activeTexture(Nt.TEXTURE0+l),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,r.__webglTexture)):z.setTexture(g,l)}else if("tv"===h){void 0===r._array&&(r._array=[]),h=0;for(p=r.value.length;h<p;h++)r._array[h]=x();Nt.uniform1iv(o,r._array),h=0;for(p=r.value.length;h<p;h++)g=r.value[h],l=r._array[h],g&&z.setTexture(g,l)}(i instanceof e.ShaderMaterial||i instanceof e.MeshPhongMaterial||i.envMap)&&null!==a.cameraPosition&&(Et.getPositionFromMatrix(t.matrixWorld),Nt.uniform3f(a.cameraPosition,Et.x,Et.y,Et.z)),(i instanceof e.MeshPhongMaterial||i instanceof e.MeshLambertMaterial||i instanceof e.ShaderMaterial||i.skinning)&&null!==a.viewMatrix&&Nt.uniformMatrix4fv(a.viewMatrix,!1,t.matrixWorldInverse.elements)}return Nt.uniformMatrix4fv(a.modelViewMatrix,!1,s._modelViewMatrix.elements),a.normalMatrix&&Nt.uniformMatrix3fv(a.normalMatrix,!1,s._normalMatrix.elements),null!==a.modelMatrix&&Nt.uniformMatrix4fv(a.modelMatrix,!1,s.matrixWorld.elements),u}function x(){var e=Y;return e>=Mt&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Mt),Y+=1,e}function T(e,t,n,r){e[t]=n.r*n.r*r,e[t+1]=n.g*n.g*r,e[t+2]=n.b*n.b*r}function N(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function C(e){e!==lt&&(Nt.lineWidth(e),lt=e)}function k(e,t,n){ut!==e&&(e?Nt.enable(Nt.POLYGON_OFFSET_FILL):Nt.disable(Nt.POLYGON_OFFSET_FILL),ut=e),e&&(at!==t||ft!==n)&&(Nt.polygonOffset(t,n),at=t,ft=n)}function L(e){for(var e=e.split("\n"),t=0,n=e.length;t<n;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function A(e,t){var n;return"fragment"===e?n=Nt.createShader(Nt.FRAGMENT_SHADER):"vertex"===e&&(n=Nt.createShader(Nt.VERTEX_SHADER)),Nt.shaderSource(n,t),Nt.compileShader(n),Nt.getShaderParameter(n,Nt.COMPILE_STATUS)?n:(console.error(Nt.getShaderInfoLog(n)),console.error(L(t)),null)}function O(t,n,r){r?(Nt.texParameteri(t,Nt.TEXTURE_WRAP_S,D(n.wrapS)),Nt.texParameteri(t,Nt.TEXTURE_WRAP_T,D(n.wrapT)),Nt.texParameteri(t,Nt.TEXTURE_MAG_FILTER,D(n.magFilter)),Nt.texParameteri(t,Nt.TEXTURE_MIN_FILTER,D(n.minFilter))):(Nt.texParameteri(t,Nt.TEXTURE_WRAP_S,Nt.CLAMP_TO_EDGE),Nt.texParameteri(t,Nt.TEXTURE_WRAP_T,Nt.CLAMP_TO_EDGE),Nt.texParameteri(t,Nt.TEXTURE_MAG_FILTER,_(n.magFilter)),Nt.texParameteri(t,Nt.TEXTURE_MIN_FILTER,_(n.minFilter))),Lt&&n.type!==e.FloatType&&(1<n.anisotropy||n.__oldAnisotropy)&&(Nt.texParameterf(t,Lt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,Pt)),n.__oldAnisotropy=n.anisotropy)}function M(e,t){Nt.bindRenderbuffer(Nt.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_COMPONENT16,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_ATTACHMENT,Nt.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_STENCIL,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_STENCIL_ATTACHMENT,Nt.RENDERBUFFER,e)):Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.RGBA4,t.width,t.height)}function _(t){return t===e.NearestFilter||t===e.NearestMipMapNearestFilter||t===e.NearestMipMapLinearFilter?Nt.NEAREST:Nt.LINEAR}function D(t){if(t===e.RepeatWrapping)return Nt.REPEAT;if(t===e.ClampToEdgeWrapping)return Nt.CLAMP_TO_EDGE;if(t===e.MirroredRepeatWrapping)return Nt.MIRRORED_REPEAT;if(t===e.NearestFilter)return Nt.NEAREST;if(t===e.NearestMipMapNearestFilter)return Nt.NEAREST_MIPMAP_NEAREST;if(t===e.NearestMipMapLinearFilter)return Nt.NEAREST_MIPMAP_LINEAR;if(t===e.LinearFilter)return Nt.LINEAR;if(t===e.LinearMipMapNearestFilter)return Nt.LINEAR_MIPMAP_NEAREST;if(t===e.LinearMipMapLinearFilter)return Nt.LINEAR_MIPMAP_LINEAR;if(t===e.UnsignedByteType)return Nt.UNSIGNED_BYTE;if(t===e.UnsignedShort4444Type)return Nt.UNSIGNED_SHORT_4_4_4_4;if(t===e.UnsignedShort5551Type)return Nt.UNSIGNED_SHORT_5_5_5_1;if(t===e.UnsignedShort565Type)return Nt.UNSIGNED_SHORT_5_6_5;if(t===e.ByteType)return Nt.BYTE;if(t===e.ShortType)return Nt.SHORT;if(t===e.UnsignedShortType)return Nt.UNSIGNED_SHORT;if(t===e.IntType)return Nt.INT;if(t===e.UnsignedIntType)return Nt.UNSIGNED_INT;if(t===e.FloatType)return Nt.FLOAT;if(t===e.AlphaFormat)return Nt.ALPHA;if(t===e.RGBFormat)return Nt.RGB;if(t===e.RGBAFormat)return Nt.RGBA;if(t===e.LuminanceFormat)return Nt.LUMINANCE;if(t===e.LuminanceAlphaFormat)return Nt.LUMINANCE_ALPHA;if(t===e.AddEquation)return Nt.FUNC_ADD;if(t===e.SubtractEquation)return Nt.FUNC_SUBTRACT;if(t===e.ReverseSubtractEquation)return Nt.FUNC_REVERSE_SUBTRACT;if(t===e.ZeroFactor)return Nt.ZERO;if(t===e.OneFactor)return Nt.ONE;if(t===e.SrcColorFactor)return Nt.SRC_COLOR;if(t===e.OneMinusSrcColorFactor)return Nt.ONE_MINUS_SRC_COLOR;if(t===e.SrcAlphaFactor)return Nt.SRC_ALPHA;if(t===e.OneMinusSrcAlphaFactor)return Nt.ONE_MINUS_SRC_ALPHA;if(t===e.DstAlphaFactor)return Nt.DST_ALPHA;if(t===e.OneMinusDstAlphaFactor)return Nt.ONE_MINUS_DST_ALPHA;if(t===e.DstColorFactor)return Nt.DST_COLOR;if(t===e.OneMinusDstColorFactor)return Nt.ONE_MINUS_DST_COLOR;if(t===e.SrcAlphaSaturateFactor)return Nt.SRC_ALPHA_SATURATE;if(void 0!==At){if(t===e.RGB_S3TC_DXT1_Format)return At.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT1_Format)return At.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT3_Format)return At.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===e.RGBA_S3TC_DXT5_Format)return At.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",e.REVISION);var t=t||{},P=void 0!==t.canvas?t.canvas:document.createElement("canvas"),H=void 0!==t.precision?t.precision:"highp",B=void 0!==t.alpha?t.alpha:!0,j=void 0!==t.premultipliedAlpha?t.premultipliedAlpha:!0,F=void 0!==t.antialias?t.antialias:!1,I=void 0!==t.stencil?t.stencil:!0,q=void 0!==t.preserveDrawingBuffer?t.preserveDrawingBuffer:!1,R=new e.Color(0),U=0;void 0!==t.clearColor&&(console.warn("DEPRECATED: clearColor in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),R.setHex(t.clearColor)),void 0!==t.clearAlpha&&(console.warn("DEPRECATED: clearAlpha in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),U=t.clearAlpha),this.domElement=P,this.context=null,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=e.PCFShadowMap,this.shadowMapCullFace=e.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var z=this,W=[],X=0,V=null,$=null,J=-1,K=null,Q=null,G=0,Y=0,Z=-1,et=-1,tt=-1,nt=-1,rt=-1,it=-1,st=-1,ot=-1,ut=null,at=null,ft=null,lt=null,ct=0,ht=0,pt=0,dt=0,vt=0,mt=0,gt={},yt=new e.Frustum,bt=new e.Matrix4,wt=new e.Matrix4,Et=new e.Vector3,St=new e.Vector3,xt=!0,Tt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},Nt,Ct,kt,Lt,At;try{if(!(Nt=P.getContext("experimental-webgl",{alpha:B,premultipliedAlpha:j,antialias:F,stencil:I,preserveDrawingBuffer:q})))throw"Error creating WebGL context."}catch(Ot){console.error(Ot)}Ct=Nt.getExtension("OES_texture_float"),kt=Nt.getExtension("OES_standard_derivatives"),Lt=Nt.getExtension("EXT_texture_filter_anisotropic")||Nt.getExtension("MOZ_EXT_texture_filter_anisotropic")||Nt.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),At=Nt.getExtension("WEBGL_compressed_texture_s3tc")||Nt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Nt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Ct||console.log("THREE.WebGLRenderer: Float textures not supported."),kt||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),Lt||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),At||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Nt.getShaderPrecisionFormat&&(Nt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),Nt.clearColor(0,0,0,1),Nt.clearDepth(1),Nt.clearStencil(0),Nt.enable(Nt.DEPTH_TEST),Nt.depthFunc(Nt.LEQUAL),Nt.frontFace(Nt.CCW),Nt.cullFace(Nt.BACK),Nt.enable(Nt.CULL_FACE),Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.SRC_ALPHA,Nt.ONE_MINUS_SRC_ALPHA),Nt.clearColor(R.r,R.g,R.b,U),this.context=Nt;var Mt=Nt.getParameter(Nt.MAX_TEXTURE_IMAGE_UNITS),_t=Nt.getParameter(Nt.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Nt.getParameter(Nt.MAX_TEXTURE_SIZE);var Dt=Nt.getParameter(Nt.MAX_CUBE_MAP_TEXTURE_SIZE),Pt=Lt?Nt.getParameter(Lt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Ht=0<_t,Bt=Ht&&Ct;At&&Nt.getParameter(Nt.COMPRESSED_TEXTURE_FORMATS);var jt=Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.HIGH_FLOAT),Ft=Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.MEDIUM_FLOAT);Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.LOW_FLOAT);var It=Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.HIGH_FLOAT),qt=Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.MEDIUM_FLOAT);Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.LOW_FLOAT),Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.HIGH_INT),Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.MEDIUM_INT),Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.LOW_INT),Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.HIGH_INT),Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.MEDIUM_INT),Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.LOW_INT);var Rt=0<jt.precision&&0<It.precision,Ut=0<Ft.precision&&0<qt.precision;"highp"===H&&!Rt&&(Ut?(H="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(H="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"===H&&!Ut&&(H="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Nt},this.supportsVertexTextures=function(){return Ht},this.supportsFloatTextures=function(){return Ct},this.supportsStandardDerivatives=function(){return kt},this.supportsCompressedTextureS3TC=function(){return At},this.getMaxAnisotropy=function(){return Pt},this.getPrecision=function(){return H},this.setSize=function(e,t,n){P.width=e*this.devicePixelRatio,P.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==n&&(P.style.width=e+"px",P.style.height=t+"px"),this.setViewport(0,0,P.width,P.height)},this.setViewport=function(e,t,n,r){ct=void 0!==e?e:0,ht=void 0!==t?t:0,pt=void 0!==n?n:P.width,dt=void 0!==r?r:P.height,Nt.viewport(ct,ht,pt,dt)},this.setScissor=function(e,t,n,r){Nt.scissor(e,t,n,r)},this.enableScissorTest=function(e){e?Nt.enable(Nt.SCISSOR_TEST):Nt.disable(Nt.SCISSOR_TEST)},this.setClearColor=function(e,t){R.set(e),U=void 0!==t?t:1,Nt.clearColor(R.r,R.g,R.b,U)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return R},this.getClearAlpha=function(){return U},this.clear=function(e,t,n){var r=0;if(void 0===e||e)r|=Nt.COLOR_BUFFER_BIT;if(void 0===t||t)r|=Nt.DEPTH_BUFFER_BIT;if(void 0===n||n)r|=Nt.STENCIL_BUFFER_BIT;Nt.clear(r)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){V=null,J=K=ot=st=tt=-1,xt=!0,et=Z=-1,this.shadowMapPlugin.update(e,t)};var zt=function(e){e=e.target,e.removeEventListener("dispose",zt),e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&Nt.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Nt.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Nt.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Nt.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Nt.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Nt.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Nt.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Nt.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Nt.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Nt.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Nt.deleteBuffer(e.__webglLineDistanceBuffer);if(void 0!==e.geometryGroups)for(var t in e.geometryGroups){var r=e.geometryGroups[t];if(void 0!==r.numMorphTargets)for(var i=0,s=r.numMorphTargets;i<s;i++)Nt.deleteBuffer(r.__webglMorphTargetsBuffers[i]);if(void 0!==r.numMorphNormals){i=0;for(s=r.numMorphNormals;i<s;i++)Nt.deleteBuffer(r.__webglMorphNormalsBuffers[i])}n(r)}n(e),z.info.memory.geometries--},Wt=function(e){e=e.target,e.removeEventListener("dispose",Wt),e.image&&e.image.__webglTextureCube?Nt.deleteTexture(e.image.__webglTextureCube):e.__webglInit&&(e.__webglInit=!1,Nt.deleteTexture(e.__webglTexture)),z.info.memory.textures--},Xt=function(t){t=t.target,t.removeEventListener("dispose",Xt);if(t&&t.__webglTexture)if(Nt.deleteTexture(t.__webglTexture),t instanceof e.WebGLRenderTargetCube)for(var n=0;6>n;n++)Nt.deleteFramebuffer(t.__webglFramebuffer[n]),Nt.deleteRenderbuffer(t.__webglRenderbuffer[n]);else Nt.deleteFramebuffer(t.__webglFramebuffer),Nt.deleteRenderbuffer(t.__webglRenderbuffer);z.info.memory.textures--},Vt=function(e){e=e.target,e.removeEventListener("dispose",Vt),$t(e)},$t=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var n,r,i=!1,e=0;for(n=W.length;e<n;e++)if(r=W[e],r.program===t){r.usedTimes--,0===r.usedTimes&&(i=!0);break}if(!0===i){i=[],e=0;for(n=W.length;e<n;e++)r=W[e],r.program!==t&&i.push(r);W=i,Nt.deleteProgram(t),z.info.memory.programs--}}};this.renderBufferImmediate=function(t,n,r){t.hasPositions&&!t.__webglVertexBuffer&&(t.__webglVertexBuffer=Nt.createBuffer()),t.hasNormals&&!t.__webglNormalBuffer&&(t.__webglNormalBuffer=Nt.createBuffer()),t.hasUvs&&!t.__webglUvBuffer&&(t.__webglUvBuffer=Nt.createBuffer()),t.hasColors&&!t.__webglColorBuffer&&(t.__webglColorBuffer=Nt.createBuffer()),t.hasPositions&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,t.positionArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(n.attributes.position),Nt.vertexAttribPointer(n.attributes.position,3,Nt.FLOAT,!1,0,0));if(t.hasNormals){Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglNormalBuffer);if(r.shading===e.FlatShading){var i,s,o,u,a,f,l,c,h,p,d,v=3*t.count;for(d=0;d<v;d+=9)p=t.normalArray,i=p[d],s=p[d+1],o=p[d+2],u=p[d+3],f=p[d+4],c=p[d+5],a=p[d+6],l=p[d+7],h=p[d+8],i=(i+u+a)/3,s=(s+f+l)/3,o=(o+c+h)/3,p[d]=i,p[d+1]=s,p[d+2]=o,p[d+3]=i,p[d+4]=s,p[d+5]=o,p[d+6]=i,p[d+7]=s,p[d+8]=o}Nt.bufferData(Nt.ARRAY_BUFFER,t.normalArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(n.attributes.normal),Nt.vertexAttribPointer(n.attributes.normal,3,Nt.FLOAT,!1,0,0)}t.hasUvs&&r.map&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglUvBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,t.uvArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(n.attributes.uv),Nt.vertexAttribPointer(n.attributes.uv,2,Nt.FLOAT,!1,0,0)),t.hasColors&&r.vertexColors!==e.NoColors&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,t.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,t.colorArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(n.attributes.color),Nt.vertexAttribPointer(n.attributes.color,3,Nt.FLOAT,!1,0,0)),Nt.drawArrays(Nt.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,n,r,i,s,o){if(!1!==i.visible){var u,l,c;u=S(t,n,r,i,o),t=u.attributes,n=s.attributes,r=!1,u=16777215*s.id+2*u.id+(i.wireframe?1:0),u!==K&&(K=u,r=!0),r&&f();if(o instanceof e.Mesh)if(i=n.index){s=s.offsets,1<s.length&&(r=!0);for(var h=0,p=s.length;h<p;h++){var d=s[h].index;if(r){for(l in n)"index"!==l&&(u=t[l],o=n[l],c=o.itemSize,0<=u&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.buffer),a(u),Nt.vertexAttribPointer(u,c,Nt.FLOAT,!1,0,4*d*c)));Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,i.buffer)}Nt.drawElements(Nt.TRIANGLES,s[h].count,Nt.UNSIGNED_SHORT,2*s[h].start),z.info.render.calls++,z.info.render.vertices+=s[h].count,z.info.render.faces+=s[h].count/3}}else{if(r)for(l in n)"index"!==l&&(u=t[l],o=n[l],c=o.itemSize,0<=u&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.buffer),a(u),Nt.vertexAttribPointer(u,c,Nt.FLOAT,!1,0,0)));l=s.attributes.position,Nt.drawArrays(Nt.TRIANGLES,0,l.numItems/3),z.info.render.calls++,z.info.render.vertices+=l.numItems/3,z.info.render.faces+=l.numItems/3/3}else if(o instanceof e.ParticleSystem){if(r){for(l in n)u=t[l],o=n[l],c=o.itemSize,0<=u&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.buffer),a(u),Nt.vertexAttribPointer(u,c,Nt.FLOAT,!1,0,0));l=n.position,Nt.drawArrays(Nt.POINTS,0,l.numItems/3),z.info.render.calls++,z.info.render.points+=l.numItems/3}}else if(o instanceof e.Line&&r){for(l in n)u=t[l],o=n[l],c=o.itemSize,0<=u&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,o.buffer),a(u),Nt.vertexAttribPointer(u,c,Nt.FLOAT,!1,0,0));C(i.linewidth),l=n.position,Nt.drawArrays(Nt.LINE_STRIP,0,l.numItems/3),z.info.render.calls++,z.info.render.points+=l.numItems}}},this.renderBuffer=function(t,n,r,i,s,o){if(!1!==i.visible){var u,l,r=S(t,n,r,i,o),t=r.attributes,n=!1,r=16777215*s.id+2*r.id+(i.wireframe?1:0);r!==K&&(K=r,n=!0),n&&f();if(!i.morphTargets&&0<=t.position)n&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglVertexBuffer),a(t.position),Nt.vertexAttribPointer(t.position,3,Nt.FLOAT,!1,0,0));else if(o.morphTargetBase){r=i.program.attributes,-1!==o.morphTargetBase&&0<=r.position?(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglMorphTargetsBuffers[o.morphTargetBase]),a(r.position),Nt.vertexAttribPointer(r.position,3,Nt.FLOAT,!1,0,0)):0<=r.position&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglVertexBuffer),a(r.position),Nt.vertexAttribPointer(r.position,3,Nt.FLOAT,!1,0,0));if(o.morphTargetForcedOrder.length){var h=0;l=o.morphTargetForcedOrder;for(u=o.morphTargetInfluences;h<i.numSupportedMorphTargets&&h<l.length;)0<=r["morphTarget"+h]&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglMorphTargetsBuffers[l[h]]),a(r["morphTarget"+h]),Nt.vertexAttribPointer(r["morphTarget"+h],3,Nt.FLOAT,!1,0,0)),0<=r["morphNormal"+h]&&i.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglMorphNormalsBuffers[l[h]]),a(r["morphNormal"+h]),Nt.vertexAttribPointer(r["morphNormal"+h],3,Nt.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[h]=u[l[h]],h++}else{l=[],u=o.morphTargetInfluences;var p,d=u.length;for(p=0;p<d;p++)h=u[p],0<h&&l.push([h,p]);l.length>i.numSupportedMorphTargets?(l.sort(c),l.length=i.numSupportedMorphTargets):l.length>i.numSupportedMorphNormals?l.sort(c):0===l.length&&l.push([0,0]);for(h=0;h<i.numSupportedMorphTargets;)l[h]?(p=l[h][1],0<=r["morphTarget"+h]&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglMorphTargetsBuffers[p]),a(r["morphTarget"+h]),Nt.vertexAttribPointer(r["morphTarget"+h],3,Nt.FLOAT,!1,0,0)),0<=r["morphNormal"+h]&&i.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglMorphNormalsBuffers[p]),a(r["morphNormal"+h]),Nt.vertexAttribPointer(r["morphNormal"+h],3,Nt.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[h]=u[p]):o.__webglMorphTargetInfluences[h]=0,h++}null!==i.program.uniforms.morphTargetInfluences&&Nt.uniform1fv(i.program.uniforms.morphTargetInfluences,o.__webglMorphTargetInfluences)}if(n){if(s.__webglCustomAttributesList){u=0;for(l=s.__webglCustomAttributesList.length;u<l;u++)r=s.__webglCustomAttributesList[u],0<=t[r.buffer.belongsToAttribute]&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,r.buffer),a(t[r.buffer.belongsToAttribute]),Nt.vertexAttribPointer(t[r.buffer.belongsToAttribute],r.size,Nt.FLOAT,!1,0,0))}0<=t.color&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglColorBuffer),a(t.color),Nt.vertexAttribPointer(t.color,3,Nt.FLOAT,!1,0,0)),0<=t.normal&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglNormalBuffer),a(t.normal),Nt.vertexAttribPointer(t.normal,3,Nt.FLOAT,!1,0,0)),0<=t.tangent&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglTangentBuffer),a(t.tangent),Nt.vertexAttribPointer(t.tangent,4,Nt.FLOAT,!1,0,0)),0<=t.uv&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglUVBuffer),a(t.uv),Nt.vertexAttribPointer(t.uv,2,Nt.FLOAT,!1,0,0)),0<=t.uv2&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglUV2Buffer),a(t.uv2),Nt.vertexAttribPointer(t.uv2,2,Nt.FLOAT,!1,0,0)),i.skinning&&0<=t.skinIndex&&0<=t.skinWeight&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglSkinIndicesBuffer),a(t.skinIndex),Nt.vertexAttribPointer(t.skinIndex,4,Nt.FLOAT,!1,0,0),Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglSkinWeightsBuffer),a(t.skinWeight),Nt.vertexAttribPointer(t.skinWeight,4,Nt.FLOAT,!1,0,0)),0<=t.lineDistance&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,s.__webglLineDistanceBuffer),a(t.lineDistance),Nt.vertexAttribPointer(t.lineDistance,1,Nt.FLOAT,!1,0,0))}o instanceof e.Mesh?(i.wireframe?(C(i.wireframeLinewidth),n&&Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,s.__webglLineBuffer),Nt.drawElements(Nt.LINES,s.__webglLineCount,Nt.UNSIGNED_SHORT,0)):(n&&Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,s.__webglFaceBuffer),Nt.drawElements(Nt.TRIANGLES,s.__webglFaceCount,Nt.UNSIGNED_SHORT,0)),z.info.render.calls++,z.info.render.vertices+=s.__webglFaceCount,z.info.render.faces+=s.__webglFaceCount/3):o instanceof e.Line?(o=o.type===e.LineStrip?Nt.LINE_STRIP:Nt.LINES,C(i.linewidth),Nt.drawArrays(o,0,s.__webglLineCount),z.info.render.calls++):o instanceof e.ParticleSystem?(Nt.drawArrays(Nt.POINTS,0,s.__webglParticleCount),z.info.render.calls++,z.info.render.points+=s.__webglParticleCount):o instanceof e.Ribbon&&(Nt.drawArrays(Nt.TRIANGLE_STRIP,0,s.__webglVertexCount),z.info.render.calls++)}},this.render=function(t,n,r,i){if(0==n instanceof e.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var s,o,u,a,f=t.__lights,c=t.fog;J=-1,xt=!0,!0===t.autoUpdate&&t.updateMatrixWorld(),void 0===n.parent&&n.updateMatrixWorld(),n.matrixWorldInverse.getInverse(n.matrixWorld),bt.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),yt.setFromMatrix(bt),this.autoUpdateObjects&&this.initWebGLObjects(t),h(this.renderPluginsPre,t,n),z.info.render.calls=0,z.info.render.vertices=0,z.info.render.faces=0,z.info.render.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),a=t.__webglObjects,i=0;for(s=a.length;i<s;i++)if(o=a[i],u=o.object,o.id=i,o.render=!1,u.visible&&(!(u instanceof e.Mesh||u instanceof e.ParticleSystem)||!u.frustumCulled||yt.intersectsObject(u))){var v=u;v._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,v.matrixWorld),v._normalMatrix.getNormalMatrix(v._modelViewMatrix);var v=o,m=v.buffer,g=void 0,y=g=void 0,y=v.object.material;if(y instanceof e.MeshFaceMaterial)g=m.materialIndex,g=y.materials[g],g.transparent?(v.transparent=g,v.opaque=null):(v.opaque=g,v.transparent=null);else if(g=y)g.transparent?(v.transparent=g,v.opaque=null):(v.opaque=g,v.transparent=null);o.render=!0,!0===this.sortObjects&&(null!==u.renderDepth?o.z=u.renderDepth:(Et.getPositionFromMatrix(u.matrixWorld),Et.applyProjection(bt),o.z=Et.z))}this.sortObjects&&a.sort(l),a=t.__webglObjectsImmediate,i=0;for(s=a.length;i<s;i++)o=a[i],u=o.object,u.visible&&(u._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,u.matrixWorld),u._normalMatrix.getNormalMatrix(u._modelViewMatrix),u=o.object.material,u.transparent?(o.transparent=u,o.opaque=null):(o.opaque=u,o.transparent=null));t.overrideMaterial?(i=t.overrideMaterial,this.setBlending(i.blending,i.blendEquation,i.blendSrc,i.blendDst),this.setDepthTest(i.depthTest),this.setDepthWrite(i.depthWrite),k(i.polygonOffset,i.polygonOffsetFactor,i.polygonOffsetUnits),p(t.__webglObjects,!1,"",n,f,c,!0,i),d(t.__webglObjectsImmediate,"",n,f,c,!1,i)):(i=null,this.setBlending(e.NoBlending),p(t.__webglObjects,!0,"opaque",n,f,c,!1,i),d(t.__webglObjectsImmediate,"opaque",n,f,c,!1,i),p(t.__webglObjects,!1,"transparent",n,f,c,!0,i),d(t.__webglObjectsImmediate,"transparent",n,f,c,!0,i)),h(this.renderPluginsPost,t,n),r&&r.generateMipmaps&&r.minFilter!==e.NearestFilter&&r.minFilter!==e.LinearFilter&&(r instanceof e.WebGLRenderTargetCube?(Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,r.__webglTexture),Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,null)):(Nt.bindTexture(Nt.TEXTURE_2D,r.__webglTexture),Nt.generateMipmap(Nt.TEXTURE_2D),Nt.bindTexture(Nt.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,n,r,i){var s=S(e,t,n,r,i);K=-1,z.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(s,Nt,yt):i.render(function(e){z.renderBufferImmediate(e,s,r)})},this.initWebGLObjects=function(t){t.__webglObjects||(t.__webglObjects=[],t.__webglObjectsImmediate=[],t.__webglSprites=[],t.__webglFlares=[]);for(;t.__objectsAdded.length;)v(t.__objectsAdded[0],t),t.__objectsAdded.splice(0,1);for(;t.__objectsRemoved.length;)b(t.__objectsRemoved[0],t),t.__objectsRemoved.splice(0,1);for(var n=0,r=t.__webglObjects.length;n<r;n++){var a=t.__webglObjects[n].object;void 0===a.__webglInit&&(void 0!==a.__webglActive&&b(a,t),v(a,t));var f=a,l=f.geometry,h=void 0,p=void 0,d=void 0;if(l instanceof e.BufferGeometry){var m=Nt.DYNAMIC_DRAW,w=!l.dynamic,E=l.attributes,S=void 0,x=void 0;for(S in E)x=E[S],x.needsUpdate&&("index"===S?(Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,x.buffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,x.array,m)):(Nt.bindBuffer(Nt.ARRAY_BUFFER,x.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,x.array,m)),x.needsUpdate=!1),w&&!x.dynamic&&delete x.array}else if(f instanceof e.Mesh){for(var T=0,N=l.geometryGroupsList.length;T<N;T++)if(h=l.geometryGroupsList[T],d=s(f,h),l.buffersNeedUpdate&&i(h,f),p=d.attributes&&g(d),l.verticesNeedUpdate||l.morphTargetsNeedUpdate||l.elementsNeedUpdate||l.uvsNeedUpdate||l.normalsNeedUpdate||l.colorsNeedUpdate||l.tangentsNeedUpdate||p){var C=h,k=f,L=Nt.DYNAMIC_DRAW,A=!l.dynamic,O=d;if(C.__inittedArrays){var M=o(O),_=O.vertexColors?O.vertexColors:!1,D=u(O),P=M===e.SmoothShading,H=void 0,B=void 0,j=void 0,F=void 0,I=void 0,q=void 0,R=void 0,U=void 0,z=void 0,W=void 0,X=void 0,V=void 0,$=void 0,J=void 0,K=void 0,Q=void 0,G=void 0,Y=void 0,Z=void 0,et=void 0,tt=void 0,nt=void 0,rt=void 0,it=void 0,st=void 0,ot=void 0,ut=void 0,at=void 0,ft=void 0,lt=void 0,ct=void 0,ht=void 0,pt=void 0,dt=void 0,vt=void 0,mt=void 0,gt=void 0,yt=void 0,St=void 0,xt=void 0,Tt=void 0,Ct=void 0,kt=void 0,Lt=void 0,At=void 0,Ot=void 0,Mt=0,_t=0,Dt=0,Pt=0,Ht=0,Bt=0,jt=0,Ft=0,It=0,qt=0,Rt=0,Ut=0,zt=void 0,Wt=C.__vertexArray,Xt=C.__uvArray,Vt=C.__uv2Array,$t=C.__normalArray,Jt=C.__tangentArray,Kt=C.__colorArray,Qt=C.__skinIndexArray,Gt=C.__skinWeightArray,Yt=C.__morphTargetsArrays,Zt=C.__morphNormalsArrays,en=C.__webglCustomAttributesList,tn=void 0,nn=C.__faceArray,rn=C.__lineArray,sn=k.geometry,on=sn.elementsNeedUpdate,un=sn.uvsNeedUpdate,an=sn.normalsNeedUpdate,fn=sn.tangentsNeedUpdate,ln=sn.colorsNeedUpdate,cn=sn.morphTargetsNeedUpdate,hn=sn.vertices,pn=C.faces3,dn=C.faces4,vn=sn.faces,mn=sn.faceVertexUvs[0],gn=sn.faceVertexUvs[1],yn=sn.skinIndices,bn=sn.skinWeights,wn=sn.morphTargets,En=sn.morphNormals;if(sn.verticesNeedUpdate){H=0;for(B=pn.length;H<B;H++)F=vn[pn[H]],V=hn[F.a],$=hn[F.b],J=hn[F.c],Wt[_t]=V.x,Wt[_t+1]=V.y,Wt[_t+2]=V.z,Wt[_t+3]=$.x,Wt[_t+4]=$.y,Wt[_t+5]=$.z,Wt[_t+6]=J.x,Wt[_t+7]=J.y,Wt[_t+8]=J.z,_t+=9;H=0;for(B=dn.length;H<B;H++)F=vn[dn[H]],V=hn[F.a],$=hn[F.b],J=hn[F.c],K=hn[F.d],Wt[_t]=V.x,Wt[_t+1]=V.y,Wt[_t+2]=V.z,Wt[_t+3]=$.x,Wt[_t+4]=$.y,Wt[_t+5]=$.z,Wt[_t+6]=J.x,Wt[_t+7]=J.y,Wt[_t+8]=J.z,Wt[_t+9]=K.x,Wt[_t+10]=K.y,Wt[_t+11]=K.z,_t+=12;Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Wt,L)}if(cn){Tt=0;for(Ct=wn.length;Tt<Ct;Tt++){H=Rt=0;for(B=pn.length;H<B;H++)At=pn[H],F=vn[At],V=wn[Tt].vertices[F.a],$=wn[Tt].vertices[F.b],J=wn[Tt].vertices[F.c],kt=Yt[Tt],kt[Rt]=V.x,kt[Rt+1]=V.y,kt[Rt+2]=V.z,kt[Rt+3]=$.x,kt[Rt+4]=$.y,kt[Rt+5]=$.z,kt[Rt+6]=J.x,kt[Rt+7]=J.y,kt[Rt+8]=J.z,O.morphNormals&&(P?(Ot=En[Tt].vertexNormals[At],et=Ot.a,tt=Ot.b,nt=Ot.c):nt=tt=et=En[Tt].faceNormals[At],Lt=Zt[Tt],Lt[Rt]=et.x,Lt[Rt+1]=et.y,Lt[Rt+2]=et.z,Lt[Rt+3]=tt.x,Lt[Rt+4]=tt.y,Lt[Rt+5]=tt.z,Lt[Rt+6]=nt.x,Lt[Rt+7]=nt.y,Lt[Rt+8]=nt.z),Rt+=9;H=0;for(B=dn.length;H<B;H++)At=dn[H],F=vn[At],V=wn[Tt].vertices[F.a],$=wn[Tt].vertices[F.b],J=wn[Tt].vertices[F.c],K=wn[Tt].vertices[F.d],kt=Yt[Tt],kt[Rt]=V.x,kt[Rt+1]=V.y,kt[Rt+2]=V.z,kt[Rt+3]=$.x,kt[Rt+4]=$.y,kt[Rt+5]=$.z,kt[Rt+6]=J.x,kt[Rt+7]=J.y,kt[Rt+8]=J.z,kt[Rt+9]=K.x,kt[Rt+10]=K.y,kt[Rt+11]=K.z,O.morphNormals&&(P?(Ot=En[Tt].vertexNormals[At],et=Ot.a,tt=Ot.b,nt=Ot.c,rt=Ot.d):rt=nt=tt=et=En[Tt].faceNormals[At],Lt=Zt[Tt],Lt[Rt]=et.x,Lt[Rt+1]=et.y,Lt[Rt+2]=et.z,Lt[Rt+3]=tt.x,Lt[Rt+4]=tt.y,Lt[Rt+5]=tt.z,Lt[Rt+6]=nt.x,Lt[Rt+7]=nt.y,Lt[Rt+8]=nt.z,Lt[Rt+9]=rt.x,Lt[Rt+10]=rt.y,Lt[Rt+11]=rt.z),Rt+=12;Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglMorphTargetsBuffers[Tt]),Nt.bufferData(Nt.ARRAY_BUFFER,Yt[Tt],L),O.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglMorphNormalsBuffers[Tt]),Nt.bufferData(Nt.ARRAY_BUFFER,Zt[Tt],L))}}if(bn.length){H=0;for(B=pn.length;H<B;H++)F=vn[pn[H]],at=bn[F.a],ft=bn[F.b],lt=bn[F.c],Gt[qt]=at.x,Gt[qt+1]=at.y,Gt[qt+2]=at.z,Gt[qt+3]=at.w,Gt[qt+4]=ft.x,Gt[qt+5]=ft.y,Gt[qt+6]=ft.z,Gt[qt+7]=ft.w,Gt[qt+8]=lt.x,Gt[qt+9]=lt.y,Gt[qt+10]=lt.z,Gt[qt+11]=lt.w,ht=yn[F.a],pt=yn[F.b],dt=yn[F.c],Qt[qt]=ht.x,Qt[qt+1]=ht.y,Qt[qt+2]=ht.z,Qt[qt+3]=ht.w,Qt[qt+4]=pt.x,Qt[qt+5]=pt.y,Qt[qt+6]=pt.z,Qt[qt+7]=pt.w,Qt[qt+8]=dt.x,Qt[qt+9]=dt.y,Qt[qt+10]=dt.z,Qt[qt+11]=dt.w,qt+=12;H=0;for(B=dn.length;H<B;H++)F=vn[dn[H]],at=bn[F.a],ft=bn[F.b],lt=bn[F.c],ct=bn[F.d],Gt[qt]=at.x,Gt[qt+1]=at.y,Gt[qt+2]=at.z,Gt[qt+3]=at.w,Gt[qt+4]=ft.x,Gt[qt+5]=ft.y,Gt[qt+6]=ft.z,Gt[qt+7]=ft.w,Gt[qt+8]=lt.x,Gt[qt+9]=lt.y,Gt[qt+10]=lt.z,Gt[qt+11]=lt.w,Gt[qt+12]=ct.x,Gt[qt+13]=ct.y,Gt[qt+14]=ct.z,Gt[qt+15]=ct.w,ht=yn[F.a],pt=yn[F.b],dt=yn[F.c],vt=yn[F.d],Qt[qt]=ht.x,Qt[qt+1]=ht.y,Qt[qt+2]=ht.z,Qt[qt+3]=ht.w,Qt[qt+4]=pt.x,Qt[qt+5]=pt.y,Qt[qt+6]=pt.z,Qt[qt+7]=pt.w,Qt[qt+8]=dt.x,Qt[qt+9]=dt.y,Qt[qt+10]=dt.z,Qt[qt+11]=dt.w,Qt[qt+12]=vt.x,Qt[qt+13]=vt.y,Qt[qt+14]=vt.z,Qt[qt+15]=vt.w,qt+=16;0<qt&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglSkinIndicesBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Qt,L),Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglSkinWeightsBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Gt,L))}if(ln&&_){H=0;for(B=pn.length;H<B;H++)F=vn[pn[H]],R=F.vertexColors,U=F.color,3===R.length&&_===e.VertexColors?(it=R[0],st=R[1],ot=R[2]):ot=st=it=U,Kt[It]=it.r,Kt[It+1]=it.g,Kt[It+2]=it.b,Kt[It+3]=st.r,Kt[It+4]=st.g,Kt[It+5]=st.b,Kt[It+6]=ot.r,Kt[It+7]=ot.g,Kt[It+8]=ot.b,It+=9;H=0;for(B=dn.length;H<B;H++)F=vn[dn[H]],R=F.vertexColors,U=F.color,4===R.length&&_===e.VertexColors?(it=R[0],st=R[1],ot=R[2],ut=R[3]):ut=ot=st=it=U,Kt[It]=it.r,Kt[It+1]=it.g,Kt[It+2]=it.b,Kt[It+3]=st.r,Kt[It+4]=st.g,Kt[It+5]=st.b,Kt[It+6]=ot.r,Kt[It+7]=ot.g,Kt[It+8]=ot.b,Kt[It+9]=ut.r,Kt[It+10]=ut.g,Kt[It+11]=ut.b,It+=12;0<It&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Kt,L))}if(fn&&sn.hasTangents){H=0;for(B=pn.length;H<B;H++)F=vn[pn[H]],z=F.vertexTangents,Q=z[0],G=z[1],Y=z[2],Jt[jt]=Q.x,Jt[jt+1]=Q.y,Jt[jt+2]=Q.z,Jt[jt+3]=Q.w,Jt[jt+4]=G.x,Jt[jt+5]=G.y,Jt[jt+6]=G.z,Jt[jt+7]=G.w,Jt[jt+8]=Y.x,Jt[jt+9]=Y.y,Jt[jt+10]=Y.z,Jt[jt+11]=Y.w,jt+=12;H=0;for(B=dn.length;H<B;H++)F=vn[dn[H]],z=F.vertexTangents,Q=z[0],G=z[1],Y=z[2],Z=z[3],Jt[jt]=Q.x,Jt[jt+1]=Q.y,Jt[jt+2]=Q.z,Jt[jt+3]=Q.w,Jt[jt+4]=G.x,Jt[jt+5]=G.y,Jt[jt+6]=G.z,Jt[jt+7]=G.w,Jt[jt+8]=Y.x,Jt[jt+9]=Y.y,Jt[jt+10]=Y.z,Jt[jt+11]=Y.w,Jt[jt+12]=Z.x,Jt[jt+13]=Z.y,Jt[jt+14]=Z.z,Jt[jt+15]=Z.w,jt+=16;Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglTangentBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Jt,L)}if(an&&M){H=0;for(B=pn.length;H<B;H++)if(F=vn[pn[H]],I=F.vertexNormals,q=F.normal,3===I.length&&P)for(mt=0;3>mt;mt++)yt=I[mt],$t[Bt]=yt.x,$t[Bt+1]=yt.y,$t[Bt+2]=yt.z,Bt+=3;else for(mt=0;3>mt;mt++)$t[Bt]=q.x,$t[Bt+1]=q.y,$t[Bt+2]=q.z,Bt+=3;H=0;for(B=dn.length;H<B;H++)if(F=vn[dn[H]],I=F.vertexNormals,q=F.normal,4===I.length&&P)for(mt=0;4>mt;mt++)yt=I[mt],$t[Bt]=yt.x,$t[Bt+1]=yt.y,$t[Bt+2]=yt.z,Bt+=3;else for(mt=0;4>mt;mt++)$t[Bt]=q.x,$t[Bt+1]=q.y,$t[Bt+2]=q.z,Bt+=3;Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglNormalBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,$t,L)}if(un&&mn&&D){H=0;for(B=pn.length;H<B;H++)if(j=pn[H],W=mn[j],void 0!==W)for(mt=0;3>mt;mt++)St=W[mt],Xt[Dt]=St.x,Xt[Dt+1]=St.y,Dt+=2;H=0;for(B=dn.length;H<B;H++)if(j=dn[H],W=mn[j],void 0!==W)for(mt=0;4>mt;mt++)St=W[mt],Xt[Dt]=St.x,Xt[Dt+1]=St.y,Dt+=2;0<Dt&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglUVBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Xt,L))}if(un&&gn&&D){H=0;for(B=pn.length;H<B;H++)if(j=pn[H],X=gn[j],void 0!==X)for(mt=0;3>mt;mt++)xt=X[mt],Vt[Pt]=xt.x,Vt[Pt+1]=xt.y,Pt+=2;H=0;for(B=dn.length;H<B;H++)if(j=dn[H],X=gn[j],void 0!==X)for(mt=0;4>mt;mt++)xt=X[mt],Vt[Pt]=xt.x,Vt[Pt+1]=xt.y,Pt+=2;0<Pt&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,C.__webglUV2Buffer),Nt.bufferData(Nt.ARRAY_BUFFER,Vt,L))}if(on){H=0;for(B=pn.length;H<B;H++)nn[Ht]=Mt,nn[Ht+1]=Mt+1,nn[Ht+2]=Mt+2,Ht+=3,rn[Ft]=Mt,rn[Ft+1]=Mt+1,rn[Ft+2]=Mt,rn[Ft+3]=Mt+2,rn[Ft+4]=Mt+1,rn[Ft+5]=Mt+2,Ft+=6,Mt+=3;H=0;for(B=dn.length;H<B;H++)nn[Ht]=Mt,nn[Ht+1]=Mt+1,nn[Ht+2]=Mt+3,nn[Ht+3]=Mt+1,nn[Ht+4]=Mt+2,nn[Ht+5]=Mt+3,Ht+=6,rn[Ft]=Mt,rn[Ft+1]=Mt+1,rn[Ft+2]=Mt,rn[Ft+3]=Mt+3,rn[Ft+4]=Mt+1,rn[Ft+5]=Mt+2,rn[Ft+6]=Mt+2,rn[Ft+7]=Mt+3,Ft+=8,Mt+=4;Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,C.__webglFaceBuffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,nn,L),Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,C.__webglLineBuffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,rn,L)}if(en){mt=0;for(gt=en.length;mt<gt;mt++)if(tn=en[mt],tn.__original.needsUpdate){Ut=0;if(1===tn.size){if(void 0===tn.boundTo||"vertices"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)F=vn[pn[H]],tn.array[Ut]=tn.value[F.a],tn.array[Ut+1]=tn.value[F.b],tn.array[Ut+2]=tn.value[F.c],Ut+=3;H=0;for(B=dn.length;H<B;H++)F=vn[dn[H]],tn.array[Ut]=tn.value[F.a],tn.array[Ut+1]=tn.value[F.b],tn.array[Ut+2]=tn.value[F.c],tn.array[Ut+3]=tn.value[F.d],Ut+=4}else if("faces"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)zt=tn.value[pn[H]],tn.array[Ut]=zt,tn.array[Ut+1]=zt,tn.array[Ut+2]=zt,Ut+=3;H=0;for(B=dn.length;H<B;H++)zt=tn.value[dn[H]],tn.array[Ut]=zt,tn.array[Ut+1]=zt,tn.array[Ut+2]=zt,tn.array[Ut+3]=zt,Ut+=4}}else if(2===tn.size){if(void 0===tn.boundTo||"vertices"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)F=vn[pn[H]],V=tn.value[F.a],$=tn.value[F.b],J=tn.value[F.c],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=$.x,tn.array[Ut+3]=$.y,tn.array[Ut+4]=J.x,tn.array[Ut+5]=J.y,Ut+=6;H=0;for(B=dn.length;H<B;H++)F=vn[dn[H]],V=tn.value[F.a],$=tn.value[F.b],J=tn.value[F.c],K=tn.value[F.d],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=$.x,tn.array[Ut+3]=$.y,tn.array[Ut+4]=J.x,tn.array[Ut+5]=J.y,tn.array[Ut+6]=K.x,tn.array[Ut+7]=K.y,Ut+=8}else if("faces"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)J=$=V=zt=tn.value[pn[H]],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=$.x,tn.array[Ut+3]=$.y,tn.array[Ut+4]=J.x,tn.array[Ut+5]=J.y,Ut+=6;H=0;for(B=dn.length;H<B;H++)K=J=$=V=zt=tn.value[dn[H]],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=$.x,tn.array[Ut+3]=$.y,tn.array[Ut+4]=J.x,tn.array[Ut+5]=J.y,tn.array[Ut+6]=K.x,tn.array[Ut+7]=K.y,Ut+=8}}else if(3===tn.size){var Sn;Sn="c"===tn.type?["r","g","b"]:["x","y","z"];if(void 0===tn.boundTo||"vertices"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)F=vn[pn[H]],V=tn.value[F.a],$=tn.value[F.b],J=tn.value[F.c],tn.array[Ut]=V[Sn[0]],tn.array[Ut+1]=V[Sn[1]],tn.array[Ut+2]=V[Sn[2]],tn.array[Ut+3]=$[Sn[0]],tn.array[Ut+4]=$[Sn[1]],tn.array[Ut+5]=$[Sn[2]],tn.array[Ut+6]=J[Sn[0]],tn.array[Ut+7]=J[Sn[1]],tn.array[Ut+8]=J[Sn[2]],Ut+=9;H=0;for(B=dn.length;H<B;H++)F=vn[dn[H]],V=tn.value[F.a],$=tn.value[F.b],J=tn.value[F.c],K=tn.value[F.d],tn.array[Ut]=V[Sn[0]],tn.array[Ut+1]=V[Sn[1]],tn.array[Ut+2]=V[Sn[2]],tn.array[Ut+3]=$[Sn[0]],tn.array[Ut+4]=$[Sn[1]],tn.array[Ut+5]=$[Sn[2]],tn.array[Ut+6]=J[Sn[0]],tn.array[Ut+7]=J[Sn[1]],tn.array[Ut+8]=J[Sn[2]],tn.array[Ut+9]=K[Sn[0]],tn.array[Ut+10]=K[Sn[1]],tn.array[Ut+11]=K[Sn[2]],Ut+=12}else if("faces"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)J=$=V=zt=tn.value[pn[H]],tn.array[Ut]=V[Sn[0]],tn.array[Ut+1]=V[Sn[1]],tn.array[Ut+2]=V[Sn[2]],tn.array[Ut+3]=$[Sn[0]],tn.array[Ut+4]=$[Sn[1]],tn.array[Ut+5]=$[Sn[2]],tn.array[Ut+6]=J[Sn[0]],tn.array[Ut+7]=J[Sn[1]],tn.array[Ut+8]=J[Sn[2]],Ut+=9;H=0;for(B=dn.length;H<B;H++)K=J=$=V=zt=tn.value[dn[H]],tn.array[Ut]=V[Sn[0]],tn.array[Ut+1]=V[Sn[1]],tn.array[Ut+2]=V[Sn[2]],tn.array[Ut+3]=$[Sn[0]],tn.array[Ut+4]=$[Sn[1]],tn.array[Ut+5]=$[Sn[2]],tn.array[Ut+6]=J[Sn[0]],tn.array[Ut+7]=J[Sn[1]],tn.array[Ut+8]=J[Sn[2]],tn.array[Ut+9]=K[Sn[0]],tn.array[Ut+10]=K[Sn[1]],tn.array[Ut+11]=K[Sn[2]],Ut+=12}else if("faceVertices"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)zt=tn.value[pn[H]],V=zt[0],$=zt[1],J=zt[2],tn.array[Ut]=V[Sn[0]],tn.array[Ut+1]=V[Sn[1]],tn.array[Ut+2]=V[Sn[2]],tn.array[Ut+3]=$[Sn[0]],tn.array[Ut+4]=$[Sn[1]],tn.array[Ut+5]=$[Sn[2]],tn.array[Ut+6]=J[Sn[0]],tn.array[Ut+7]=J[Sn[1]],tn.array[Ut+8]=J[Sn[2]],Ut+=9;H=0;for(B=dn.length;H<B;H++)zt=tn.value[dn[H]],V=zt[0],$=zt[1],J=zt[2],K=zt[3],tn.array[Ut]=V[Sn[0]],tn.array[Ut+1]=V[Sn[1]],tn.array[Ut+2]=V[Sn[2]],tn.array[Ut+3]=$[Sn[0]],tn.array[Ut+4]=$[Sn[1]],tn.array[Ut+5]=$[Sn[2]],tn.array[Ut+6]=J[Sn[0]],tn.array[Ut+7]=J[Sn[1]],tn.array[Ut+8]=J[Sn[2]],tn.array[Ut+9]=K[Sn[0]],tn.array[Ut+10]=K[Sn[1]],tn.array[Ut+11]=K[Sn[2]],Ut+=12}}else if(4===tn.size)if(void 0===tn.boundTo||"vertices"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)F=vn[pn[H]],V=tn.value[F.a],$=tn.value[F.b],J=tn.value[F.c],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=V.z,tn.array[Ut+3]=V.w,tn.array[Ut+4]=$.x,tn.array[Ut+5]=$.y,tn.array[Ut+6]=$.z,tn.array[Ut+7]=$.w,tn.array[Ut+8]=J.x,tn.array[Ut+9]=J.y,tn.array[Ut+10]=J.z,tn.array[Ut+11]=J.w,Ut+=12;H=0;for(B=dn.length;H<B;H++)F=vn[dn[H]],V=tn.value[F.a],$=tn.value[F.b],J=tn.value[F.c],K=tn.value[F.d],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=V.z,tn.array[Ut+3]=V.w,tn.array[Ut+4]=$.x,tn.array[Ut+5]=$.y,tn.array[Ut+6]=$.z,tn.array[Ut+7]=$.w,tn.array[Ut+8]=J.x,tn.array[Ut+9]=J.y,tn.array[Ut+10]=J.z,tn.array[Ut+11]=J.w,tn.array[Ut+12]=K.x,tn.array[Ut+13]=K.y,tn.array[Ut+14]=K.z,tn.array[Ut+15]=K.w,Ut+=16}else if("faces"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)J=$=V=zt=tn.value[pn[H]],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=V.z,tn.array[Ut+3]=V.w,tn.array[Ut+4]=$.x,tn.array[Ut+5]=$.y,tn.array[Ut+6]=$.z,tn.array[Ut+7]=$.w,tn.array[Ut+8]=J.x,tn.array[Ut+9]=J.y,tn.array[Ut+10]=J.z,tn.array[Ut+11]=J.w,Ut+=12;H=0;for(B=dn.length;H<B;H++)K=J=$=V=zt=tn.value[dn[H]],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=V.z,tn.array[Ut+3]=V.w,tn.array[Ut+4]=$.x,tn.array[Ut+5]=$.y,tn.array[Ut+6]=$.z,tn.array[Ut+7]=$.w,tn.array[Ut+8]=J.x,tn.array[Ut+9]=J.y,tn.array[Ut+10]=J.z,tn.array[Ut+11]=J.w,tn.array[Ut+12]=K.x,tn.array[Ut+13]=K.y,tn.array[Ut+14]=K.z,tn.array[Ut+15]=K.w,Ut+=16}else if("faceVertices"===tn.boundTo){H=0;for(B=pn.length;H<B;H++)zt=tn.value[pn[H]],V=zt[0],$=zt[1],J=zt[2],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=V.z,tn.array[Ut+3]=V.w,tn.array[Ut+4]=$.x,tn.array[Ut+5]=$.y,tn.array[Ut+6]=$.z,tn.array[Ut+7]=$.w,tn.array[Ut+8]=J.x,tn.array[Ut+9]=J.y,tn.array[Ut+10]=J.z,tn.array[Ut+11]=J.w,Ut+=12;H=0;for(B=dn.length;H<B;H++)zt=tn.value[dn[H]],V=zt[0],$=zt[1],J=zt[2],K=zt[3],tn.array[Ut]=V.x,tn.array[Ut+1]=V.y,tn.array[Ut+2]=V.z,tn.array[Ut+3]=V.w,tn.array[Ut+4]=$.x,tn.array[Ut+5]=$.y,tn.array[Ut+6]=$.z,tn.array[Ut+7]=$.w,tn.array[Ut+8]=J.x,tn.array[Ut+9]=J.y,tn.array[Ut+10]=J.z,tn.array[Ut+11]=J.w,tn.array[Ut+12]=K.x,tn.array[Ut+13]=K.y,tn.array[Ut+14]=K.z,tn.array[Ut+15]=K.w,Ut+=16}Nt.bindBuffer(Nt.ARRAY_BUFFER,tn.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,tn.array,L)}}A&&(delete C.__inittedArrays,delete C.__colorArray,delete C.__normalArray,delete C.__tangentArray,delete C.__uvArray,delete C.__uv2Array,delete C.__faceArray,delete C.__vertexArray,delete C.__lineArray,delete C.__skinIndexArray,delete C.__skinWeightArray)}}l.verticesNeedUpdate=!1,l.morphTargetsNeedUpdate=!1,l.elementsNeedUpdate=!1,l.uvsNeedUpdate=!1,l.normalsNeedUpdate=!1,l.colorsNeedUpdate=!1,l.tangentsNeedUpdate=!1,l.buffersNeedUpdate=!1,d.attributes&&y(d)}else if(f instanceof e.Ribbon){d=s(f,l),p=d.attributes&&g(d);if(l.verticesNeedUpdate||l.colorsNeedUpdate||l.normalsNeedUpdate||p){var xn=l,Tn=Nt.DYNAMIC_DRAW,Nn=void 0,Cn=void 0,kn=void 0,Ln=void 0,An=void 0,On=void 0,Mn=void 0,_n=void 0,Dn=void 0,Pn=void 0,Hn=void 0,Bn=void 0,jn=void 0,Fn=xn.vertices,In=xn.colors,qn=xn.normals,Rn=Fn.length,Un=In.length,zn=qn.length,Wn=xn.__vertexArray,Xn=xn.__colorArray,Vn=xn.__normalArray,$n=xn.colorsNeedUpdate,Jn=xn.normalsNeedUpdate,Kn=xn.__webglCustomAttributesList;if(xn.verticesNeedUpdate){for(Nn=0;Nn<Rn;Nn++)Ln=Fn[Nn],An=3*Nn,Wn[An]=Ln.x,Wn[An+1]=Ln.y,Wn[An+2]=Ln.z;Nt.bindBuffer(Nt.ARRAY_BUFFER,xn.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Wn,Tn)}if($n){for(Cn=0;Cn<Un;Cn++)On=In[Cn],An=3*Cn,Xn[An]=On.r,Xn[An+1]=On.g,Xn[An+2]=On.b;Nt.bindBuffer(Nt.ARRAY_BUFFER,xn.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Xn,Tn)}if(Jn){for(kn=0;kn<zn;kn++)Mn=qn[kn],An=3*kn,Vn[An]=Mn.x,Vn[An+1]=Mn.y,Vn[An+2]=Mn.z;Nt.bindBuffer(Nt.ARRAY_BUFFER,xn.__webglNormalBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Vn,Tn)}if(Kn){_n=0;for(Dn=Kn.length;_n<Dn;_n++)if(Bn=Kn[_n],Bn.needsUpdate&&(void 0===Bn.boundTo||"vertices"===Bn.boundTo)){An=0,Hn=Bn.value.length;if(1===Bn.size)for(Pn=0;Pn<Hn;Pn++)Bn.array[Pn]=Bn.value[Pn];else if(2===Bn.size)for(Pn=0;Pn<Hn;Pn++)jn=Bn.value[Pn],Bn.array[An]=jn.x,Bn.array[An+1]=jn.y,An+=2;else if(3===Bn.size)if("c"===Bn.type)for(Pn=0;Pn<Hn;Pn++)jn=Bn.value[Pn],Bn.array[An]=jn.r,Bn.array[An+1]=jn.g,Bn.array[An+2]=jn.b,An+=3;else for(Pn=0;Pn<Hn;Pn++)jn=Bn.value[Pn],Bn.array[An]=jn.x,Bn.array[An+1]=jn.y,Bn.array[An+2]=jn.z,An+=3;else if(4===Bn.size)for(Pn=0;Pn<Hn;Pn++)jn=Bn.value[Pn],Bn.array[An]=jn.x,Bn.array[An+1]=jn.y,Bn.array[An+2]=jn.z,Bn.array[An+3]=jn.w,An+=4;Nt.bindBuffer(Nt.ARRAY_BUFFER,Bn.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,Bn.array,Tn)}}}l.verticesNeedUpdate=!1,l.colorsNeedUpdate=!1,l.normalsNeedUpdate=!1,d.attributes&&y(d)}else if(f instanceof e.Line){d=s(f,l),p=d.attributes&&g(d);if(l.verticesNeedUpdate||l.colorsNeedUpdate||l.lineDistancesNeedUpdate||p){var Qn=l,Gn=Nt.DYNAMIC_DRAW,Yn=void 0,Zn=void 0,er=void 0,tr=void 0,nr=void 0,rr=void 0,ir=Qn.vertices,sr=Qn.colors,or=Qn.lineDistances,ur=ir.length,ar=sr.length,fr=or.length,lr=Qn.__vertexArray,cr=Qn.__colorArray,hr=Qn.__lineDistanceArray,pr=Qn.colorsNeedUpdate,dr=Qn.lineDistancesNeedUpdate,vr=Qn.__webglCustomAttributesList,mr=void 0,gr=void 0,yr=void 0,br=void 0,wr=void 0,Er=void 0;if(Qn.verticesNeedUpdate){for(Yn=0;Yn<ur;Yn++)tr=ir[Yn],nr=3*Yn,lr[nr]=tr.x,lr[nr+1]=tr.y,lr[nr+2]=tr.z;Nt.bindBuffer(Nt.ARRAY_BUFFER,Qn.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,lr,Gn)}if(pr){for(Zn=0;Zn<ar;Zn++)rr=sr[Zn],nr=3*Zn,cr[nr]=rr.r,cr[nr+1]=rr.g,cr[nr+2]=rr.b;Nt.bindBuffer(Nt.ARRAY_BUFFER,Qn.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,cr,Gn)}if(dr){for(er=0;er<fr;er++)hr[er]=or[er];Nt.bindBuffer(Nt.ARRAY_BUFFER,Qn.__webglLineDistanceBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,hr,Gn)}if(vr){mr=0;for(gr=vr.length;mr<gr;mr++)if(Er=vr[mr],Er.needsUpdate&&(void 0===Er.boundTo||"vertices"===Er.boundTo)){nr=0,br=Er.value.length;if(1===Er.size)for(yr=0;yr<br;yr++)Er.array[yr]=Er.value[yr];else if(2===Er.size)for(yr=0;yr<br;yr++)wr=Er.value[yr],Er.array[nr]=wr.x,Er.array[nr+1]=wr.y,nr+=2;else if(3===Er.size)if("c"===Er.type)for(yr=0;yr<br;yr++)wr=Er.value[yr],Er.array[nr]=wr.r,Er.array[nr+1]=wr.g,Er.array[nr+2]=wr.b,nr+=3;else for(yr=0;yr<br;yr++)wr=Er.value[yr],Er.array[nr]=wr.x,Er.array[nr+1]=wr.y,Er.array[nr+2]=wr.z,nr+=3;else if(4===Er.size)for(yr=0;yr<br;yr++)wr=Er.value[yr],Er.array[nr]=wr.x,Er.array[nr+1]=wr.y,Er.array[nr+2]=wr.z,Er.array[nr+3]=wr.w,nr+=4;Nt.bindBuffer(Nt.ARRAY_BUFFER,Er.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,Er.array,Gn)}}}l.verticesNeedUpdate=!1,l.colorsNeedUpdate=!1,l.lineDistancesNeedUpdate=!1,d.attributes&&y(d)}else if(f instanceof e.ParticleSystem){d=s(f,l),p=d.attributes&&g(d);if(l.verticesNeedUpdate||l.colorsNeedUpdate||f.sortParticles||p){var Sr=l,xr=Nt.DYNAMIC_DRAW,Tr=f,Nr=void 0,Cr=void 0,kr=void 0,Lr=void 0,Ar=void 0,Or=void 0,Mr=Sr.vertices,_r=Mr.length,Dr=Sr.colors,Pr=Dr.length,Hr=Sr.__vertexArray,Br=Sr.__colorArray,jr=Sr.__sortArray,Fr=Sr.verticesNeedUpdate,Ir=Sr.colorsNeedUpdate,qr=Sr.__webglCustomAttributesList,Rr=void 0,Ur=void 0,zr=void 0,Wr=void 0,Xr=void 0,Vr=void 0;if(Tr.sortParticles){wt.copy(bt),wt.multiply(Tr.matrixWorld);for(Nr=0;Nr<_r;Nr++)kr=Mr[Nr],Et.copy(kr),Et.applyProjection(wt),jr[Nr]=[Et.z,Nr];jr.sort(c);for(Nr=0;Nr<_r;Nr++)kr=Mr[jr[Nr][1]],Lr=3*Nr,Hr[Lr]=kr.x,Hr[Lr+1]=kr.y,Hr[Lr+2]=kr.z;for(Cr=0;Cr<Pr;Cr++)Lr=3*Cr,Or=Dr[jr[Cr][1]],Br[Lr]=Or.r,Br[Lr+1]=Or.g,Br[Lr+2]=Or.b;if(qr){Rr=0;for(Ur=qr.length;Rr<Ur;Rr++)if(Vr=qr[Rr],void 0===Vr.boundTo||"vertices"===Vr.boundTo)if(Lr=0,Wr=Vr.value.length,1===Vr.size)for(zr=0;zr<Wr;zr++)Ar=jr[zr][1],Vr.array[zr]=Vr.value[Ar];else if(2===Vr.size)for(zr=0;zr<Wr;zr++)Ar=jr[zr][1],Xr=Vr.value[Ar],Vr.array[Lr]=Xr.x,Vr.array[Lr+1]=Xr.y,Lr+=2;else if(3===Vr.size)if("c"===Vr.type)for(zr=0;zr<Wr;zr++)Ar=jr[zr][1],Xr=Vr.value[Ar],Vr.array[Lr]=Xr.r,Vr.array[Lr+1]=Xr.g,Vr.array[Lr+2]=Xr.b,Lr+=3;else for(zr=0;zr<Wr;zr++)Ar=jr[zr][1],Xr=Vr.value[Ar],Vr.array[Lr]=Xr.x,Vr.array[Lr+1]=Xr.y,Vr.array[Lr+2]=Xr.z,Lr+=3;else if(4===Vr.size)for(zr=0;zr<Wr;zr++)Ar=jr[zr][1],Xr=Vr.value[Ar],Vr.array[Lr]=Xr.x,Vr.array[Lr+1]=Xr.y,Vr.array[Lr+2]=Xr.z,Vr.array[Lr+3]=Xr.w,Lr+=4}}else{if(Fr)for(Nr=0;Nr<_r;Nr++)kr=Mr[Nr],Lr=3*Nr,Hr[Lr]=kr.x,Hr[Lr+1]=kr.y,Hr[Lr+2]=kr.z;if(Ir)for(Cr=0;Cr<Pr;Cr++)Or=Dr[Cr],Lr=3*Cr,Br[Lr]=Or.r,Br[Lr+1]=Or.g,Br[Lr+2]=Or.b;if(qr){Rr=0;for(Ur=qr.length;Rr<Ur;Rr++)if(Vr=qr[Rr],Vr.needsUpdate&&(void 0===Vr.boundTo||"vertices"===Vr.boundTo))if(Wr=Vr.value.length,Lr=0,1===Vr.size)for(zr=0;zr<Wr;zr++)Vr.array[zr]=Vr.value[zr];else if(2===Vr.size)for(zr=0;zr<Wr;zr++)Xr=Vr.value[zr],Vr.array[Lr]=Xr.x,Vr.array[Lr+1]=Xr.y,Lr+=2;else if(3===Vr.size)if("c"===Vr.type)for(zr=0;zr<Wr;zr++)Xr=Vr.value[zr],Vr.array[Lr]=Xr.r,Vr.array[Lr+1]=Xr.g,Vr.array[Lr+2]=Xr.b,Lr+=3;else for(zr=0;zr<Wr;zr++)Xr=Vr.value[zr],Vr.array[Lr]=Xr.x,Vr.array[Lr+1]=Xr.y,Vr.array[Lr+2]=Xr.z,Lr+=3;else if(4===Vr.size)for(zr=0;zr<Wr;zr++)Xr=Vr.value[zr],Vr.array[Lr]=Xr.x,Vr.array[Lr+1]=Xr.y,Vr.array[Lr+2]=Xr.z,Vr.array[Lr+3]=Xr.w,Lr+=4}}if(Fr||Tr.sortParticles)Nt.bindBuffer(Nt.ARRAY_BUFFER,Sr.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Hr,xr);if(Ir||Tr.sortParticles)Nt.bindBuffer(Nt.ARRAY_BUFFER,Sr.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Br,xr);if(qr){Rr=0;for(Ur=qr.length;Rr<Ur;Rr++)if(Vr=qr[Rr],Vr.needsUpdate||Tr.sortParticles)Nt.bindBuffer(Nt.ARRAY_BUFFER,Vr.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,Vr.array,xr)}}l.verticesNeedUpdate=!1,l.colorsNeedUpdate=!1,d.attributes&&y(d)}}},this.initMaterial=function(t,n,r,i){var s,o,u,a;t.addEventListener("dispose",Vt);var f,l,c,h,p;t instanceof e.MeshDepthMaterial?p="depth":t instanceof e.MeshNormalMaterial?p="normal":t instanceof e.MeshBasicMaterial?p="basic":t instanceof e.MeshLambertMaterial?p="lambert":t instanceof e.MeshPhongMaterial?p="phong":t instanceof e.LineBasicMaterial?p="basic":t instanceof e.LineDashedMaterial?p="dashed":t instanceof e.ParticleBasicMaterial&&(p="particle_basic");if(p){var d=e.ShaderLib[p];t.uniforms=e.UniformsUtils.clone(d.uniforms),t.vertexShader=d.vertexShader,t.fragmentShader=d.fragmentShader}var v,m,g;s=u=m=g=d=0;for(o=n.length;s<o;s++)v=n[s],v.onlyShadow||(v instanceof e.DirectionalLight&&u++,v instanceof e.PointLight&&m++,v instanceof e.SpotLight&&g++,v instanceof e.HemisphereLight&&d++);s=u,o=m,u=g,a=d,d=v=0;for(g=n.length;d<g;d++)m=n[d],m.castShadow&&(m instanceof e.SpotLight&&v++,m instanceof e.DirectionalLight&&!m.shadowCascade&&v++);h=v,Bt&&i&&i.useVertexTexture?c=1024:(n=Nt.getParameter(Nt.MAX_VERTEX_UNIFORM_VECTORS),n=Math.floor((n-20)/4),void 0!==i&&i instanceof e.SkinnedMesh&&(n=Math.min(i.bones.length,n),n<i.bones.length&&console.warn("WebGLRenderer: too many bones - "+i.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")),c=n);e:{g=t.fragmentShader,m=t.vertexShader,d=t.uniforms,n=t.attributes,v=t.defines;var r={map:!!t.map,envMap:!!t.envMap,lightMap:!!t.lightMap,bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,specularMap:!!t.specularMap,vertexColors:t.vertexColors,fog:r,useFog:t.fog,fogExp:r instanceof e.FogExp2,sizeAttenuation:t.sizeAttenuation,skinning:t.skinning,maxBones:c,useVertexTexture:Bt&&i&&i.useVertexTexture,boneTextureWidth:i&&i.boneTextureWidth,boneTextureHeight:i&&i.boneTextureHeight,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s,maxPointLights:o,maxSpotLights:u,maxHemiLights:a,maxShadows:h,shadowMapEnabled:this.shadowMapEnabled&&i.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:t.alphaTest,metal:t.metal,perPixel:t.perPixel,wrapAround:t.wrapAround,doubleSided:t.side===e.DoubleSide,flipSided:t.side===e.BackSide},y,b,w,i=[];p?i.push(p):(i.push(g),i.push(m));for(b in v)i.push(b),i.push(v[b]);for(y in r)i.push(y),i.push(r[y]);p=i.join(),y=0;for(b=W.length;y<b;y++)if(i=W[y],i.code===p){i.usedTimes++,l=i.program;break e}y="SHADOWMAP_TYPE_BASIC",r.shadowMapType===e.PCFShadowMap?y="SHADOWMAP_TYPE_PCF":r.shadowMapType===e.PCFSoftShadowMap&&(y="SHADOWMAP_TYPE_PCF_SOFT"),b=[];for(w in v)i=v[w],!1!==i&&(i="#define "+w+" "+i,b.push(i));i=b.join("\n"),w=Nt.createProgram(),b=["precision "+H+" float;",i,Ht?"#define VERTEX_TEXTURES":"",z.gammaInput?"#define GAMMA_INPUT":"",z.gammaOutput?"#define GAMMA_OUTPUT":"",z.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.vertexColors?"#define USE_COLOR":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.boneTextureWidth?"#define N_BONE_PIXEL_X "+r.boneTextureWidth.toFixed(1):"",r.boneTextureHeight?"#define N_BONE_PIXEL_Y "+r.boneTextureHeight.toFixed(1):"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals?"#define USE_MORPHNORMALS":"",r.perPixel?"#define PHONG_PER_PIXEL":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+y:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),y=["precision "+H+" float;",r.bumpMap||r.normalMap?"#extension GL_OES_standard_derivatives : enable":"",i,"#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"",z.gammaInput?"#define GAMMA_INPUT":"",z.gammaOutput?"#define GAMMA_OUTPUT":"",z.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.vertexColors?"#define USE_COLOR":"",r.metal?"#define METAL":"",r.perPixel?"#define PHONG_PER_PIXEL":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+y:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),b=A("vertex",b+m),y=A("fragment",y+g),Nt.attachShader(w,b),Nt.attachShader(w,y),Nt.linkProgram(w),Nt.getProgramParameter(w,Nt.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+Nt.getProgramParameter(w,Nt.VALIDATE_STATUS)+", gl error ["+Nt.getError()+"]"),Nt.deleteShader(y),Nt.deleteShader(b),w.uniforms={},w.attributes={};var E;y="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),r.useVertexTexture?y.push("boneTexture"):y.push("boneGlobalMatrices");for(E in d)y.push(E);E=y,y=0;for(b=E.length;y<b;y++)d=E[y],w.uniforms[d]=Nt.getUniformLocation(w,d);y="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(E=0;E<r.maxMorphTargets;E++)y.push("morphTarget"+E);for(E=0;E<r.maxMorphNormals;E++)y.push("morphNormal"+E);for(l in n)y.push(l);l=y,E=0;for(n=l.length;E<n;E++)y=l[E],w.attributes[y]=Nt.getAttribLocation(w,y);w.id=X++,W.push({program:w,code:p,usedTimes:1}),z.info.memory.programs=W.length,l=w}t.program=l,E=t.program.attributes;if(t.morphTargets){t.numSupportedMorphTargets=0,n="morphTarget";for(l=0;l<this.maxMorphTargets;l++)w=n+l,0<=E[w]&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0,n="morphNormal";for(l=0;l<this.maxMorphNormals;l++)w=n+l,0<=E[w]&&t.numSupportedMorphNormals++}t.uniformsList=[];for(f in t.uniforms)t.uniformsList.push([t.uniforms[f],f])},this.setFaceCulling=function(t,n){t===e.CullFaceNone?Nt.disable(Nt.CULL_FACE):(n===e.FrontFaceDirectionCW?Nt.frontFace(Nt.CW):Nt.frontFace(Nt.CCW),t===e.CullFaceBack?Nt.cullFace(Nt.BACK):t===e.CullFaceFront?Nt.cullFace(Nt.FRONT):Nt.cullFace(Nt.FRONT_AND_BACK),Nt.enable(Nt.CULL_FACE))},this.setMaterialFaces=function(t){var n=t.side===e.DoubleSide,t=t.side===e.BackSide;Z!==n&&(n?Nt.disable(Nt.CULL_FACE):Nt.enable(Nt.CULL_FACE),Z=n),et!==t&&(t?Nt.frontFace(Nt.CW):Nt.frontFace(Nt.CCW),et=t)},this.setDepthTest=function(e){st!==e&&(e?Nt.enable(Nt.DEPTH_TEST):Nt.disable(Nt.DEPTH_TEST),st=e)},this.setDepthWrite=function(e){ot!==e&&(Nt.depthMask(e),ot=e)},this.setBlending=function(t,n,r,i){t!==tt&&(t===e.NoBlending?Nt.disable(Nt.BLEND):t===e.AdditiveBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.SRC_ALPHA,Nt.ONE)):t===e.SubtractiveBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.ZERO,Nt.ONE_MINUS_SRC_COLOR)):t===e.MultiplyBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.ZERO,Nt.SRC_COLOR)):t===e.CustomBlending?Nt.enable(Nt.BLEND):(Nt.enable(Nt.BLEND),Nt.blendEquationSeparate(Nt.FUNC_ADD,Nt.FUNC_ADD),Nt.blendFuncSeparate(Nt.SRC_ALPHA,Nt.ONE_MINUS_SRC_ALPHA,Nt.ONE,Nt.ONE_MINUS_SRC_ALPHA)),tt=t);if(t===e.CustomBlending){if(n!==nt&&(Nt.blendEquation(D(n)),nt=n),r!==rt||i!==it)Nt.blendFunc(D(r),D(i)),rt=r,it=i}else it=rt=nt=null},this.setTexture=function(t,n){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",Wt),t.__webglTexture=Nt.createTexture(),z.info.memory.textures++),Nt.activeTexture(Nt.TEXTURE0+n),Nt.bindTexture(Nt.TEXTURE_2D,t.__webglTexture),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,t.flipY),Nt.pixelStorei(Nt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Nt.pixelStorei(Nt.UNPACK_ALIGNMENT,t.unpackAlignment);var r=t.image,i=0===(r.width&r.width-1)&&0===(r.height&r.height-1),s=D(t.format),o=D(t.type);O(Nt.TEXTURE_2D,t,i);var u=t.mipmaps;if(t instanceof e.DataTexture)if(0<u.length&&i){for(var a=0,f=u.length;a<f;a++)r=u[a],Nt.texImage2D(Nt.TEXTURE_2D,a,s,r.width,r.height,0,s,o,r.data);t.generateMipmaps=!1}else Nt.texImage2D(Nt.TEXTURE_2D,0,s,r.width,r.height,0,s,o,r.data);else if(t instanceof e.CompressedTexture){a=0;for(f=u.length;a<f;a++)r=u[a],Nt.compressedTexImage2D(Nt.TEXTURE_2D,a,s,r.width,r.height,0,r.data)}else if(0<u.length&&i){a=0;for(f=u.length;a<f;a++)r=u[a],Nt.texImage2D(Nt.TEXTURE_2D,a,s,s,o,r);t.generateMipmaps=!1}else Nt.texImage2D(Nt.TEXTURE_2D,0,s,s,o,t.image);t.generateMipmaps&&i&&Nt.generateMipmap(Nt.TEXTURE_2D),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else Nt.activeTexture(Nt.TEXTURE0+n),Nt.bindTexture(Nt.TEXTURE_2D,t.__webglTexture)},this.setRenderTarget=function(t){var n=t instanceof e.WebGLRenderTargetCube;if(t&&!t.__webglFramebuffer){void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.addEventListener("dispose",Xt),t.__webglTexture=Nt.createTexture(),z.info.memory.textures++;var r=0===(t.width&t.width-1)&&0===(t.height&t.height-1),i=D(t.format),s=D(t.type);if(n){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,t.__webglTexture),O(Nt.TEXTURE_CUBE_MAP,t,r);for(var o=0;6>o;o++){t.__webglFramebuffer[o]=Nt.createFramebuffer(),t.__webglRenderbuffer[o]=Nt.createRenderbuffer(),Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i,t.width,t.height,0,i,s,null);var u=t,a=Nt.TEXTURE_CUBE_MAP_POSITIVE_X+o;Nt.bindFramebuffer(Nt.FRAMEBUFFER,t.__webglFramebuffer[o]),Nt.framebufferTexture2D(Nt.FRAMEBUFFER,Nt.COLOR_ATTACHMENT0,a,u.__webglTexture,0),M(t.__webglRenderbuffer[o],t)}r&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=Nt.createFramebuffer(),t.__webglRenderbuffer=t.shareDepthFrom?t.shareDepthFrom.__webglRenderbuffer:Nt.createRenderbuffer(),Nt.bindTexture(Nt.TEXTURE_2D,t.__webglTexture),O(Nt.TEXTURE_2D,t,r),Nt.texImage2D(Nt.TEXTURE_2D,0,i,t.width,t.height,0,i,s,null),i=Nt.TEXTURE_2D,Nt.bindFramebuffer(Nt.FRAMEBUFFER,t.__webglFramebuffer),Nt.framebufferTexture2D(Nt.FRAMEBUFFER,Nt.COLOR_ATTACHMENT0,i,t.__webglTexture,0),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_ATTACHMENT,Nt.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_STENCIL_ATTACHMENT,Nt.RENDERBUFFER,t.__webglRenderbuffer):M(t.__webglRenderbuffer,t),r&&Nt.generateMipmap(Nt.TEXTURE_2D);n?Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,null):Nt.bindTexture(Nt.TEXTURE_2D,null),Nt.bindRenderbuffer(Nt.RENDERBUFFER,null),Nt.bindFramebuffer(Nt.FRAMEBUFFER,null)}t?(n=n?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,r=t.width,t=t.height,s=i=0):(n=null,r=pt,t=dt,i=ct,s=ht),n!==$&&(Nt.bindFramebuffer(Nt.FRAMEBUFFER,n),Nt.viewport(i,s,r,t),$=n),vt=r,mt=t},this.shadowMapPlugin=new e.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new e.SpritePlugin),this.addPostPlugin(new e.LensFlarePlugin)},e.WebGLRenderTarget=function(t,n,r){this.width=t,this.height=n,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:e.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:e.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:e.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.format=void 0!==r.format?r.format:e.RGBAFormat,this.type=void 0!==r.type?r.type:e.UnsignedByteType,this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},e.WebGLRenderTarget.prototype={constructor:e.WebGLRenderTarget,addEventListener:e.EventDispatcher.prototype.addEventListener,hasEventListener:e.EventDispatcher.prototype.hasEventListener,removeEventListener:e.EventDispatcher.prototype.removeEventListener,dispatchEvent:e.EventDispatcher.prototype.dispatchEvent,clone:function(){var t=new e.WebGLRenderTarget(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.WebGLRenderTargetCube=function(t,n,r){e.WebGLRenderTarget.call(this,t,n,r),this.activeCubeFace=0},e.WebGLRenderTargetCube.prototype=Object.create(e.WebGLRenderTarget.prototype),e.RenderableVertex=function(){this.positionWorld=new e.Vector3,this.positionScreen=new e.Vector4,this.visible=!0},e.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},e.RenderableFace3=function(){this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.v3=new e.RenderableVertex,this.centroidModel=new e.Vector3,this.normalModel=new e.Vector3,this.normalModelView=new e.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new e.Vector3,new e.Vector3,new e.Vector3],this.vertexNormalsModelView=[new e.Vector3,new e.Vector3,new e.Vector3],this.material=this.color=null,this.uvs=[[]],this.z=null},e.RenderableFace4=function(){this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.v3=new e.RenderableVertex,this.v4=new e.RenderableVertex,this.centroidModel=new e.Vector3,this.normalModel=new e.Vector3,this.normalModelView=new e.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3],this.vertexNormalsModelView=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3],this.material=this.color=null,this.uvs=[[]],this.z=null},e.RenderableObject=function(){this.z=this.object=null},e.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=this.object=null,this.scale=new e.Vector2,this.material=null},e.RenderableLine=function(){this.z=null,this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.vertexColors=[new e.Color,new e.Color],this.material=null},e.GeometryUtils={merge:function(t,n,r){var i,s,o=t.vertices.length,u=n instanceof e.Mesh?n.geometry:n,a=t.vertices,f=u.vertices,l=t.faces,c=u.faces,t=t.faceVertexUvs[0],u=u.faceVertexUvs[0];void 0===r&&(r=0),n instanceof e.Mesh&&(n.matrixAutoUpdate&&n.updateMatrix(),i=n.matrix,s=(new e.Matrix3).getNormalMatrix(i));for(var n=0,h=f.length;n<h;n++){var p=f[n].clone();i&&p.applyMatrix4(i),a.push(p)}n=0;for(h=c.length;n<h;n++){var p=c[n],d,v,m=p.vertexNormals,g=p.vertexColors;p instanceof e.Face3?d=new e.Face3(p.a+o,p.b+o,p.c+o):p instanceof e.Face4&&(d=new e.Face4(p.a+o,p.b+o,p.c+o,p.d+o)),d.normal.copy(p.normal),s&&d.normal.applyMatrix3(s).normalize(),a=0;for(f=m.length;a<f;a++)v=m[a].clone(),s&&v.applyMatrix3(s).normalize(),d.vertexNormals.push(v);d.color.copy(p.color),a=0;for(f=g.length;a<f;a++)v=g[a],d.vertexColors.push(v.clone());d.materialIndex=p.materialIndex+r,d.centroid.copy(p.centroid),i&&d.centroid.applyMatrix4(i),l.push(d)}n=0;for(h=u.length;n<h;n++){r=u[n],i=[],a=0;for(f=r.length;a<f;a++)i.push(new e.Vector2(r[a].x,r[a].y));t.push(i)}},removeMaterials:function(e,t){for(var n={},r=0,i=t.length;r<i;r++)n[t[r]]=!0;for(var s,o=[],r=0,i=e.faces.length;r<i;r++)s=e.faces[r],s.materialIndex in n||o.push(s);e.faces=o},randomPointInTriangle:function(t,n,r){var i,s,o,u=new e.Vector3,a=e.GeometryUtils.__v1;return i=e.GeometryUtils.random(),s=e.GeometryUtils.random(),1<i+s&&(i=1-i,s=1-s),o=1-i-s,u.copy(t),u.multiplyScalar(i),a.copy(n),a.multiplyScalar(s),u.add(a),a.copy(r),a.multiplyScalar(o),u.add(a),u},randomPointInFace:function(t,n,r){var i,s,o;if(t instanceof e.Face3)return i=n.vertices[t.a],s=n.vertices[t.b],o=n.vertices[t.c],e.GeometryUtils.randomPointInTriangle(i,s,o);if(t instanceof e.Face4){i=n.vertices[t.a],s=n.vertices[t.b],o=n.vertices[t.c];var n=n.vertices[t.d],u;return r?t._area1&&t._area2?(r=t._area1,u=t._area2):(r=e.GeometryUtils.triangleArea(i,s,n),u=e.GeometryUtils.triangleArea(s,o,n),t._area1=r,t._area2=u):(r=e.GeometryUtils.triangleArea(i,s,n),u=e.GeometryUtils.triangleArea(s,o,n)),e.GeometryUtils.random()*(r+u)<r?e.GeometryUtils.randomPointInTriangle(i,s,n):e.GeometryUtils.randomPointInTriangle(s,o,n)}},randomPointsInGeometry:function(t,n){function r(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);return l[i]>e?t(n,i-1):l[i]<e?t(i+1,r):i}return t(0,l.length-1)}var i,s,o=t.faces,u=t.vertices,a=o.length,f=0,l=[],c,h,p,d;for(s=0;s<a;s++)i=o[s],i instanceof e.Face3?(c=u[i.a],h=u[i.b],p=u[i.c],i._area=e.GeometryUtils.triangleArea(c,h,p)):i instanceof e.Face4&&(c=u[i.a],h=u[i.b],p=u[i.c],d=u[i.d],i._area1=e.GeometryUtils.triangleArea(c,h,d),i._area2=e.GeometryUtils.triangleArea(h,p,d),i._area=i._area1+i._area2),f+=i._area,l[s]=f;i=[];for(s=0;s<n;s++)u=e.GeometryUtils.random()*f,u=r(u),i[s]=e.GeometryUtils.randomPointInFace(o[u],t,!0);return i},triangleArea:function(t,n,r){var i=e.GeometryUtils.__v1,s=e.GeometryUtils.__v2;return i.subVectors(n,t),s.subVectors(r,t),i.cross(s),.5*i.length()},center:function(t){t.computeBoundingBox();var n=t.boundingBox,r=new e.Vector3;return r.addVectors(n.min,n.max),r.multiplyScalar(-0.5),t.applyMatrix((new e.Matrix4).makeTranslation(r.x,r.y,r.z)),t.computeBoundingBox(),r},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,n=e.length;t<n;t++)for(var r=e[t],i=0,s=r.length;i<s;i++)1!==r[i].x&&(r[i].x-=Math.floor(r[i].x)),1!==r[i].y&&(r[i].y-=Math.floor(r[i].y))},triangulateQuads:function(t){var n,r,i,s,o=[],u=[],a=[];n=0;for(r=t.faceUvs.length;n<r;n++)u[n]=[];n=0;for(r=t.faceVertexUvs.length;n<r;n++)a[n]=[];n=0;for(r=t.faces.length;n<r;n++)if(i=t.faces[n],i instanceof e.Face4){s=i.a;var f=i.b,l=i.c,c=i.d,h=new e.Face3,p=new e.Face3;h.color.copy(i.color),p.color.copy(i.color),h.materialIndex=i.materialIndex,p.materialIndex=i.materialIndex,h.a=s,h.b=f,h.c=c,p.a=f,p.b=l,p.c=c,4===i.vertexColors.length&&(h.vertexColors[0]=i.vertexColors[0].clone(),h.vertexColors[1]=i.vertexColors[1].clone(),h.vertexColors[2]=i.vertexColors[3].clone(),p.vertexColors[0]=i.vertexColors[1].clone(),p.vertexColors[1]=i.vertexColors[2].clone(),p.vertexColors[2]=i.vertexColors[3].clone()),o.push(h,p),i=0;for(s=t.faceVertexUvs.length;i<s;i++)t.faceVertexUvs[i].length&&(h=t.faceVertexUvs[i][n],f=h[1],l=h[2],c=h[3],h=[h[0].clone(),f.clone(),c.clone()],f=[f.clone(),l.clone(),c.clone()],a[i].push(h,f));i=0;for(s=t.faceUvs.length;i<s;i++)t.faceUvs[i].length&&(f=t.faceUvs[i][n],u[i].push(f,f))}else{o.push(i),i=0;for(s=t.faceUvs.length;i<s;i++)u[i].push(t.faceUvs[i][n]);i=0;for(s=t.faceVertexUvs.length;i<s;i++)a[i].push(t.faceVertexUvs[i][n])}t.faces=o,t.faceUvs=u,t.faceVertexUvs=a,t.computeCentroids(),t.computeFaceNormals(),t.computeVertexNormals(),t.hasTangents&&t.computeTangents()},setMaterialIndex:function(e,t,n,r){e=e.faces,r=r||e.length-1;for(n=n||0;n<=r;n++)e[n].materialIndex=t}},e.GeometryUtils.random=e.Math.random16,e.GeometryUtils.__v1=new e.Vector3,e.GeometryUtils.__v2=new e.Vector3,e.ImageUtils={crossOrigin:"anonymous",loadTexture:function(t,n,r,i){var s=new Image,o=new e.Texture(s,n),n=new e.ImageLoader;return n.addEventListener("load",function(e){o.image=e.content,o.needsUpdate=!0,r&&r(o)}),n.addEventListener("error",function(e){i&&i(e.message)}),n.crossOrigin=this.crossOrigin,n.load(t,s),o.sourceFile=t,o},loadCompressedTexture:function(t,n,r,i){var s=new e.CompressedTexture;s.mapping=n;var o=new XMLHttpRequest;return o.onload=function(){var t=e.ImageUtils.parseDDS(o.response,!0);s.format=t.format,s.mipmaps=t.mipmaps,s.image.width=t.width,s.image.height=t.height,s.generateMipmaps=!1,s.needsUpdate=!0,r&&r(s)},o.onerror=i,o.open("GET",t,!0),o.responseType="arraybuffer",o.send(null),s},loadTextureCube:function(t,n,r,i){var s=[];s.loadCount=0;var o=new e.Texture;o.image=s,void 0!==n&&(o.mapping=n),o.flipY=!1;for(var n=0,u=t.length;n<u;++n){var a=new Image;s[n]=a,a.onload=function(){s.loadCount+=1,6===s.loadCount&&(o.needsUpdate=!0,r&&r(o))},a.onerror=i,a.crossOrigin=this.crossOrigin,a.src=t[n]}return o},loadCompressedTextureCube:function(t,n,r,i){var s=[];s.loadCount=0;var o=new e.CompressedTexture;o.image=s,void 0!==n&&(o.mapping=n),o.flipY=!1,o.generateMipmaps=!1,n=function(t,n){return function(){var i=e.ImageUtils.parseDDS(t.response,!0);n.format=i.format,n.mipmaps=i.mipmaps,n.width=i.width,n.height=i.height,s.loadCount+=1,6===s.loadCount&&(o.format=i.format,o.needsUpdate=!0,r&&r(o))}};if(t instanceof Array)for(var u=0,a=t.length;u<a;++u){var f={};s[u]=f;var l=new XMLHttpRequest;l.onload=n(l,f),l.onerror=i,f=t[u],l.open("GET",f,!0),l.responseType="arraybuffer",l.send(null)}else l=new XMLHttpRequest,l.onload=function(){var t=e.ImageUtils.parseDDS(l.response,!0);if(t.isCubemap){for(var n=t.mipmaps.length/t.mipmapCount,i=0;i<n;i++){s[i]={mipmaps:[]};for(var u=0;u<t.mipmapCount;u++)s[i].mipmaps.push(t.mipmaps[i*t.mipmapCount+u]),s[i].format=t.format,s[i].width=t.width,s[i].height=t.height}o.format=t.format,o.needsUpdate=!0,r&&r(o)}},l.onerror=i,l.open("GET",t,!0),l.responseType="arraybuffer",l.send(null);return o},parseDDS:function(t,n){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},s=r("DXT1"),o=r("DXT3"),u=r("DXT5"),a=new Int32Array(t,0,31);if(542327876!==a[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),i;if(!a[20]&4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),i;var f=a[21];switch(f){case s:s=8,i.format=e.RGB_S3TC_DXT1_Format;break;case o:s=16,i.format=e.RGBA_S3TC_DXT3_Format;break;case u:s=16,i.format=e.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(f&255,f>>8&255,f>>16&255,f>>24&255)),i}i.mipmapCount=1,a[2]&131072&&!1!==n&&(i.mipmapCount=Math.max(1,a[7])),i.isCubemap=a[28]&512?!0:!1,i.width=a[4],i.height=a[3];for(var a=a[1]+4,o=i.width,u=i.height,f=i.isCubemap?6:1,l=0;l<f;l++){for(var c=0;c<i.mipmapCount;c++){var h=Math.max(4,o)/4*Math.max(4,u)/4*s,p={data:new Uint8Array(t,a,h),width:o,height:u};i.mipmaps.push(p),a+=h,o=Math.max(.5*o,1),u=Math.max(.5*u,1)}o=i.width,u=i.height}return i},getNormalMap:function(e,t){var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=t|1,r=e.width,i=e.height,s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");o.drawImage(e,0,0);for(var u=o.getImageData(0,0,r,i).data,a=o.createImageData(r,i),f=a.data,l=0;l<r;l++)for(var c=0;c<i;c++){var h=0>c-1?0:c-1,p=c+1>i-1?i-1:c+1,d=0>l-1?0:l-1,v=l+1>r-1?r-1:l+1,m=[],g=[0,0,u[4*(c*r+l)]/255*t];m.push([-1,0,u[4*(c*r+d)]/255*t]),m.push([-1,-1,u[4*(h*r+d)]/255*t]),m.push([0,-1,u[4*(h*r+l)]/255*t]),m.push([1,-1,u[4*(h*r+v)]/255*t]),m.push([1,0,u[4*(c*r+v)]/255*t]),m.push([1,1,u[4*(p*r+v)]/255*t]),m.push([0,1,u[4*(p*r+l)]/255*t]),m.push([-1,1,u[4*(p*r+d)]/255*t]),h=[],d=m.length;for(p=0;p<d;p++){var v=m[p],y=m[(p+1)%d],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]];h.push(n([v[1]*y[2]-v[2]*y[1],v[2]*y[0]-v[0]*y[2],v[0]*y[1]-v[1]*y[0]]))}m=[0,0,0];for(p=0;p<h.length;p++)m[0]+=h[p][0],m[1]+=h[p][1],m[2]+=h[p][2];m[0]/=h.length,m[1]/=h.length,m[2]/=h.length,g=4*(c*r+l),f[g]=255*((m[0]+1)/2)|0,f[g+1]=255*((m[1]+1)/2)|0,f[g+2]=255*m[2]|0,f[g+3]=255}return o.putImageData(a,0,0),s},generateDataTexture:function(t,n,r){for(var i=t*n,s=new Uint8Array(3*i),o=Math.floor(255*r.r),u=Math.floor(255*r.g),r=Math.floor(255*r.b),a=0;a<i;a++)s[3*a]=o,s[3*a+1]=u,s[3*a+2]=r;return t=new e.DataTexture(s,t,n,e.RGBFormat),t.needsUpdate=!0,t}},e.SceneUtils={createMultiMaterialObject:function(t,n){for(var r=new e.Object3D,i=0,s=n.length;i<s;i++)r.add(new e.Mesh(t,n[i]));return r},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(t,n,r){var i=new e.Matrix4;i.getInverse(r.matrixWorld),t.applyMatrix(i),n.remove(t),r.add(t)}},e.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(t){for(var n=this.getFace(),r=this.size/n.resolution,i=0,s=String(t).split(""),o=s.length,u=[],t=0;t<o;t++){var a=new e.Path,a=this.extractGlyphPoints(s[t],n,r,i,a),i=i+a.offset;u.push(a.path)}return{paths:u,offset:i/2}},extractGlyphPoints:function(t,n,r,i,s){var o=[],u,a,f,l,c,h,p,d,v,m,g,y=n.glyphs[t]||n.glyphs["?"];if(y){if(y.o){n=y._cachedOutline||(y._cachedOutline=y.o.split(" ")),l=n.length;for(t=0;t<l;)switch(f=n[t++],f){case"m":f=n[t++]*r+i,c=n[t++]*r,s.moveTo(f,c);break;case"l":f=n[t++]*r+i,c=n[t++]*r,s.lineTo(f,c);break;case"q":f=n[t++]*r+i,c=n[t++]*r,d=n[t++]*r+i,v=n[t++]*r,s.quadraticCurveTo(d,v,f,c);if(u=o[o.length-1]){h=u.x,p=u.y,u=1;for(a=this.divisions;u<=a;u++){var b=u/a;e.Shape.Utils.b2(b,h,d,f),e.Shape.Utils.b2(b,p,v,c)}}break;case"b":if(f=n[t++]*r+i,c=n[t++]*r,d=n[t++]*r+i,v=n[t++]*-r,m=n[t++]*r+i,g=n[t++]*-r,s.bezierCurveTo(f,c,d,v,m,g),u=o[o.length-1]){h=u.x,p=u.y,u=1;for(a=this.divisions;u<=a;u++)b=u/a,e.Shape.Utils.b3(b,h,d,m,f),e.Shape.Utils.b3(b,p,v,g,c)}}}return{offset:y.ha*r,path:s}}}},e.FontUtils.generateShapes=function(t,n){var n=n||{},r=void 0!==n.curveSegments?n.curveSegments:4,i=void 0!==n.font?n.font:"helvetiker",s=void 0!==n.weight?n.weight:"normal",o=void 0!==n.style?n.style:"normal";e.FontUtils.size=void 0!==n.size?n.size:100,e.FontUtils.divisions=r,e.FontUtils.face=i,e.FontUtils.weight=s,e.FontUtils.style=o,r=e.FontUtils.drawText(t).paths,i=[],s=0;for(o=r.length;s<o;s++)Array.prototype.push.apply(i,r[s].toShapes());return i},function(e){var t=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n};return e.Triangulate=function(e,n){var r=e.length;if(3>r)return null;var i=[],s=[],o=[],u,a,f;if(0<t(e))for(a=0;a<r;a++)s[a]=a;else for(a=0;a<r;a++)s[a]=r-1-a;var l=2*r;for(a=r-1;2<r;){if(0>=l--){console.log("Warning, unable to triangulate polygon!");break}u=a,r<=u&&(u=0),a=u+1,r<=a&&(a=0),f=a+1,r<=f&&(f=0);var c;e:{var h=c=void 0,p=void 0,d=void 0,v=void 0,m=void 0,g=void 0,y=void 0,w=void 0,h=e[s[u]].x,p=e[s[u]].y,d=e[s[a]].x,v=e[s[a]].y,m=e[s[f]].x,g=e[s[f]].y;if(1e-10>(d-h)*(g-p)-(v-p)*(m-h))c=!1;else{var E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C=void 0,k=void 0,L=void 0,A=void 0,O=void 0,A=L=k=w=y=void 0,E=m-d,S=g-v,x=h-m,T=p-g,N=d-h,C=v-p;for(c=0;c<r;c++)if(c!==u&&c!==a&&c!==f)if(y=e[s[c]].x,w=e[s[c]].y,k=y-h,L=w-p,A=y-d,O=w-v,y-=m,w-=g,A=E*O-S*A,k=N*L-C*k,L=x*w-T*y,0<=A&&0<=L&&0<=k){c=!1;break e}c=!0}}if(c){i.push([e[s[u]],e[s[a]],e[s[f]]]),o.push([s[u],s[a],s[f]]),u=a;for(f=a+1;f<r;u++,f++)s[u]=s[f];r--,l=2*r}}return n?o:i},e.Triangulate.area=t,e}(e.FontUtils),self._typeface_js={faces:e.FontUtils.faces,loadFace:e.FontUtils.loadFace},e.typeface_js=self._typeface_js,e.Curve=function(){},e.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},e.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},e.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},e.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},e.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},e.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t},e.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},e.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;s=t?t:e*n[i-1];for(var o=0,u=i-1,a;o<=u;)if(r=Math.floor(o+(u-o)/2),a=n[r]-s,0>a)o=r+1;else{if(!(0<a)){u=r;break}u=r-1}return r=u,n[r]==s?r/(i-1):(o=n[r],n=(r+(s-o)/(n[r+1]-o))/(i-1))},e.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return 0>t&&(t=0),1<e&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},e.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},e.LineCurve=function(e,t){this.v1=e,this.v2=t},e.LineCurve.prototype=Object.create(e.Curve.prototype),e.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},e.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},e.LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},e.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},e.QuadraticBezierCurve.prototype=Object.create(e.Curve.prototype),e.QuadraticBezierCurve.prototype.getPoint=function(t){var n;return n=e.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),t=e.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),new e.Vector2(n,t)},e.QuadraticBezierCurve.prototype.getTangent=function(t){var n;return n=e.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x),t=e.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y),n=new e.Vector2(n,t),n.normalize(),n},e.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},e.CubicBezierCurve.prototype=Object.create(e.Curve.prototype),e.CubicBezierCurve.prototype.getPoint=function(t){var n;return n=e.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=e.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new e.Vector2(n,t)},e.CubicBezierCurve.prototype.getTangent=function(t){var n;return n=e.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=e.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),n=new e.Vector2(n,t),n.normalize(),n},e.SplineCurve=function(e){this.points=void 0==e?[]:e},e.SplineCurve.prototype=Object.create(e.Curve.prototype),e.SplineCurve.prototype.getPoint=function(t){var n=new e.Vector2,r=[],i=this.points,s;return s=(i.length-1)*t,t=Math.floor(s),s-=t,r[0]=0==t?t:t-1,r[1]=t,r[2]=t>i.length-2?i.length-1:t+1,r[3]=t>i.length-3?i.length-1:t+2,n.x=e.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,s),n.y=e.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,s),n},e.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o},e.EllipseCurve.prototype=Object.create(e.Curve.prototype),e.EllipseCurve.prototype.getPoint=function(t){var n=this.aEndAngle-this.aStartAngle;return this.aClockwise||(t=1-t),n=this.aStartAngle+t*n,t=this.aX+this.xRadius*Math.cos(n),n=this.aY+this.yRadius*Math.sin(n),new e.Vector2(t,n)},e.ArcCurve=function(t,n,r,i,s,o){e.EllipseCurve.call(this,t,n,r,r,i,s,o)},e.ArcCurve.prototype=Object.create(e.EllipseCurve.prototype),e.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){var e=.5*(n-e),r=.5*(r-t),s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}},e.Curve.create=function(t,n){return t.prototype=Object.create(e.Curve.prototype),t.prototype.getPoint=n,t},e.LineCurve3=e.Curve.create(function(e,t){this.v1=e,this.v2=t},function(t){var n=new e.Vector3;return n.subVectors(this.v2,this.v1),n.multiplyScalar(t),n.add(this.v1),n}),e.QuadraticBezierCurve3=e.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(t){var n,r;return n=e.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),r=e.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),t=e.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),new e.Vector3(n,r,t)}),e.CubicBezierCurve3=e.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(t){var n,r;return n=e.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=e.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=e.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new e.Vector3(n,r,t)}),e.SplineCurve3=e.Curve.create(function(e){this.points=void 0==e?[]:e},function(t){var n=new e.Vector3,r=[],i=this.points,s,t=(i.length-1)*t;s=Math.floor(t),t-=s,r[0]=0==s?s:s-1,r[1]=s,r[2]=s>i.length-2?i.length-1:s+1,r[3]=s>i.length-3?i.length-1:s+2,s=i[r[0]];var o=i[r[1]],u=i[r[2]],r=i[r[3]];return n.x=e.Curve.Utils.interpolate(s.x,o.x,u.x,r.x,t),n.y=e.Curve.Utils.interpolate(s.y,o.y,u.y,r.y,t),n.z=e.Curve.Utils.interpolate(s.z,o.z,u.z,r.z,t),n}),e.ClosedSplineCurve3=e.Curve.create(function(e){this.points=void 0==e?[]:e},function(t){var n=new e.Vector3,r=[],i=this.points,s;return s=(i.length-0)*t,t=Math.floor(s),s-=t,t+=0<t?0:(Math.floor(Math.abs(t)/i.length)+1)*i.length,r[0]=(t-1)%i.length,r[1]=t%i.length,r[2]=(t+1)%i.length,r[3]=(t+2)%i.length,n.x=e.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,s),n.y=e.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,s),n.z=e.Curve.Utils.interpolate(i[r[0]].z,i[r[1]].z,i[r[2]].z,i[r[3]].z,s),n}),e.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},e.CurvePath.prototype=Object.create(e.Curve.prototype),e.CurvePath.prototype.add=function(e){this.curves.push(e)},e.CurvePath.prototype.checkConnection=function(){},e.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);t.equals(n)||this.curves.push(new e.LineCurve(n,t))},e.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},e.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},e.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},e.CurvePath.prototype.getBoundingBox=function(){var t=this.getPoints(),n,r,i,s,o,u;n=r=Number.NEGATIVE_INFINITY,s=o=Number.POSITIVE_INFINITY;var a,f,l,c,h=t[0]instanceof e.Vector3;c=h?new e.Vector3:new e.Vector2,f=0;for(l=t.length;f<l;f++)a=t[f],a.x>n?n=a.x:a.x<s&&(s=a.x),a.y>r?r=a.y:a.y<o&&(o=a.y),h&&(a.z>i?i=a.z:a.z<u&&(u=a.z)),c.add(a);return t={minX:s,minY:o,maxX:n,maxY:r,centroid:c.divideScalar(l)},h&&(t.maxZ=i,t.minZ=u),t},e.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},e.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},e.CurvePath.prototype.createGeometry=function(t){for(var n=new e.Geometry,r=0;r<t.length;r++)n.vertices.push(new e.Vector3(t[r].x,t[r].y,t[r].z||0));return n},e.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},e.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},e.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},e.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;r=0;for(i=e.length;r<i;r++)s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o),o=t.getPoint(a),u=t.getNormalVector(a).multiplyScalar(u),s.x=o.x+u.x,s.y=o.y+u.y;return e},e.Gyroscope=function(){e.Object3D.call(this)},e.Gyroscope.prototype=Object.create(e.Object3D.prototype),e.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.makeFromPositionQuaternionScale(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},e.Gyroscope.prototype.translationWorld=new e.Vector3,e.Gyroscope.prototype.translationObject=new e.Vector3,e.Gyroscope.prototype.rotationWorld=new e.Quaternion,e.Gyroscope.prototype.rotationObject=new e.Quaternion,e.Gyroscope.prototype.scaleWorld=new e.Vector3,e.Gyroscope.prototype.scaleObject=new e.Vector3,e.Path=function(t){e.CurvePath.call(this),this.actions=[],t&&this.fromPoints(t)},e.Path.prototype=Object.create(e.CurvePath.prototype),e.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},e.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},e.Path.prototype.moveTo=function(t,n){var r=Array.prototype.slice.call(arguments);this.actions.push({action:e.PathActions.MOVE_TO,args:r})},e.Path.prototype.lineTo=function(t,n){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=new e.LineCurve(new e.Vector2(i[i.length-2],i[i.length-1]),new e.Vector2(t,n));this.curves.push(i),this.actions.push({action:e.PathActions.LINE_TO,args:r})},e.Path.prototype.quadraticCurveTo=function(t,n,r,i){var s=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,o=new e.QuadraticBezierCurve(new e.Vector2(o[o.length-2],o[o.length-1]),new e.Vector2(t,n),new e.Vector2(r,i));this.curves.push(o),this.actions.push({action:e.PathActions.QUADRATIC_CURVE_TO,args:s})},e.Path.prototype.bezierCurveTo=function(t,n,r,i,s,o){var u=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,a=new e.CubicBezierCurve(new e.Vector2(a[a.length-2],a[a.length-1]),new e.Vector2(t,n),new e.Vector2(r,i),new e.Vector2(s,o));this.curves.push(a),this.actions.push({action:e.PathActions.BEZIER_CURVE_TO,args:u})},e.Path.prototype.splineThru=function(t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=[new e.Vector2(r[r.length-2],r[r.length-1])];Array.prototype.push.apply(r,t),r=new e.SplineCurve(r),this.curves.push(r),this.actions.push({action:e.PathActions.CSPLINE_THRU,args:n})},e.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args;this.absarc(e+o[o.length-2],t+o[o.length-1],n,r,i,s)},e.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)},e.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args;this.absellipse(e+u[u.length-2],t+u[u.length-1],n,r,i,s,o)},e.Path.prototype.absellipse=function(t,n,r,i,s,o,u){var a=Array.prototype.slice.call(arguments),f=new e.EllipseCurve(t,n,r,i,s,o,u);this.curves.push(f),f=f.getPoint(u?1:0),a.push(f.x),a.push(f.y),this.actions.push({action:e.PathActions.ELLIPSE,args:a})},e.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],n=0;n<e;n++)t.push(this.getPoint(n/e));return t},e.Path.prototype.getPoints=function(t,n){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(t,n);var t=t||12,r=[],i,s,o,u,a,f,l,c,h,p,d,v,m;i=0;for(s=this.actions.length;i<s;i++)switch(o=this.actions[i],u=o.action,o=o.args,u){case e.PathActions.MOVE_TO:r.push(new e.Vector2(o[0],o[1]));break;case e.PathActions.LINE_TO:r.push(new e.Vector2(o[0],o[1]));break;case e.PathActions.QUADRATIC_CURVE_TO:a=o[2],f=o[3],h=o[0],p=o[1],0<r.length?(u=r[r.length-1],d=u.x,v=u.y):(u=this.actions[i-1].args,d=u[u.length-2],v=u[u.length-1]);for(o=1;o<=t;o++)m=o/t,u=e.Shape.Utils.b2(m,d,h,a),m=e.Shape.Utils.b2(m,v,p,f),r.push(new e.Vector2(u,m));break;case e.PathActions.BEZIER_CURVE_TO:a=o[4],f=o[5],h=o[0],p=o[1],l=o[2],c=o[3],0<r.length?(u=r[r.length-1],d=u.x,v=u.y):(u=this.actions[i-1].args,d=u[u.length-2],v=u[u.length-1]);for(o=1;o<=t;o++)m=o/t,u=e.Shape.Utils.b3(m,d,h,l,a),m=e.Shape.Utils.b3(m,v,p,c,f),r.push(new e.Vector2(u,m));break;case e.PathActions.CSPLINE_THRU:u=this.actions[i-1].args,m=[new e.Vector2(u[u.length-2],u[u.length-1])],u=t*o[0].length,m=m.concat(o[0]),m=new e.SplineCurve(m);for(o=1;o<=u;o++)r.push(m.getPointAt(o/u));break;case e.PathActions.ARC:a=o[0],f=o[1],p=o[2],l=o[3],u=o[4],h=!!o[5],d=u-l,v=2*t;for(o=1;o<=v;o++)m=o/v,h||(m=1-m),m=l+m*d,u=a+p*Math.cos(m),m=f+p*Math.sin(m),r.push(new e.Vector2(u,m));break;case e.PathActions.ELLIPSE:a=o[0],f=o[1],p=o[2],c=o[3],l=o[4],u=o[5],h=!!o[6],d=u-l,v=2*t;for(o=1;o<=v;o++)m=o/v,h||(m=1-m),m=l+m*d,u=a+p*Math.cos(m),m=f+c*Math.sin(m),r.push(new e.Vector2(u,m))}return i=r[r.length-1],1e-10>Math.abs(i.x-r[0].x)&&1e-10>Math.abs(i.y-r[0].y)&&r.splice(r.length-1,1),n&&r.push(r[0]),r},e.Path.prototype.toShapes=function(){var t,n,r,i,s=[],o=new e.Path;t=0;for(n=this.actions.length;t<n;t++)r=this.actions[t],i=r.args,r=r.action,r==e.PathActions.MOVE_TO&&0!=o.actions.length&&(s.push(o),o=new e.Path),o[r].apply(o,i);0!=o.actions.length&&s.push(o);if(0==s.length)return[];var u;i=[],t=!e.Shape.Utils.isClockWise(s[0].getPoints());if(1==s.length)return o=s[0],u=new e.Shape,u.actions=o.actions,u.curves=o.curves,i.push(u),i;if(t){u=new e.Shape,t=0;for(n=s.length;t<n;t++)o=s[t],e.Shape.Utils.isClockWise(o.getPoints())?(u.actions=o.actions,u.curves=o.curves,i.push(u),u=new e.Shape):u.holes.push(o)}else{t=0;for(n=s.length;t<n;t++)o=s[t],e.Shape.Utils.isClockWise(o.getPoints())?(u&&i.push(u),u=new e.Shape,u.actions=o.actions,u.curves=o.curves):u.holes.push(o);i.push(u)}return i},e.Shape=function(){e.Path.apply(this,arguments),this.holes=[]},e.Shape.prototype=Object.create(e.Path.prototype),e.Shape.prototype.extrude=function(t){return new e.ExtrudeGeometry(this,t)},e.Shape.prototype.makeGeometry=function(t){return new e.ShapeGeometry(this,t)},e.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},e.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},e.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},e.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},e.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},e.Shape.Utils={removeHoles:function(t,n){var r=t.concat(),i=r.concat(),s,o,u,a,f,l,c,h,p,d,v=[];for(f=0;f<n.length;f++){l=n[f],Array.prototype.push.apply(i,l),o=Number.POSITIVE_INFINITY;for(s=0;s<l.length;s++){p=l[s],d=[];for(h=0;h<r.length;h++)c=r[h],c=p.distanceToSquared(c),d.push(c),c<o&&(o=c,u=s,a=h)}s=0<=a-1?a-1:r.length-1,o=0<=u-1?u-1:l.length-1;var m=[l[u],r[a],r[s]];h=e.FontUtils.Triangulate.area(m);var g=[l[u],l[o],r[a]];p=e.FontUtils.Triangulate.area(g),d=a,c=u,a+=1,u+=-1,0>a&&(a+=r.length),a%=r.length,0>u&&(u+=l.length),u%=l.length,s=0<=a-1?a-1:r.length-1,o=0<=u-1?u-1:l.length-1,m=[l[u],r[a],r[s]],m=e.FontUtils.Triangulate.area(m),g=[l[u],l[o],r[a]],g=e.FontUtils.Triangulate.area(g),h+p>m+g&&(a=d,u=c,0>a&&(a+=r.length),a%=r.length,0>u&&(u+=l.length),u%=l.length,s=0<=a-1?a-1:r.length-1,o=0<=u-1?u-1:l.length-1),h=r.slice(0,a),p=r.slice(a),d=l.slice(u),c=l.slice(0,u),o=[l[u],l[o],r[a]],v.push([l[u],r[a],r[s]]),v.push(o),r=h.concat(d).concat(c).concat(p)}return{shape:r,isolatedPts:v,allpoints:i}},triangulateShape:function(t,n){var r=e.Shape.Utils.removeHoles(t,n),i=r.allpoints,s=r.isolatedPts,r=e.FontUtils.Triangulate(r.shape,!1),o,u,a,f,l={};o=0;for(u=i.length;o<u;o++)f=i[o].x+":"+i[o].y,void 0!==l[f]&&console.log("Duplicate point",f),l[f]=o;o=0;for(u=r.length;o<u;o++){a=r[o];for(i=0;3>i;i++)f=a[i].x+":"+a[i].y,f=l[f],void 0!==f&&(a[i]=f)}o=0;for(u=s.length;o<u;o++){a=s[o];for(i=0;3>i;i++)f=a[i].x+":"+a[i].y,f=l[f],void 0!==f&&(a[i]=f)}return r.concat(s)},isClockWise:function(t){return 0>e.FontUtils.Triangulate.area(t)},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},e.AnimationHandler=function(){var t=[],n={},r={update:function(e){for(var n=0;n<t.length;n++)t[n].update(e)},addToUpdate:function(e){-1===t.indexOf(e)&&t.push(e)},removeFromUpdate:function(e){e=t.indexOf(e),-1!==e&&t.splice(e,1)},add:function(t){void 0!==n[t.name]&&console.log("THREE.AnimationHandler.add: Warning! "+t.name+" already exists in library. Overwriting."),n[t.name]=t;if(!0!==t.initialized){for(var r=0;r<t.hierarchy.length;r++){for(var i=0;i<t.hierarchy[r].keys.length;i++)if(0>t.hierarchy[r].keys[i].time&&(t.hierarchy[r].keys[i].time=0),void 0!==t.hierarchy[r].keys[i].rot&&!(t.hierarchy[r].keys[i].rot instanceof e.Quaternion)){var s=t.hierarchy[r].keys[i].rot;t.hierarchy[r].keys[i].rot=new e.Quaternion(s[0],s[1],s[2],s[3])}if(t.hierarchy[r].keys.length&&void 0!==t.hierarchy[r].keys[0].morphTargets){s={};for(i=0;i<t.hierarchy[r].keys.length;i++)for(var o=0;o<t.hierarchy[r].keys[i].morphTargets.length;o++){var u=t.hierarchy[r].keys[i].morphTargets[o];s[u]=-1}t.hierarchy[r].usedMorphTargets=s;for(i=0;i<t.hierarchy[r].keys.length;i++){var a={};for(u in s){for(o=0;o<t.hierarchy[r].keys[i].morphTargets.length;o++)if(t.hierarchy[r].keys[i].morphTargets[o]===u){a[u]=t.hierarchy[r].keys[i].morphTargetsInfluences[o];break}o===t.hierarchy[r].keys[i].morphTargets.length&&(a[u]=0)}t.hierarchy[r].keys[i].morphTargetsInfluences=a}}for(i=1;i<t.hierarchy[r].keys.length;i++)t.hierarchy[r].keys[i].time===t.hierarchy[r].keys[i-1].time&&(t.hierarchy[r].keys.splice(i,1),i--);for(i=0;i<t.hierarchy[r].keys.length;i++)t.hierarchy[r].keys[i].index=i}i=parseInt(t.length*t.fps,10),t.JIT={},t.JIT.hierarchy=[];for(r=0;r<t.hierarchy.length;r++)t.JIT.hierarchy.push(Array(i));t.initialized=!0}},get:function(e){if("string"==typeof e)return n[e]?n[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(t){var n=[];if(t instanceof e.SkinnedMesh)for(var r=0;r<t.bones.length;r++)n.push(t.bones[r]);else i(t,n);return n}},i=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)i(e.children[n],t)};return r.LINEAR=0,r.CATMULLROM=1,r.CATMULLROM_FORWARD=2,r}(),e.Animation=function(t,n,r){this.root=t,this.data=e.AnimationHandler.get(n),this.hierarchy=e.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==r?r:e.AnimationHandler.LINEAR,this.points=[],this.target=new e.Vector3},e.Animation.prototype.play=function(t,n){if(!1===this.isPlaying){this.isPlaying=!0,this.loop=void 0!==t?t:!0,this.currentTime=void 0!==n?n:0;var r,i=this.hierarchy.length,s;for(r=0;r<i;r++){s=this.hierarchy[r],this.interpolationType!==e.AnimationHandler.CATMULLROM_FORWARD&&(s.useQuaternion=!0),s.matrixAutoUpdate=!0,void 0===s.animationCache&&(s.animationCache={},s.animationCache.prevKey={pos:0,rot:0,scl:0},s.animationCache.nextKey={pos:0,rot:0,scl:0},s.animationCache.originalMatrix=s instanceof e.Bone?s.skinMatrix:s.matrix);var o=s.animationCache.prevKey;s=s.animationCache.nextKey,o.pos=this.data.hierarchy[r].keys[0],o.rot=this.data.hierarchy[r].keys[0],o.scl=this.data.hierarchy[r].keys[0],s.pos=this.getNextKeyWith("pos",r,1),s.rot=this.getNextKeyWith("rot",r,1),s.scl=this.getNextKeyWith("scl",r,1)}this.update(0)}this.isPaused=!1,e.AnimationHandler.addToUpdate(this)},e.Animation.prototype.pause=function(){!0===this.isPaused?e.AnimationHandler.addToUpdate(this):e.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},e.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,e.AnimationHandler.removeFromUpdate(this)},e.Animation.prototype.update=function(t){if(!1!==this.isPlaying){var n=["pos","rot","scl"],r,i,s,o,u,a,f,l,c;c=this.currentTime+=t*this.timeScale,l=this.currentTime%=this.data.length,parseInt(Math.min(l*this.data.fps,this.data.length*this.data.fps),10);for(var h=0,p=this.hierarchy.length;h<p;h++){t=this.hierarchy[h],f=t.animationCache;for(var d=0;3>d;d++){r=n[d],u=f.prevKey[r],a=f.nextKey[r];if(a.time<=c){if(l<c){if(!this.loop){this.stop();return}u=this.data.hierarchy[h].keys[0];for(a=this.getNextKeyWith(r,h,1);a.time<l;)u=a,a=this.getNextKeyWith(r,h,a.index+1)}else do u=a,a=this.getNextKeyWith(r,h,a.index+1);while(a.time<l);f.prevKey[r]=u,f.nextKey[r]=a}t.matrixAutoUpdate=!0,t.matrixWorldNeedsUpdate=!0,i=(l-u.time)/(a.time-u.time),s=u[r],o=a[r];if(0>i||1<i)console.log("THREE.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+h),i=0>i?0:1;if("pos"===r){if(r=t.position,this.interpolationType===e.AnimationHandler.LINEAR)r.x=s[0]+(o[0]-s[0])*i,r.y=s[1]+(o[1]-s[1])*i,r.z=s[2]+(o[2]-s[2])*i;else if(this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD)this.points[0]=this.getPrevKeyWith("pos",h,u.index-1).pos,this.points[1]=s,this.points[2]=o,this.points[3]=this.getNextKeyWith("pos",h,a.index+1).pos,i=.33*i+.33,s=this.interpolateCatmullRom(this.points,i),r.x=s[0],r.y=s[1],r.z=s[2],this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD&&(i=this.interpolateCatmullRom(this.points,1.01*i),this.target.set(i[0],i[1],i[2]),this.target.sub(r),this.target.y=0,this.target.normalize(),i=Math.atan2(this.target.x,this.target.z),t.rotation.set(0,i,0))}else"rot"===r?e.Quaternion.slerp(s,o,t.quaternion,i):"scl"===r&&(r=t.scale,r.x=s[0]+(o[0]-s[0])*i,r.y=s[1]+(o[1]-s[1])*i,r.z=s[2]+(o[2]-s[2])*i)}}}},e.Animation.prototype.interpolateCatmullRom=function(e,t){var n=[],r=[],i,s,o,u,a,f;return i=(e.length-1)*t,s=Math.floor(i),i-=s,n[0]=0===s?s:s-1,n[1]=s,n[2]=s>e.length-2?s:s+1,n[3]=s>e.length-3?s:s+2,s=e[n[0]],u=e[n[1]],a=e[n[2]],f=e[n[3]],n=i*i,o=i*n,r[0]=this.interpolate(s[0],u[0],a[0],f[0],i,n,o),r[1]=this.interpolate(s[1],u[1],a[1],f[1],i,n,o),r[2]=this.interpolate(s[2],u[2],a[2],f[2],i,n,o),r},e.Animation.prototype.interpolate=function(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t},e.Animation.prototype.getNextKeyWith=function(t,n,r){for(var i=this.data.hierarchy[n].keys,r=this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?r<i.length-1?r:i.length-1:r%i.length;r<i.length;r++)if(void 0!==i[r][t])return i[r];return this.data.hierarchy[n].keys[0]},e.Animation.prototype.getPrevKeyWith=function(t,n,r){for(var i=this.data.hierarchy[n].keys,r=this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?0<r?r:0:0<=r?r:r+i.length;0<=r;r--)if(void 0!==i[r][t])return i[r];return this.data.hierarchy[n].keys[i.length-1]},e.KeyFrameAnimation=function(t,n,r){this.root=t,this.data=e.AnimationHandler.get(n),this.hierarchy=e.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=void 0!==r?r:!0,t=0;for(n=this.hierarchy.length;t<n;t++){var r=this.data.hierarchy[t].sids,i=this.hierarchy[t];if(this.data.hierarchy[t].keys.length&&r){for(var s=0;s<r.length;s++){var o=r[s],u=this.getNextKeyWith(o,t,0);u&&u.apply(o)}i.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}},e.KeyFrameAnimation.prototype.play=function(t,n){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==t?t:!0,this.currentTime=void 0!==n?n:0,this.startTimeMs=n,this.startTime=1e7,this.endTime=-this.startTime;var r,i=this.hierarchy.length,s,o;for(r=0;r<i;r++)s=this.hierarchy[r],o=this.data.hierarchy[r],s.useQuaternion=!0,void 0===o.animationCache&&(o.animationCache={},o.animationCache.prevKey=null,o.animationCache.nextKey=null,o.animationCache.originalMatrix=s instanceof e.Bone?s.skinMatrix:s.matrix),s=this.data.hierarchy[r].keys,s.length&&(o.animationCache.prevKey=s[0],o.animationCache.nextKey=s[1],this.startTime=Math.min(s[0].time,this.startTime),this.endTime=Math.max(s[s.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,e.AnimationHandler.addToUpdate(this)},e.KeyFrameAnimation.prototype.pause=function(){this.isPaused?e.AnimationHandler.addToUpdate(this):e.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},e.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,e.AnimationHandler.removeFromUpdate(this);for(var t=0;t<this.data.hierarchy.length;t++){var n=this.hierarchy[t],r=this.data.hierarchy[t];if(void 0!==r.animationCache){var i=r.animationCache.originalMatrix;n instanceof e.Bone?(i.copy(n.skinMatrix),n.skinMatrix=i):(i.copy(n.matrix),n.matrix=i),delete r.animationCache}}},e.KeyFrameAnimation.prototype.update=function(t){if(this.isPlaying){var n,r,i,s,o=this.data.JIT.hierarchy,u,a,f;a=this.currentTime+=t*this.timeScale,u=this.currentTime%=this.data.length,u<this.startTimeMs&&(u=this.currentTime=this.startTimeMs+u),s=parseInt(Math.min(u*this.data.fps,this.data.length*this.data.fps),10);if((f=u<a)&&!this.loop){for(var t=0,l=this.hierarchy.length;t<l;t++){var c=this.data.hierarchy[t].keys,o=this.data.hierarchy[t].sids;i=c.length-1,s=this.hierarchy[t];if(c.length){for(c=0;c<o.length;c++)u=o[c],(a=this.getPrevKeyWith(u,t,i))&&a.apply(u);this.data.hierarchy[t].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(u<this.startTime)){t=0;for(l=this.hierarchy.length;t<l;t++){i=this.hierarchy[t],n=this.data.hierarchy[t];var c=n.keys,h=n.animationCache;if(this.JITCompile&&void 0!==o[t][s])i instanceof e.Bone?(i.skinMatrix=o[t][s],i.matrixWorldNeedsUpdate=!1):(i.matrix=o[t][s],i.matrixWorldNeedsUpdate=!0);else if(c.length){this.JITCompile&&h&&(i instanceof e.Bone?i.skinMatrix=h.originalMatrix:i.matrix=h.originalMatrix),n=h.prevKey,r=h.nextKey;if(n&&r){if(r.time<=a){if(f&&this.loop){n=c[0];for(r=c[1];r.time<u;)n=r,r=c[n.index+1]}else if(!f)for(var p=c.length-1;r.time<u&&r.index!==p;)n=r,r=c[n.index+1];h.prevKey=n,h.nextKey=r}r.time>=u?n.interpolate(r,u):n.interpolate(r,r.time)}this.data.hierarchy[t].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===o[0][s]){this.hierarchy[0].updateMatrixWorld(!0);for(t=0;t<this.hierarchy.length;t++)o[t][s]=this.hierarchy[t]instanceof e.Bone?this.hierarchy[t].skinMatrix.clone():this.hierarchy[t].matrix.clone()}}}},e.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n%=t.length;n<t.length;n++)if(t[n].hasTarget(e))return t[n];return t[0]},e.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n=0<=n?n:n+t.length;0<=n;n--)if(t[n].hasTarget(e))return t[n];return t[t.length-1]},e.CubeCamera=function(t,n,r){e.Object3D.call(this);var i=new e.PerspectiveCamera(90,1,t,n);i.up.set(0,-1,0),i.lookAt(new e.Vector3(1,0,0)),this.add(i);var s=new e.PerspectiveCamera(90,1,t,n);s.up.set(0,-1,0),s.lookAt(new e.Vector3(-1,0,0)),this.add(s);var o=new e.PerspectiveCamera(90,1,t,n);o.up.set(0,0,1),o.lookAt(new e.Vector3(0,1,0)),this.add(o);var u=new e.PerspectiveCamera(90,1,t,n);u.up.set(0,0,-1),u.lookAt(new e.Vector3(0,-1,0)),this.add(u);var a=new e.PerspectiveCamera(90,1,t,n);a.up.set(0,-1,0),a.lookAt(new e.Vector3(0,0,1)),this.add(a);var f=new e.PerspectiveCamera(90,1,t,n);f.up.set(0,-1,0),f.lookAt(new e.Vector3(0,0,-1)),this.add(f),this.renderTarget=new e.WebGLRenderTargetCube(r,r,{format:e.RGBFormat,magFilter:e.LinearFilter,minFilter:e.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,r=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,i,n),n.activeCubeFace=1,e.render(t,s,n),n.activeCubeFace=2,e.render(t,o,n),n.activeCubeFace=3,e.render(t,u,n),n.activeCubeFace=4,e.render(t,a,n),n.generateMipmaps=r,n.activeCubeFace=5,e.render(t,f,n)}},e.CubeCamera.prototype=Object.create(e.Object3D.prototype),e.CombinedCamera=function(t,n,r,i,s,o,u){e.Camera.call(this),this.fov=r,this.left=-t/2,this.right=t/2,this.top=n/2,this.bottom=-n/2,this.cameraO=new e.OrthographicCamera(t/-2,t/2,n/2,n/-2,o,u),this.cameraP=new e.PerspectiveCamera(r,t/n,i,s),this.zoom=1,this.toPerspective()},e.CombinedCamera.prototype=Object.create(e.Camera.prototype),e.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},e.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},e.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},e.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},e.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},e.CombinedCamera.prototype.setLens=function(t,n){void 0===n&&(n=24);var r=2*e.Math.radToDeg(Math.atan(n/(2*t)));return this.setFov(r),r},e.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},e.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CircleGeometry=function(t,n,r,i){e.Geometry.call(this);var t=t||50,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,n=void 0!==n?Math.max(3,n):8,s,o=[];s=new e.Vector3;var u=new e.Vector2(.5,.5);this.vertices.push(s),o.push(u);for(s=0;s<=n;s++){var a=new e.Vector3,f=r+s/n*i;a.x=t*Math.cos(f),a.y=t*Math.sin(f),this.vertices.push(a),o.push(new e.Vector2((a.x/t+1)/2,(a.y/t+1)/2))}r=new e.Vector3(0,0,1);for(s=1;s<=n;s++)this.faces.push(new e.Face3(s,s+1,0,[r,r,r])),this.faceVertexUvs[0].push([o[s],o[s+1],u]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,t)},e.CircleGeometry.prototype=Object.create(e.Geometry.prototype),e.CubeGeometry=function(t,n,r,i,s,o){function u(t,n,r,i,s,o,u,f){var l,c=a.widthSegments,p=a.heightSegments,d=s/2,v=o/2,m=a.vertices.length;if("x"===t&&"y"===n||"y"===t&&"x"===n)l="z";else if("x"===t&&"z"===n||"z"===t&&"x"===n)l="y",p=a.depthSegments;else if("z"===t&&"y"===n||"y"===t&&"z"===n)l="x",c=a.depthSegments;var g=c+1,y=p+1,b=s/c,w=o/p,E=new e.Vector3;E[l]=0<u?1:-1;for(s=0;s<y;s++)for(o=0;o<g;o++){var S=new e.Vector3;S[t]=(o*b-d)*r,S[n]=(s*w-v)*i,S[l]=u,a.vertices.push(S)}for(s=0;s<p;s++)for(o=0;o<c;o++)t=new e.Face4(o+g*s+m,o+g*(s+1)+m,o+1+g*(s+1)+m,o+1+g*s+m),t.normal.copy(E),t.vertexNormals.push(E.clone(),E.clone(),E.clone(),E.clone()),t.materialIndex=f,a.faces.push(t),a.faceVertexUvs[0].push([new e.Vector2(o/c,1-s/p),new e.Vector2(o/c,1-(s+1)/p),new e.Vector2((o+1)/c,1-(s+1)/p),new e.Vector2((o+1)/c,1-s/p)])}e.Geometry.call(this);var a=this;this.width=t,this.height=n,this.depth=r,this.widthSegments=i||1,this.heightSegments=s||1,this.depthSegments=o||1,t=this.width/2,n=this.height/2,r=this.depth/2,u("z","y",-1,-1,this.depth,this.height,t,0),u("z","y",1,-1,this.depth,this.height,-t,1),u("x","z",1,1,this.width,this.depth,n,2),u("x","z",1,-1,this.width,this.depth,-n,3),u("x","y",1,-1,this.width,this.height,r,4),u("x","y",-1,-1,this.width,this.height,-r,5),this.computeCentroids(),this.mergeVertices()},e.CubeGeometry.prototype=Object.create(e.Geometry.prototype),e.CylinderGeometry=function(t,n,r,i,s,o){e.Geometry.call(this),this.radiusTop=t=void 0!==t?t:20,this.radiusBottom=n=void 0!==n?n:20,this.height=r=void 0!==r?r:100,this.radiusSegments=i=i||8,this.heightSegments=s=s||1,this.openEnded=o=void 0!==o?o:!1;var u=r/2,a,f,l=[],c=[];for(f=0;f<=s;f++){var h=[],p=[],d=f/s,v=d*(n-t)+t;for(a=0;a<=i;a++){var m=a/i,g=new e.Vector3;g.x=v*Math.sin(2*m*Math.PI),g.y=-d*r+u,g.z=v*Math.cos(2*m*Math.PI),this.vertices.push(g),h.push(this.vertices.length-1),p.push(new e.Vector2(m,1-d))}l.push(h),c.push(p)}r=(n-t)/r;for(a=0;a<i;a++){0!==t?(h=this.vertices[l[0][a]].clone(),p=this.vertices[l[0][a+1]].clone()):(h=this.vertices[l[1][a]].clone(),p=this.vertices[l[1][a+1]].clone()),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*r).normalize(),p.setY(Math.sqrt(p.x*p.x+p.z*p.z)*r).normalize();for(f=0;f<s;f++){var d=l[f][a],v=l[f+1][a],m=l[f+1][a+1],g=l[f][a+1],y=h.clone(),b=h.clone(),w=p.clone(),E=p.clone(),S=c[f][a].clone(),x=c[f+1][a].clone(),T=c[f+1][a+1].clone(),N=c[f][a+1].clone();this.faces.push(new e.Face4(d,v,m,g,[y,b,w,E])),this.faceVertexUvs[0].push([S,x,T,N])}}if(!1===o&&0<t){this.vertices.push(new e.Vector3(0,u,0));for(a=0;a<i;a++)d=l[0][a],v=l[0][a+1],m=this.vertices.length-1,y=new e.Vector3(0,1,0),b=new e.Vector3(0,1,0),w=new e.Vector3(0,1,0),S=c[0][a].clone(),x=c[0][a+1].clone(),T=new e.Vector2(x.u,0),this.faces.push(new e.Face3(d,v,m,[y,b,w])),this.faceVertexUvs[0].push([S,x,T])}if(!1===o&&0<n){this.vertices.push(new e.Vector3(0,-u,0));for(a=0;a<i;a++)d=l[f][a+1],v=l[f][a],m=this.vertices.length-1,y=new e.Vector3(0,-1,0),b=new e.Vector3(0,-1,0),w=new e.Vector3(0,-1,0),S=c[f][a+1].clone(),x=c[f][a].clone(),T=new e.Vector2(x.u,1),this.faces.push(new e.Face3(d,v,m,[y,b,w])),this.faceVertexUvs[0].push([S,x,T])}this.computeCentroids(),this.computeFaceNormals()},e.CylinderGeometry.prototype=Object.create(e.Geometry.prototype),e.ExtrudeGeometry=function(t,n){"undefined"!=typeof t&&(e.Geometry.call(this),t=t instanceof Array?t:[t],this.shapebb=t[t.length-1].getBoundingBox(),this.addShapeList(t,n),this.computeCentroids(),this.computeFaceNormals())},e.ExtrudeGeometry.prototype=Object.create(e.Geometry.prototype),e.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,r=0;r<n;r++)this.addShape(e[r],t)},e.ExtrudeGeometry.prototype.addShape=function(t,n){function r(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).add(e)}function i(t,n,r){var i=e.ExtrudeGeometry.__v1,s=e.ExtrudeGeometry.__v2,o=e.ExtrudeGeometry.__v3,u=e.ExtrudeGeometry.__v4,a=e.ExtrudeGeometry.__v5,f=e.ExtrudeGeometry.__v6;return i.set(t.x-n.x,t.y-n.y),s.set(t.x-r.x,t.y-r.y),i=i.normalize(),s=s.normalize(),o.set(-i.y,i.x),u.set(s.y,-s.x),a.copy(t).add(o),f.copy(t).add(u),a.equals(f)?u.clone():(a.copy(n).add(o),f.copy(r).add(u),o=i.dot(u),u=f.sub(a).dot(u),0===o&&(console.log("Either infinite or no solutions!"),0===u?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),u/=o,0>u?(n=Math.atan2(n.y-t.y,n.x-t.x),t=Math.atan2(r.y-t.y,r.x-t.x),n>t&&(t+=2*Math.PI),r=(n+t)/2,t=-Math.cos(r),r=-Math.sin(r),new e.Vector2(t,r)):i.multiplyScalar(u).add(a).sub(t).clone())}function s(r,i){var s,o;for(I=r.length;0<=--I;){s=I,o=I-1,0>o&&(o=r.length-1);for(var u=0,a=d+2*c,u=0;u<a;u++){var f=B*u,l=B*(u+1),h=i+s+f,f=i+o+f,p=i+o+l,l=i+s+l,v=r,m=u,g=a,y=s,E=o,h=h+A,f=f+A,p=p+A,l=l+A;L.faces.push(new e.Face4(h,f,p,l,null,null,b)),h=w.generateSideWallUV(L,t,v,n,h,f,p,l,m,g,y,E),L.faceVertexUvs[0].push(h)}}}function o(t,n,r){L.vertices.push(new e.Vector3(t,n,r))}function u(r,i,s,o){r+=A,i+=A,s+=A,L.faces.push(new e.Face3(r,i,s,null,null,y)),r=o?w.generateBottomUV(L,t,n,r,i,s):w.generateTopUV(L,t,n,r,i,s),L.faceVertexUvs[0].push(r)}var a=void 0!==n.amount?n.amount:100,f=void 0!==n.bevelThickness?n.bevelThickness:6,l=void 0!==n.bevelSize?n.bevelSize:f-2,c=void 0!==n.bevelSegments?n.bevelSegments:3,h=void 0!==n.bevelEnabled?n.bevelEnabled:!0,p=void 0!==n.curveSegments?n.curveSegments:12,d=void 0!==n.steps?n.steps:1,v=n.extrudePath,m,g=!1,y=n.material,b=n.extrudeMaterial,w=void 0!==n.UVGenerator?n.UVGenerator:e.ExtrudeGeometry.WorldUVGenerator,E,S,x,T;v&&(m=v.getSpacedPoints(d),g=!0,h=!1,E=void 0!==n.frames?n.frames:new e.TubeGeometry.FrenetFrames(v,d,!1),S=new e.Vector3,x=new e.Vector3,T=new e.Vector3),h||(l=f=c=0);var N,C,k,L=this,A=this.vertices.length,p=t.extractPoints(p),O=p.shape,p=p.holes;if(v=!e.Shape.Utils.isClockWise(O)){O=O.reverse(),C=0;for(k=p.length;C<k;C++)N=p[C],e.Shape.Utils.isClockWise(N)&&(p[C]=N.reverse());v=!1}var M=e.Shape.Utils.triangulateShape(O,p),v=O;C=0;for(k=p.length;C<k;C++)N=p[C],O=O.concat(N);var _,D,P,H,B=O.length,j=M.length,F=[],I=0,q=v.length;_=q-1;for(D=I+1;I<q;I++,_++,D++)_===q&&(_=0),D===q&&(D=0),F[I]=i(v[I],v[_],v[D]);var R=[],U,z=F.concat();C=0;for(k=p.length;C<k;C++){N=p[C],U=[],I=0,q=N.length,_=q-1;for(D=I+1;I<q;I++,_++,D++)_===q&&(_=0),D===q&&(D=0),U[I]=i(N[I],N[_],N[D]);R.push(U),z=z.concat(U)}for(_=0;_<c;_++){N=_/c,P=f*(1-N),D=l*Math.sin(N*Math.PI/2),I=0;for(q=v.length;I<q;I++)H=r(v[I],F[I],D),o(H.x,H.y,-P);C=0;for(k=p.length;C<k;C++){N=p[C],U=R[C],I=0;for(q=N.length;I<q;I++)H=r(N[I],U[I],D),o(H.x,H.y,-P)}}D=l;for(I=0;I<B;I++)H=h?r(O[I],z[I],D):O[I],g?(x.copy(E.normals[0]).multiplyScalar(H.x),S.copy(E.binormals[0]).multiplyScalar(H.y),T.copy(m[0]).add(x).add(S),o(T.x,T.y,T.z)):o(H.x,H.y,0);for(N=1;N<=d;N++)for(I=0;I<B;I++)H=h?r(O[I],z[I],D):O[I],g?(x.copy(E.normals[N]).multiplyScalar(H.x),S.copy(E.binormals[N]).multiplyScalar(H.y),T.copy(m[N]).add(x).add(S),o(T.x,T.y,T.z)):o(H.x,H.y,a/d*N);for(_=c-1;0<=_;_--){N=_/c,P=f*(1-N),D=l*Math.sin(N*Math.PI/2),I=0;for(q=v.length;I<q;I++)H=r(v[I],F[I],D),o(H.x,H.y,a+P);C=0;for(k=p.length;C<k;C++){N=p[C],U=R[C],I=0;for(q=N.length;I<q;I++)H=r(N[I],U[I],D),g?o(H.x,H.y+m[d-1].y,m[d-1].x+P):o(H.x,H.y,a+P)}}if(h){f=0*B;for(I=0;I<j;I++)a=M[I],u(a[2]+f,a[1]+f,a[0]+f,!0);f=B*(d+2*c);for(I=0;I<j;I++)a=M[I],u(a[0]+f,a[1]+f,a[2]+f,!1)}else{for(I=0;I<j;I++)a=M[I],u(a[2],a[1],a[0],!0);for(I=0;I<j;I++)a=M[I],u(a[0]+B*d,a[1]+B*d,a[2]+B*d,!1)}a=0,s(v,a),a+=v.length,C=0;for(k=p.length;C<k;C++)N=p[C],s(N,a),a+=N.length},e.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(t,n,r,i,s,o){return n=t.vertices[s].x,s=t.vertices[s].y,r=t.vertices[o].x,o=t.vertices[o].y,[new e.Vector2(t.vertices[i].x,t.vertices[i].y),new e.Vector2(n,s),new e.Vector2(r,o)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},generateSideWallUV:function(t,n,r,i,s,o,u,a){var n=t.vertices[s].x,r=t.vertices[s].y,s=t.vertices[s].z,i=t.vertices[o].x,f=t.vertices[o].y,o=t.vertices[o].z,l=t.vertices[u].x,c=t.vertices[u].y,u=t.vertices[u].z,h=t.vertices[a].x,p=t.vertices[a].y,t=t.vertices[a].z;return.01>Math.abs(r-f)?[new e.Vector2(n,1-s),new e.Vector2(i,1-o),new e.Vector2(l,1-u),new e.Vector2(h,1-t)]:[new e.Vector2(r,1-s),new e.Vector2(f,1-o),new e.Vector2(c,1-u),new e.Vector2(p,1-t)]}},e.ExtrudeGeometry.__v1=new e.Vector2,e.ExtrudeGeometry.__v2=new e.Vector2,e.ExtrudeGeometry.__v3=new e.Vector2,e.ExtrudeGeometry.__v4=new e.Vector2,e.ExtrudeGeometry.__v5=new e.Vector2,e.ExtrudeGeometry.__v6=new e.Vector2,e.ShapeGeometry=function(t,n){e.Geometry.call(this),0==t instanceof Array&&(t=[t]),this.shapebb=t[t.length-1].getBoundingBox(),this.addShapeList(t,n),this.computeCentroids(),this.computeFaceNormals()},e.ShapeGeometry.prototype=Object.create(e.Geometry.prototype),e.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++)this.addShape(e[n],t);return this},e.ShapeGeometry.prototype.addShape=function(t,n){void 0===n&&(n={});var r=n.material,i=void 0===n.UVGenerator?e.ExtrudeGeometry.WorldUVGenerator:n.UVGenerator,s,o,u,a=this.vertices.length;s=t.extractPoints(void 0!==n.curveSegments?n.curveSegments:12);var f=s.shape,l=s.holes;if(!e.Shape.Utils.isClockWise(f)){f=f.reverse(),s=0;for(o=l.length;s<o;s++)u=l[s],e.Shape.Utils.isClockWise(u)&&(l[s]=u.reverse())}var c=e.Shape.Utils.triangulateShape(f,l);s=0;for(o=l.length;s<o;s++)u=l[s],f=f.concat(u);l=f.length,o=c.length;for(s=0;s<l;s++)u=f[s],this.vertices.push(new e.Vector3(u.x,u.y,0));for(s=0;s<o;s++)l=c[s],f=l[0]+a,u=l[1]+a,l=l[2]+a,this.faces.push(new e.Face3(f,u,l,null,null,r)),this.faceVertexUvs[0].push(i.generateBottomUV(this,t,n,f,u,l))},e.LatheGeometry=function(t,n,r,i){e.Geometry.call(this);for(var n=n||12,r=r||0,i=i||2*Math.PI,s=1/(t.length-1),o=1/n,u=0,a=n;u<=a;u++)for(var f=r+u*o*i,l=Math.cos(f),c=Math.sin(f),f=0,h=t.length;f<h;f++){var p=t[f],d=new e.Vector3;d.x=l*p.x-c*p.y,d.y=c*p.x+l*p.y,d.z=p.z,this.vertices.push(d)}r=t.length,u=0;for(a=n;u<a;u++){f=0;for(h=t.length-1;f<h;f++)i=n=f+r*u,c=n+r,l=n+1+r,this.faces.push(new e.Face4(i,c,l,n+1)),l=u*o,n=f*s,i=l+o,c=n+s,this.faceVertexUvs[0].push([new e.Vector2(l,n),new e.Vector2(i,n),new e.Vector2(i,c),new e.Vector2(l,c)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.LatheGeometry.prototype=Object.create(e.Geometry.prototype),e.PlaneGeometry=function(t,n,r,i){e.Geometry.call(this),this.width=t,this.height=n,this.widthSegments=r||1,this.heightSegments=i||1;for(var r=t/2,s=n/2,i=this.widthSegments,o=this.heightSegments,u=i+1,a=o+1,f=this.width/i,l=this.height/o,c=new e.Vector3(0,0,1),t=0;t<a;t++)for(n=0;n<u;n++)this.vertices.push(new e.Vector3(n*f-r,-(t*l-s),0));for(t=0;t<o;t++)for(n=0;n<i;n++)r=new e.Face4(n+u*t,n+u*(t+1),n+1+u*(t+1),n+1+u*t),r.normal.copy(c),r.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),this.faces.push(r),this.faceVertexUvs[0].push([new e.Vector2(n/i,1-t/o),new e.Vector2(n/i,1-(t+1)/o),new e.Vector2((n+1)/i,1-(t+1)/o),new e.Vector2((n+1)/i,1-t/o)]);this.computeCentroids()},e.PlaneGeometry.prototype=Object.create(e.Geometry.prototype),e.RingGeometry=function(t,n,r,i,s,o){e.Geometry.call(this);for(var t=t||0,n=n||50,s=void 0!==s?s:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(3,i):8,u=[],a=t,f=(n-t)/i,t=0;t<=i;t++){for(n=0;n<=r;n++){var l=new e.Vector3,c=s+n/r*o;l.x=a*Math.cos(c),l.y=a*Math.sin(c),this.vertices.push(l),u.push(new e.Vector2((l.x/a+1)/2,-(l.y/a+1)/2+1))}a+=f}s=new e.Vector3(0,0,1);for(t=0;t<i;t++){o=t*r;for(n=0;n<=r;n++){var c=n+o,f=c+t,l=c+r+t,h=c+r+1+t;this.faces.push(new e.Face3(f,l,h,[s,s,s])),this.faceVertexUvs[0].push([u[f],u[l],u[h]]),f=c+t,l=c+r+1+t,h=c+1+t,this.faces.push(new e.Face3(f,l,h,[s,s,s])),this.faceVertexUvs[0].push([u[f],u[l],u[h]])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,a)},e.RingGeometry.prototype=Object.create(e.Geometry.prototype),e.SphereGeometry=function(t,n,r,i,s,o,u){e.Geometry.call(this),this.radius=t=t||50,this.widthSegments=n=Math.max(3,Math.floor(n)||8),this.heightSegments=r=Math.max(2,Math.floor(r)||6),this.phiStart=i=void 0!==i?i:0,this.phiLength=s=void 0!==s?s:2*Math.PI,this.thetaStart=o=void 0!==o?o:0,this.thetaLength=u=void 0!==u?u:Math.PI;var a,f,l=[],c=[];for(f=0;f<=r;f++){var h=[],p=[];for(a=0;a<=n;a++){var d=a/n,v=f/r,m=new e.Vector3;m.x=-t*Math.cos(i+d*s)*Math.sin(o+v*u),m.y=t*Math.cos(o+v*u),m.z=t*Math.sin(i+d*s)*Math.sin(o+v*u),this.vertices.push(m),h.push(this.vertices.length-1),p.push(new e.Vector2(d,1-v))}l.push(h),c.push(p)}for(f=0;f<this.heightSegments;f++)for(a=0;a<this.widthSegments;a++){var n=l[f][a+1],r=l[f][a],i=l[f+1][a],s=l[f+1][a+1],o=this.vertices[n].clone().normalize(),u=this.vertices[r].clone().normalize(),h=this.vertices[i].clone().normalize(),p=this.vertices[s].clone().normalize(),d=c[f][a+1].clone(),v=c[f][a].clone(),m=c[f+1][a].clone(),g=c[f+1][a+1].clone();Math.abs(this.vertices[n].y)===this.radius?(this.faces.push(new e.Face3(n,i,s,[o,h,p])),this.faceVertexUvs[0].push([d,m,g])):Math.abs(this.vertices[i].y)===this.radius?(this.faces.push(new e.Face3(n,r,i,[o,u,h])),this.faceVertexUvs[0].push([d,v,m])):(this.faces.push(new e.Face4(n,r,i,s,[o,u,h,p])),this.faceVertexUvs[0].push([d,v,m,g]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,t)},e.SphereGeometry.prototype=Object.create(e.Geometry.prototype),e.TextGeometry=function(t,n){var n=n||{},r=e.FontUtils.generateShapes(t,n);n.amount=void 0!==n.height?n.height:50,void 0===n.bevelThickness&&(n.bevelThickness=10),void 0===n.bevelSize&&(n.bevelSize=8),void 0===n.bevelEnabled&&(n.bevelEnabled=!1),e.ExtrudeGeometry.call(this,r,n)},e.TextGeometry.prototype=Object.create(e.ExtrudeGeometry.prototype),e.TorusGeometry=function(t,n,r,i,s){e.Geometry.call(this),this.radius=t||100,this.tube=n||40,this.radialSegments=r||8,this.tubularSegments=i||6,this.arc=s||2*Math.PI,s=new e.Vector3,t=[],n=[];for(r=0;r<=this.radialSegments;r++)for(i=0;i<=this.tubularSegments;i++){var o=i/this.tubularSegments*this.arc,u=2*r/this.radialSegments*Math.PI;s.x=this.radius*Math.cos(o),s.y=this.radius*Math.sin(o);var a=new e.Vector3;a.x=(this.radius+this.tube*Math.cos(u))*Math.cos(o),a.y=(this.radius+this.tube*Math.cos(u))*Math.sin(o),a.z=this.tube*Math.sin(u),this.vertices.push(a),t.push(new e.Vector2(i/this.tubularSegments,r/this.radialSegments)),n.push(a.clone().sub(s).normalize())}for(r=1;r<=this.radialSegments;r++)for(i=1;i<=this.tubularSegments;i++){var s=(this.tubularSegments+1)*r+i-1,o=(this.tubularSegments+1)*(r-1)+i-1,u=(this.tubularSegments+1)*(r-1)+i,a=(this.tubularSegments+1)*r+i,f=new e.Face4(s,o,u,a,[n[s],n[o],n[u],n[a]]);f.normal.add(n[s]),f.normal.add(n[o]),f.normal.add(n[u]),f.normal.add(n[a]),f.normal.normalize(),this.faces.push(f),this.faceVertexUvs[0].push([t[s].clone(),t[o].clone(),t[u].clone(),t[a].clone()])}this.computeCentroids()},e.TorusGeometry.prototype=Object.create(e.Geometry.prototype),e.TorusKnotGeometry=function(t,n,r,i,s,o,u){function a(t,n,r,i,s,o){var u=Math.cos(t);return Math.cos(n),n=Math.sin(t),t*=r/i,r=Math.cos(t),u*=.5*s*(2+r),n=.5*s*(2+r)*n,s=.5*o*s*Math.sin(t),new e.Vector3(u,n,s)}e.Geometry.call(this),this.radius=t||100,this.tube=n||40,this.radialSegments=r||64,this.tubularSegments=i||8,this.p=s||2,this.q=o||3,this.heightScale=u||1,this.grid=Array(this.radialSegments),r=new e.Vector3,i=new e.Vector3,s=new e.Vector3;for(t=0;t<this.radialSegments;++t){this.grid[t]=Array(this.tubularSegments);for(n=0;n<this.tubularSegments;++n){var f=2*(t/this.radialSegments)*this.p*Math.PI,u=2*(n/this.tubularSegments)*Math.PI,o=a(f,u,this.q,this.p,this.radius,this.heightScale),f=a(f+.01,u,this.q,this.p,this.radius,this.heightScale);r.subVectors(f,o),i.addVectors(f,o),s.crossVectors(r,i),i.crossVectors(s,r),s.normalize(),i.normalize(),f=-this.tube*Math.cos(u),u=this.tube*Math.sin(u),o.x+=f*i.x+u*s.x,o.y+=f*i.y+u*s.y,o.z+=f*i.z+u*s.z,this.grid[t][n]=this.vertices.push(new e.Vector3(o.x,o.y,o.z))-1}}for(t=0;t<this.radialSegments;++t)for(n=0;n<this.tubularSegments;++n){var s=(t+1)%this.radialSegments,o=(n+1)%this.tubularSegments,r=this.grid[t][n],i=this.grid[s][n],s=this.grid[s][o],o=this.grid[t][o],u=new e.Vector2(t/this.radialSegments,n/this.tubularSegments),f=new e.Vector2((t+1)/this.radialSegments,n/this.tubularSegments),l=new e.Vector2((t+1)/this.radialSegments,(n+1)/this.tubularSegments),c=new e.Vector2(t/this.radialSegments,(n+1)/this.tubularSegments);this.faces.push(new e.Face4(r,i,s,o)),this.faceVertexUvs[0].push([u,f,l,c])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.TorusKnotGeometry.prototype=Object.create(e.Geometry.prototype),e.TubeGeometry=function(t,n,r,i,s,o){e.Geometry.call(this),this.path=t,this.segments=n||64,this.radius=r||1,this.radiusSegments=i||8,this.closed=s||!1,o&&(this.debug=new e.Object3D),this.grid=[];var u,a,s=this.segments+1,f,l,c,o=new e.Vector3,h,p,d,n=new e.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed);h=n.tangents,p=n.normals,d=n.binormals,this.tangents=h,this.normals=p,this.binormals=d;for(n=0;n<s;n++){this.grid[n]=[],i=n/(s-1),c=t.getPointAt(i),i=h[n],u=p[n],a=d[n],this.debug&&(this.debug.add(new e.ArrowHelper(i,c,r,255)),this.debug.add(new e.ArrowHelper(u,c,r,16711680)),this.debug.add(new e.ArrowHelper(a,c,r,65280)));for(i=0;i<this.radiusSegments;i++)f=2*(i/this.radiusSegments)*Math.PI,l=-this.radius*Math.cos(f),f=this.radius*Math.sin(f),o.copy(c),o.x+=l*u.x+f*a.x,o.y+=l*u.y+f*a.y,o.z+=l*u.z+f*a.z,this.grid[n][i]=this.vertices.push(new e.Vector3(o.x,o.y,o.z))-1}for(n=0;n<this.segments;n++)for(i=0;i<this.radiusSegments;i++)s=this.closed?(n+1)%this.segments:n+1,o=(i+1)%this.radiusSegments,t=this.grid[n][i],r=this.grid[s][i],s=this.grid[s][o],o=this.grid[n][o],h=new e.Vector2(n/this.segments,i/this.radiusSegments),p=new e.Vector2((n+1)/this.segments,i/this.radiusSegments),d=new e.Vector2((n+1)/this.segments,(i+1)/this.radiusSegments),u=new e.Vector2(n/this.segments,(i+1)/this.radiusSegments),this.faces.push(new e.Face4(t,r,s,o)),this.faceVertexUvs[0].push([h,p,d,u]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.TubeGeometry.prototype=Object.create(e.Geometry.prototype),e.TubeGeometry.FrenetFrames=function(t,n,r){new e.Vector3;var i=new e.Vector3;new e.Vector3;var s=[],o=[],u=[],a=new e.Vector3,f=new e.Matrix4,n=n+1,l,c,h;this.tangents=s,this.normals=o,this.binormals=u;for(l=0;l<n;l++)c=l/(n-1),s[l]=t.getTangentAt(c),s[l].normalize();o[0]=new e.Vector3,u[0]=new e.Vector3,t=Number.MAX_VALUE,l=Math.abs(s[0].x),c=Math.abs(s[0].y),h=Math.abs(s[0].z),l<=t&&(t=l,i.set(1,0,0)),c<=t&&(t=c,i.set(0,1,0)),h<=t&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),o[0].crossVectors(s[0],a),u[0].crossVectors(s[0],o[0]);for(l=1;l<n;l++)o[l]=o[l-1].clone(),u[l]=u[l-1].clone(),a.crossVectors(s[l-1],s[l]),1e-4<a.length()&&(a.normalize(),i=Math.acos(s[l-1].dot(s[l])),o[l].applyMatrix4(f.makeRotationAxis(a,i))),u[l].crossVectors(s[l],o[l]);if(r){i=Math.acos(o[0].dot(o[n-1])),i/=n-1,0<s[0].dot(a.crossVectors(o[0],o[n-1]))&&(i=-i);for(l=1;l<n;l++)o[l].applyMatrix4(f.makeRotationAxis(s[l],i*l)),u[l].crossVectors(s[l],o[l])}},e.PolyhedronGeometry=function(t,n,r,i){function s(t){var n=t.normalize().clone();n.index=a.vertices.push(n)-1;var r=Math.atan2(t.z,-t.x)/2/Math.PI+.5,t=Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5;return n.uv=new e.Vector2(r,1-t),n}function o(t,n,r){var i=new e.Face3(t.index,n.index,r.index,[t.clone(),n.clone(),r.clone()]);i.centroid.add(t).add(n).add(r).divideScalar(3),i.normal.copy(i.centroid).normalize(),a.faces.push(i),i=Math.atan2(i.centroid.z,-i.centroid.x),a.faceVertexUvs[0].push([u(t.uv,t,i),u(n.uv,n,i),u(r.uv,r,i)])}function u(t,n,r){return 0>r&&1===t.x&&(t=new e.Vector2(t.x-1,t.y)),0===n.x&&0===n.z&&(t=new e.Vector2(r/2/Math.PI+.5,t.y)),t.clone()}e.Geometry.call(this);for(var r=r||1,i=i||0,a=this,f=0,l=t.length;f<l;f++)s(new e.Vector3(t[f][0],t[f][1],t[f][2]));for(var c=this.vertices,t=[],f=0,l=n.length;f<l;f++){var h=c[n[f][0]],p=c[n[f][1]],d=c[n[f][2]];t[f]=new e.Face3(h.index,p.index,d.index,[h.clone(),p.clone(),d.clone()])}f=0;for(l=t.length;f<l;f++){p=t[f],c=i,n=Math.pow(2,c),Math.pow(4,c);for(var c=s(a.vertices[p.a]),h=s(a.vertices[p.b]),v=s(a.vertices[p.c]),p=[],d=0;d<=n;d++){p[d]=[];for(var m=s(c.clone().lerp(v,d/n)),g=s(h.clone().lerp(v,d/n)),y=n-d,b=0;b<=y;b++)p[d][b]=0==b&&d==n?m:s(m.clone().lerp(g,b/y))}for(d=0;d<n;d++)for(b=0;b<2*(n-d)-1;b++)c=Math.floor(b/2),0==b%2?o(p[d][c+1],p[d+1][c],p[d][c]):o(p[d][c+1],p[d+1][c+1],p[d+1][c])}f=0;for(l=this.faceVertexUvs[0].length;f<l;f++)i=this.faceVertexUvs[0][f],t=i[0].x,n=i[1].x,c=i[2].x,h=Math.max(t,Math.max(n,c)),p=Math.min(t,Math.min(n,c)),.9<h&&.1>p&&(.2>t&&(i[0].x+=1),.2>n&&(i[1].x+=1),.2>c&&(i[2].x+=1));this.mergeVertices(),f=0;for(l=this.vertices.length;f<l;f++)this.vertices[f].multiplyScalar(r);this.computeCentroids(),this.boundingSphere=new e.Sphere(new e.Vector3,r)},e.PolyhedronGeometry.prototype=Object.create(e.Geometry.prototype),e.IcosahedronGeometry=function(t,n){this.radius=t,this.detail=n;var r=(1+Math.sqrt(5))/2;e.PolyhedronGeometry.call(this,[[-1,r,0],[1,r,0],[-1,-r,0],[1,-r,0],[0,-1,r],[0,1,r],[0,-1,-r],[0,1,-r],[r,0,-1],[r,0,1],[-r,0,-1],[-r,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],t,n)},e.IcosahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.OctahedronGeometry=function(t,n){e.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],t,n)},e.OctahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.TetrahedronGeometry=function(t,n){e.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],t,n)},e.TetrahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.ParametricGeometry=function(t,n,r,i){e.Geometry.call(this);var s=this.vertices,o=this.faces,u=this.faceVertexUvs[0],i=void 0===i?!1:i,a,f,l,c,h=n+1;for(a=0;a<=r;a++){c=a/r;for(f=0;f<=n;f++)l=f/n,l=t(l,c),s.push(l)}var p,d,v,m;for(a=0;a<r;a++)for(f=0;f<n;f++)t=a*h+f,s=a*h+f+1,c=(a+1)*h+f,l=(a+1)*h+f+1,p=new e.Vector2(f/n,a/r),d=new e.Vector2((f+1)/n,a/r),v=new e.Vector2(f/n,(a+1)/r),m=new e.Vector2((f+1)/n,(a+1)/r),i?(o.push(new e.Face3(t,s,c)),o.push(new e.Face3(s,l,c)),u.push([p,d,v]),u.push([d,m,v])):(o.push(new e.Face4(t,s,l,c)),u.push([p,d,m,v]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.ParametricGeometry.prototype=Object.create(e.Geometry.prototype),e.ConvexGeometry=function(t){function n(t){var n=t.length();return new e.Vector2(t.x/n,t.y/n)}e.Geometry.call(this);for(var r=[[0,1,2],[0,2,1]],i=3;i<t.length;i++){var s=i,o=t[s].clone(),u=o.length();o.x+=u*2e-6*(Math.random()-.5),o.y+=u*2e-6*(Math.random()-.5),o.z+=u*2e-6*(Math.random()-.5);for(var u=[],a=0;a<r.length;){var f=r[a],l=o,c=t[f[0]],h;h=c;var p=t[f[1]],d=t[f[2]],v=new e.Vector3,m=new e.Vector3;v.subVectors(d,p),m.subVectors(h,p),v.cross(m),v.normalize(),h=v,c=h.dot(c);if(h.dot(l)>=c){for(l=0;3>l;l++){c=[f[l],f[(l+1)%3]],h=!0;for(p=0;p<u.length;p++)if(u[p][0]===c[1]&&u[p][1]===c[0]){u[p]=u[u.length-1],u.pop(),h=!1;break}h&&u.push(c)}r[a]=r[r.length-1],r.pop()}else a++}for(p=0;p<u.length;p++)r.push([u[p][0],u[p][1],s])}s=0,o=Array(t.length);for(i=0;i<r.length;i++){u=r[i];for(a=0;3>a;a++)void 0===o[u[a]]&&(o[u[a]]=s++,this.vertices.push(t[u[a]])),u[a]=o[u[a]]}for(i=0;i<r.length;i++)this.faces.push(new e.Face3(r[i][0],r[i][1],r[i][2]));for(i=0;i<this.faces.length;i++)u=this.faces[i],this.faceVertexUvs[0].push([n(this.vertices[u.a]),n(this.vertices[u.b]),n(this.vertices[u.c])]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},e.ConvexGeometry.prototype=Object.create(e.Geometry.prototype),e.AxisHelper=function(t){var t=t||1,n=new e.Geometry;n.vertices.push(new e.Vector3,new e.Vector3(t,0,0),new e.Vector3,new e.Vector3(0,t,0),new e.Vector3,new e.Vector3(0,0,t)),n.colors.push(new e.Color(16711680),new e.Color(16755200),new e.Color(65280),new e.Color(11206400),new e.Color(255),new e.Color(43775)),t=new e.LineBasicMaterial({vertexColors:e.VertexColors}),e.Line.call(this,n,t,e.LinePieces)},e.AxisHelper.prototype=Object.create(e.Line.prototype),e.ArrowHelper=function(t,n,r,i){e.Object3D.call(this),void 0===i&&(i=16776960),void 0===r&&(r=1),this.position=n,this.useQuaternion=!0,n=new e.Geometry,n.vertices.push(new e.Vector3(0,0,0)),n.vertices.push(new e.Vector3(0,1,0)),this.line=new e.Line(n,new e.LineBasicMaterial({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),n=new e.CylinderGeometry(0,.05,.25,5,1),n.applyMatrix((new e.Matrix4).makeTranslation(0,.875,0)),this.cone=new e.Mesh(n,new e.MeshBasicMaterial({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r)},e.ArrowHelper.prototype=Object.create(e.Object3D.prototype),e.ArrowHelper.prototype.setDirection=function(){var t=new e.Vector3,n;return function(e){.999<e.y?this.quaternion.set(0,0,0,1):-0.999>e.y?this.quaternion.set(1,0,0,0):(t.set(e.z,0,-e.x).normalize(),n=Math.acos(e.y),this.quaternion.setFromAxisAngle(t,n))}}(),e.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},e.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},e.BoxHelper=function(t){var t=t||1,n=new e.Geometry,t=[new e.Vector3(t,t,t),new e.Vector3(-t,t,t),new e.Vector3(-t,-t,t),new e.Vector3(t,-t,t),new e.Vector3(t,t,-t),new e.Vector3(-t,t,-t),new e.Vector3(-t,-t,-t),new e.Vector3(t,-t,-t)];n.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),this.vertices=t,e.Line.call(this,n,new e.LineBasicMaterial,e.LinePieces)},e.BoxHelper.prototype=Object.create(e.Line.prototype),e.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var n=t.boundingBox.min,t=t.boundingBox.max,r=this.vertices;r[0].set(t.x,t.y,t.z),r[1].set(n.x,t.y,t.z),r[2].set(n.x,n.y,t.z),r[3].set(t.x,n.y,t.z),r[4].set(t.x,t.y,n.z),r[5].set(n.x,t.y,n.z),r[6].set(n.x,n.y,n.z),r[7].set(t.x,n.y,n.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},e.CameraHelper=function(t){function n(e,t,n){r(e,n),r(t,n)}function r(t,n){i.vertices.push(new e.Vector3),i.colors.push(new e.Color(n)),void 0===o[t]&&(o[t]=[]),o[t].push(i.vertices.length-1)}e.Line.call(this);var i=new e.Geometry,s=new e.LineBasicMaterial({color:16777215,vertexColors:e.FaceColors}),o={};n("n1","n2",16755200),n("n2","n4",16755200),n("n4","n3",16755200),n("n3","n1",16755200),n("f1","f2",16755200),n("f2","f4",16755200),n("f4","f3",16755200),n("f3","f1",16755200),n("n1","f1",16755200),n("n2","f2",16755200),n("n3","f3",16755200),n("n4","f4",16755200),n("p","n1",16711680),n("p","n2",16711680),n("p","n3",16711680),n("p","n4",16711680),n("u1","u2",43775),n("u2","u3",43775),n("u3","u1",43775),n("c","t",16777215),n("p","c",3355443),n("cn1","cn2",3355443),n("cn3","cn4",3355443),n("cf1","cf2",3355443),n("cf3","cf4",3355443),e.Line.call(this,i,s,e.LinePieces),this.camera=t,this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},e.CameraHelper.prototype=Object.create(e.Line.prototype),e.CameraHelper.prototype.update=function(){var t=new e.Vector3,n=new e.Camera,r=new e.Projector;return function(){function e(e,s,o,u){t.set(s,o,u),r.unprojectVector(t,n),e=i.pointMap[e];if(void 0!==e){s=0;for(o=e.length;s<o;s++)i.geometry.vertices[e[s]].copy(t)}}var i=this;n.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-0.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),e.DirectionalLightHelper=function(t,n){e.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=t;var r=new e.SphereGeometry(n,4,2),i=new e.MeshBasicMaterial({fog:!1,wireframe:!0});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new e.Mesh(r,i),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),r=new e.Geometry,r.vertices.push(this.light.position),r.vertices.push(this.light.target.position),r.computeLineDistances(),i=new e.LineDashedMaterial({dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new e.Line(r,i),this.add(this.targetLine)},e.DirectionalLightHelper.prototype=Object.create(e.Object3D.prototype),e.DirectionalLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.GridHelper=function(t,n){for(var r=new e.Geometry,i=new e.LineBasicMaterial({vertexColors:e.VertexColors}),s=new e.Color(4473924),o=new e.Color(8947848),u=-t;u<=t;u+=n){r.vertices.push(new e.Vector3(-t,0,u)),r.vertices.push(new e.Vector3(t,0,u)),r.vertices.push(new e.Vector3(u,0,-t)),r.vertices.push(new e.Vector3(u,0,t));var a=0===u?s:o;r.colors.push(a,a,a,a)}e.Line.call(this,r,i,e.LinePieces)},e.GridHelper.prototype=Object.create(e.Line.prototype),e.HemisphereLightHelper=function(t,n){e.Object3D.call(this),this.light=t;var r=new e.SphereGeometry(n,4,2);r.applyMatrix((new e.Matrix4).makeRotationX(-Math.PI/2));for(var i=0;8>i;i++)r.faces[i].materialIndex=4>i?0:1;i=new e.MeshBasicMaterial({fog:!1,wireframe:!0}),i.color.copy(t.color).multiplyScalar(t.intensity);var s=new e.MeshBasicMaterial({fog:!1,wireframe:!0});s.color.copy(t.groundColor).multiplyScalar(t.intensity),this.lightSphere=new e.Mesh(r,new e.MeshFaceMaterial([i,s])),this.lightSphere.position=t.position,this.lightSphere.lookAt(new e.Vector3),this.add(this.lightSphere)},e.HemisphereLightHelper.prototype=Object.create(e.Object3D.prototype),e.HemisphereLightHelper.prototype.update=function(){this.lightSphere.lookAt(new e.Vector3),this.lightSphere.material.materials[0].color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere.material.materials[1].color.copy(this.light.groundColor).multiplyScalar(this.light.intensity)},e.PointLightHelper=function(t,n){e.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=t;var r=new e.SphereGeometry(n,4,2),i=new e.MeshBasicMaterial({fog:!1,wireframe:!0});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new e.Mesh(r,i),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere)},e.PointLightHelper.prototype=Object.create(e.Object3D.prototype),e.PointLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.SpotLightHelper=function(t,n){e.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=t;var r=new e.SphereGeometry(n,4,2),i=new e.MeshBasicMaterial({fog:!1,wireframe:!0});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new e.Mesh(r,i),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),r=new e.CylinderGeometry(1e-4,1,1,8,1,!0),r.applyMatrix((new e.Matrix4).makeTranslation(0,-0.5,0)),r.applyMatrix((new e.Matrix4).makeRotationX(-Math.PI/2)),i=new e.MeshBasicMaterial({fog:!1,wireframe:!0,opacity:.3,transparent:!0}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone=new e.Mesh(r,i),this.lightCone.position=this.light.position,r=t.distance?t.distance:1e4,i=r*Math.tan(t.angle),this.lightCone.scale.set(i,i,r),this.lightCone.lookAt(this.light.target.position),this.add(this.lightCone)},e.SpotLightHelper.prototype=Object.create(e.Object3D.prototype),e.SpotLightHelper.prototype.update=function(){var e=this.light.distance?this.light.distance:1e4,t=e*Math.tan(this.light.angle);this.lightCone.scale.set(t,t,e),this.lightCone.lookAt(this.light.target.position),this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.ImmediateRenderObject=function(){e.Object3D.call(this),this.render=function(){}},e.ImmediateRenderObject.prototype=Object.create(e.Object3D.prototype),e.LensFlare=function(t,n,r,i,s){e.Object3D.call(this),this.lensFlares=[],this.positionScreen=new e.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,n,r,i,s)},e.LensFlare.prototype=Object.create(e.Object3D.prototype),e.LensFlare.prototype.add=function(t,n,r,i,s,o){void 0===n&&(n=-1),void 0===r&&(r=0),void 0===o&&(o=1),void 0===s&&(s=new e.Color(16777215)),void 0===i&&(i=e.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:t,size:n,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:s,blending:i})},e.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=.25*n.x*Math.PI,n.rotation+=.25*(n.wantedRotation-n.rotation)},e.MorphBlendMesh=function(t,n){e.Mesh.call(this,t,n),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length;this.createAnimation("__default",0,r-1,r/1),this.setAnimationWeight("__default",1)},e.MorphBlendMesh.prototype=Object.create(e.Mesh.prototype),e.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){t={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},e.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)(\d+)/,n,r={},i=this.geometry,s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s].name.match(t);if(u&&1<u.length){var a=u[1];r[a]||(r[a]={start:Infinity,end:-Infinity}),u=r[a],s<u.start&&(u.start=s),s>u.end&&(u.end=s),n||(n=a)}}for(a in r)u=r[a],this.createAnimation(a,u.start,u.end,e);this.firstAnimation=n},e.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){if(e=this.animationsMap[e])e.direction=1,e.directionBackwards=!1},e.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){if(e=this.animationsMap[e])e.direction=-1,e.directionBackwards=!0},e.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},e.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},e.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},e.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},e.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;if(e=this.animationsMap[e])t=e.time;return t},e.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;if(e=this.animationsMap[e])t=e.duration;return t},e.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},e.MorphBlendMesh.prototype.stopAnimation=function(e){if(e=this.animationsMap[e])e.active=!1},e.MorphBlendMesh.prototype.update=function(t){for(var n=0,r=this.animationsList.length;n<r;n++){var i=this.animationsList[n];if(i.active){var s=i.duration/i.length;i.time+=i.direction*t;if(i.mirroredLoop){if(i.time>i.duration||0>i.time)i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),0>i.time&&(i.time=0,i.directionBackwards=!1)}else i.time%=i.duration,0>i.time&&(i.time+=i.duration);var o=i.startFrame+e.Math.clamp(Math.floor(i.time/s),0,i.length-1),u=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*u,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o),s=i.time%s/s,i.directionBackwards&&(s=1-s),this.morphTargetInfluences[i.currentFrame]=s*u,this.morphTargetInfluences[i.lastFrame]=(1-s)*u}}},e.LensFlarePlugin=function(){function t(e,t){var r=n.createProgram(),i=n.createShader(n.FRAGMENT_SHADER),s=n.createShader(n.VERTEX_SHADER),o="precision "+t+" float;\n";return n.shaderSource(i,o+e.fragmentShader),n.shaderSource(s,o+e.vertexShader),n.compileShader(i),n.compileShader(s),n.attachShader(r,i),n.attachShader(r,s),n.linkProgram(r),r}var n,r,i,s,o,u,a,f,l,c,h,p,d;this.init=function(v){n=v.context,r=v,i=v.getPrecision(),s=new Float32Array(16),o=new Uint16Array(6),v=0,s[v++]=-1,s[v++]=-1,s[v++]=0,s[v++]=0,s[v++]=1,s[v++]=-1,s[v++]=1,s[v++]=0,s[v++]=1,s[v++]=1,s[v++]=1,s[v++]=1,s[v++]=-1,s[v++]=1,s[v++]=0,s[v++]=1,v=0,o[v++]=0,o[v++]=1,o[v++]=2,o[v++]=0,o[v++]=2,o[v++]=3,u=n.createBuffer(),a=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,s,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a),n.bufferData(n.ELEMENT_ARRAY_BUFFER,o,n.STATIC_DRAW),f=n.createTexture(),l=n.createTexture(),n.bindTexture(n.TEXTURE_2D,f),n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.bindTexture(n.TEXTURE_2D,l),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),0>=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(c=!1,h=t(e.ShaderFlares.lensFlare,i)):(c=!0,h=t(e.ShaderFlares.lensFlareVertexTexture,i)),p={},d={},p.vertex=n.getAttribLocation(h,"position"),p.uv=n.getAttribLocation(h,"uv"),d.renderType=n.getUniformLocation(h,"renderType"),d.map=n.getUniformLocation(h,"map"),d.occlusionMap=n.getUniformLocation(h,"occlusionMap"),d.opacity=n.getUniformLocation(h,"opacity"),d.color=n.getUniformLocation(h,"color"),d.scale=n.getUniformLocation(h,"scale"),d.rotation=n.getUniformLocation(h,"rotation"),d.screenPosition=n.getUniformLocation(h,"screenPosition")},this.render=function(t,i,s,o){var t=t.__webglFlares,v=t.length;if(v){var y=new e.Vector3,w=o/s,E=.5*s,S=.5*o,x=16/o,T=new e.Vector2(x*w,x),N=new e.Vector3(1,1,0),C=new e.Vector2(1,1),k=d,x=p;n.useProgram(h),n.enableVertexAttribArray(p.vertex),n.enableVertexAttribArray(p.uv),n.uniform1i(k.occlusionMap,0),n.uniform1i(k.map,1),n.bindBuffer(n.ARRAY_BUFFER,u),n.vertexAttribPointer(x.vertex,2,n.FLOAT,!1,16,0),n.vertexAttribPointer(x.uv,2,n.FLOAT,!1,16,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a),n.disable(n.CULL_FACE),n.depthMask(!1);var L,A,O,M,_;for(L=0;L<v;L++)if(x=16/o,T.set(x*w,x),M=t[L],y.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),y.applyMatrix4(i.matrixWorldInverse),y.applyProjection(i.projectionMatrix),N.copy(y),C.x=N.x*E+E,C.y=N.y*S+S,c||0<C.x&&C.x<s&&0<C.y&&C.y<o){n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,f),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,C.x-8,C.y-8,16,16,0),n.uniform1i(k.renderType,0),n.uniform2f(k.scale,T.x,T.y),n.uniform3f(k.screenPosition,N.x,N.y,N.z),n.disable(n.BLEND),n.enable(n.DEPTH_TEST),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,C.x-8,C.y-8,16,16,0),n.uniform1i(k.renderType,1),n.disable(n.DEPTH_TEST),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,f),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),M.positionScreen.copy(N),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),n.uniform1i(k.renderType,2),n.enable(n.BLEND),A=0;for(O=M.lensFlares.length;A<O;A++)_=M.lensFlares[A],.001<_.opacity&&.001<_.scale&&(N.x=_.x,N.y=_.y,N.z=_.z,x=_.size*_.scale/o,T.x=x*w,T.y=x,n.uniform3f(k.screenPosition,N.x,N.y,N.z),n.uniform2f(k.scale,T.x,T.y),n.uniform1f(k.rotation,_.rotation),n.uniform1f(k.opacity,_.opacity),n.uniform3f(k.color,_.color.r,_.color.g,_.color.b),r.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),r.setTexture(_.texture,1),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}n.enable(n.CULL_FACE),n.enable(n.DEPTH_TEST),n.depthMask(!0)}}},e.ShadowMapPlugin=function(){var t,n,r,i,s,o,u=new e.Frustum,a=new e.Matrix4,f=new e.Vector3,l=new e.Vector3,c=new e.Vector3;this.init=function(u){t=u.context,n=u;var u=e.ShaderLib.depthRGBA,a=e.UniformsUtils.clone(u.uniforms);r=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a}),i=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,morphTargets:!0}),s=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,skinning:!0}),o=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0,o._shadowPass=!0},this.render=function(e,t){n.shadowMapEnabled&&n.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(p,v){var y,w,E,S,x,T,N,C,k,L=[];S=0,t.clearColor(1,1,1,1),t.disable(t.BLEND),t.enable(t.CULL_FACE),t.frontFace(t.CCW),n.shadowMapCullFace===e.CullFaceFront?t.cullFace(t.FRONT):t.cullFace(t.BACK),n.setDepthTest(!0),y=0;for(w=p.__lights.length;y<w;y++)if(E=p.__lights[y],E.castShadow)if(E instanceof e.DirectionalLight&&E.shadowCascade)for(x=0;x<E.shadowCascadeCount;x++){var A;if(E.shadowCascadeArray[x])A=E.shadowCascadeArray[x];else{k=E,N=x,A=new e.DirectionalLight,A.isVirtual=!0,A.onlyShadow=!0,A.castShadow=!0,A.shadowCameraNear=k.shadowCameraNear,A.shadowCameraFar=k.shadowCameraFar,A.shadowCameraLeft=k.shadowCameraLeft,A.shadowCameraRight=k.shadowCameraRight,A.shadowCameraBottom=k.shadowCameraBottom,A.shadowCameraTop=k.shadowCameraTop,A.shadowCameraVisible=k.shadowCameraVisible,A.shadowDarkness=k.shadowDarkness,A.shadowBias=k.shadowCascadeBias[N],A.shadowMapWidth=k.shadowCascadeWidth[N],A.shadowMapHeight=k.shadowCascadeHeight[N],A.pointsWorld=[],A.pointsFrustum=[],C=A.pointsWorld,T=A.pointsFrustum;for(var O=0;8>O;O++)C[O]=new e.Vector3,T[O]=new e.Vector3;C=k.shadowCascadeNearZ[N],k=k.shadowCascadeFarZ[N],T[0].set(-1,-1,C),T[1].set(1,-1,C),T[2].set(-1,1,C),T[3].set(1,1,C),T[4].set(-1,-1,k),T[5].set(1,-1,k),T[6].set(-1,1,k),T[7].set(1,1,k),A.originalCamera=v,T=new e.Gyroscope,T.position=E.shadowCascadeOffset,T.add(A),T.add(A.target),v.add(T),E.shadowCascadeArray[x]=A,console.log("Created virtualLight",A)}N=E,C=x,k=N.shadowCascadeArray[C],k.position.copy(N.position),k.target.position.copy(N.target.position),k.lookAt(k.target),k.shadowCameraVisible=N.shadowCameraVisible,k.shadowDarkness=N.shadowDarkness,k.shadowBias=N.shadowCascadeBias[C],T=N.shadowCascadeNearZ[C],N=N.shadowCascadeFarZ[C],k=k.pointsFrustum,k[0].z=T,k[1].z=T,k[2].z=T,k[3].z=T,k[4].z=N,k[5].z=N,k[6].z=N,k[7].z=N,L[S]=A,S++}else L[S]=E,S++;y=0;for(w=L.length;y<w;y++){E=L[y],E.shadowMap||(x=e.LinearFilter,n.shadowMapType===e.PCFSoftShadowMap&&(x=e.NearestFilter),E.shadowMap=new e.WebGLRenderTarget(E.shadowMapWidth,E.shadowMapHeight,{minFilter:x,magFilter:x,format:e.RGBAFormat}),E.shadowMapSize=new e.Vector2(E.shadowMapWidth,E.shadowMapHeight),E.shadowMatrix=new e.Matrix4);if(!E.shadowCamera){if(E instanceof e.SpotLight)E.shadowCamera=new e.PerspectiveCamera(E.shadowCameraFov,E.shadowMapWidth/E.shadowMapHeight,E.shadowCameraNear,E.shadowCameraFar);else{if(!(E instanceof e.DirectionalLight)){console.error("Unsupported light type for shadow");continue}E.shadowCamera=new e.OrthographicCamera(E.shadowCameraLeft,E.shadowCameraRight,E.shadowCameraTop,E.shadowCameraBottom,E.shadowCameraNear,E.shadowCameraFar)}p.add(E.shadowCamera),!0===p.autoUpdate&&p.updateMatrixWorld()}E.shadowCameraVisible&&!E.cameraHelper&&(E.cameraHelper=new e.CameraHelper(E.shadowCamera),E.shadowCamera.add(E.cameraHelper));if(E.isVirtual&&A.originalCamera==v){x=v,S=E.shadowCamera,T=E.pointsFrustum,k=E.pointsWorld,f.set(Infinity,Infinity,Infinity),l.set(-Infinity,-Infinity,-Infinity);for(N=0;8>N;N++)C=k[N],C.copy(T[N]),e.ShadowMapPlugin.__projector.unprojectVector(C,x),C.applyMatrix4(S.matrixWorldInverse),C.x<f.x&&(f.x=C.x),C.x>l.x&&(l.x=C.x),C.y<f.y&&(f.y=C.y),C.y>l.y&&(l.y=C.y),C.z<f.z&&(f.z=C.z),C.z>l.z&&(l.z=C.z);S.left=f.x,S.right=l.x,S.top=l.y,S.bottom=f.y,S.updateProjectionMatrix()}S=E.shadowMap,T=E.shadowMatrix,x=E.shadowCamera,x.position.getPositionFromMatrix(E.matrixWorld),c.getPositionFromMatrix(E.target.matrixWorld),x.lookAt(c),x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),E.cameraHelper&&(E.cameraHelper.visible=E.shadowCameraVisible),E.shadowCameraVisible&&E.cameraHelper.update(),T.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),T.multiply(x.projectionMatrix),T.multiply(x.matrixWorldInverse),a.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),u.setFromMatrix(a),n.setRenderTarget(S),n.clear(),k=p.__webglObjects,E=0;for(S=k.length;E<S;E++)if(N=k[E],T=N.object,N.render=!1,T.visible&&T.castShadow&&(!(T instanceof e.Mesh||T instanceof e.ParticleSystem)||!T.frustumCulled||u.intersectsObject(T)))T._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,T.matrixWorld),N.render=!0;E=0;for(S=k.length;E<S;E++)N=k[E],N.render&&(T=N.object,N=N.buffer,O=T.material instanceof e.MeshFaceMaterial?T.material.materials[0]:T.material,C=0<T.geometry.morphTargets.length&&O.morphTargets,O=T instanceof e.SkinnedMesh&&O.skinning,C=T.customDepthMaterial?T.customDepthMaterial:O?C?o:s:C?i:r,N instanceof e.BufferGeometry?n.renderBufferDirect(x,p.__lights,null,C,N,T):n.renderBuffer(x,p.__lights,null,C,N,T));k=p.__webglObjectsImmediate,E=0;for(S=k.length;E<S;E++)N=k[E],T=N.object,T.visible&&T.castShadow&&(T._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,T.matrixWorld),n.renderImmediateObject(x,p.__lights,null,r,T))}y=n.getClearColor(),w=n.getClearAlpha(),t.clearColor(y.r,y.g,y.b,w),t.enable(t.BLEND),n.shadowMapCullFace===e.CullFaceFront&&t.cullFace(t.BACK)}},e.ShadowMapPlugin.__projector=new e.Projector,e.SpritePlugin=function(){function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var n,r,i,s,o,u,a,f,l,c;this.init=function(t){n=t.context,r=t,i=t.getPrecision(),s=new Float32Array(16),o=new Uint16Array(6),t=0,s[t++]=-1,s[t++]=-1,s[t++]=0,s[t++]=0,s[t++]=1,s[t++]=-1,s[t++]=1,s[t++]=0,s[t++]=1,s[t++]=1,s[t++]=1,s[t++]=1,s[t++]=-1,s[t++]=1,s[t++]=0,s[t++]=1,t=0,o[t++]=0,o[t++]=1,o[t++]=2,o[t++]=0,o[t++]=2,o[t++]=3,u=n.createBuffer(),a=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,s,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a),n.bufferData(n.ELEMENT_ARRAY_BUFFER,o,n.STATIC_DRAW);var t=e.ShaderSprite.sprite,p=n.createProgram(),v=n.createShader(n.FRAGMENT_SHADER),y=n.createShader(n.VERTEX_SHADER),w="precision "+i+" float;\n";n.shaderSource(v,w+t.fragmentShader),n.shaderSource(y,w+t.vertexShader),n.compileShader(v),n.compileShader(y),n.attachShader(p,v),n.attachShader(p,y),n.linkProgram(p),f=p,l={},c={},l.position=n.getAttribLocation(f,"position"),l.uv=n.getAttribLocation(f,"uv"),c.uvOffset=n.getUniformLocation(f,"uvOffset"),c.uvScale=n.getUniformLocation(f,"uvScale"),c.rotation=n.getUniformLocation(f,"rotation"),c.scale=n.getUniformLocation(f,"scale"),c.alignment=n.getUniformLocation(f,"alignment"),c.color=n.getUniformLocation(f,"color"),c.map=n.getUniformLocation(f,"map"),c.opacity=n.getUniformLocation(f,"opacity"),c.useScreenCoordinates=n.getUniformLocation(f,"useScreenCoordinates"),c.sizeAttenuation=n.getUniformLocation(f,"sizeAttenuation"),c.screenPosition=n.getUniformLocation(f,"screenPosition"),c.modelViewMatrix=n.getUniformLocation(f,"modelViewMatrix"),c.projectionMatrix=n.getUniformLocation(f,"projectionMatrix"),c.fogType=n.getUniformLocation(f,"fogType"),c.fogDensity=n.getUniformLocation(f,"fogDensity"),c.fogNear=n.getUniformLocation(f,"fogNear"),c.fogFar=n.getUniformLocation(f,"fogFar"),c.fogColor=n.getUniformLocation(f,"fogColor"),c.alphaTest=n.getUniformLocation(f,"alphaTest")},this.render=function(i,s,o,p){var d=i.__webglSprites,v=d.length;if(v){var y=l,w=c,E=p/o,o=.5*o,S=.5*p;n.useProgram(f),n.enableVertexAttribArray(y.position),n.enableVertexAttribArray(y.uv),n.disable(n.CULL_FACE),n.enable(n.BLEND),n.bindBuffer(n.ARRAY_BUFFER,u),n.vertexAttribPointer(y.position,2,n.FLOAT,!1,16,0),n.vertexAttribPointer(y.uv,2,n.FLOAT,!1,16,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a),n.uniformMatrix4fv(w.projectionMatrix,!1,s.projectionMatrix.elements),n.activeTexture(n.TEXTURE0),n.uniform1i(w.map,0);var x=y=0,T=i.fog;T?(n.uniform3f(w.fogColor,T.color.r,T.color.g,T.color.b),T instanceof e.Fog?(n.uniform1f(w.fogNear,T.near),n.uniform1f(w.fogFar,T.far),n.uniform1i(w.fogType,1),x=y=1):T instanceof e.FogExp2&&(n.uniform1f(w.fogDensity,T.density),n.uniform1i(w.fogType,2),x=y=2)):(n.uniform1i(w.fogType,0),x=y=0);for(var N,C,k=[],T=0;T<v;T++)N=d[T],C=N.material,N.visible&&0!==C.opacity&&(C.useScreenCoordinates?N.z=-N.position.z:(N._modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,N.matrixWorld),N.z=-N._modelViewMatrix.elements[14]));d.sort(t);for(T=0;T<v;T++)N=d[T],C=N.material,N.visible&&0!==C.opacity&&C.map&&C.map.image&&C.map.image.width&&(n.uniform1f(w.alphaTest,C.alphaTest),!0===C.useScreenCoordinates?(n.uniform1i(w.useScreenCoordinates,1),n.uniform3f(w.screenPosition,(N.position.x*r.devicePixelRatio-o)/o,(S-N.position.y*r.devicePixelRatio)/S,Math.max(0,Math.min(1,N.position.z))),k[0]=r.devicePixelRatio,k[1]=r.devicePixelRatio):(n.uniform1i(w.useScreenCoordinates,0),n.uniform1i(w.sizeAttenuation,C.sizeAttenuation?1:0),n.uniformMatrix4fv(w.modelViewMatrix,!1,N._modelViewMatrix.elements),k[0]=1,k[1]=1),s=i.fog&&C.fog?x:0,y!==s&&(n.uniform1i(w.fogType,s),y=s),s=1/(C.scaleByViewport?p:1),k[0]*=s*E*N.scale.x,k[1]*=s*N.scale.y,n.uniform2f(w.uvScale,C.uvScale.x,C.uvScale.y),n.uniform2f(w.uvOffset,C.uvOffset.x,C.uvOffset.y),n.uniform2f(w.alignment,C.alignment.x,C.alignment.y),n.uniform1f(w.opacity,C.opacity),n.uniform3f(w.color,C.color.r,C.color.g,C.color.b),n.uniform1f(w.rotation,N.rotation),n.uniform2fv(w.scale,k),r.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),r.setDepthTest(C.depthTest),r.setDepthWrite(C.depthWrite),r.setTexture(C.map,0),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0));n.enable(n.CULL_FACE)}}},e.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var t,n,r,i,s,o,u=new e.Frustum,a=new e.Matrix4;this.init=function(u){t=u.context,n=u;var u=e.ShaderLib.depthRGBA,a=e.UniformsUtils.clone(u.uniforms);r=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a}),i=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,morphTargets:!0}),s=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,skinning:!0}),o=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0,o._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(l,p){var v,m,y,w,E,S;t.clearColor(1,1,1,1),t.disable(t.BLEND),n.setDepthTest(!0),!0===l.autoUpdate&&l.updateMatrixWorld(),p.matrixWorldInverse.getInverse(p.matrixWorld),a.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),u.setFromMatrix(a),n.setRenderTarget(this.renderTarget),n.clear(),S=l.__webglObjects,v=0;for(m=S.length;v<m;v++)if(y=S[v],E=y.object,y.render=!1,E.visible&&(!(E instanceof e.Mesh||E instanceof e.ParticleSystem)||!E.frustumCulled||u.intersectsObject(E)))E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),y.render=!0;var x;v=0;for(m=S.length;v<m;v++)if(y=S[v],y.render&&(E=y.object,y=y.buffer,!(E instanceof e.ParticleSystem)||E.customDepthMaterial))(x=E.material instanceof e.MeshFaceMaterial?E.material.materials[0]:E.material)&&n.setMaterialFaces(E.material),w=0<E.geometry.morphTargets.length&&x.morphTargets,x=E instanceof e.SkinnedMesh&&x.skinning,w=E.customDepthMaterial?E.customDepthMaterial:x?w?o:s:w?i:r,y instanceof e.BufferGeometry?n.renderBufferDirect(p,l.__lights,null,w,y,E):n.renderBuffer(p,l.__lights,null,w,y,E);S=l.__webglObjectsImmediate,v=0;for(m=S.length;v<m;v++)y=S[v],E=y.object,E.visible&&(E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),n.renderImmediateObject(p,l.__lights,null,r,E));v=n.getClearColor(),m=n.getClearAlpha(),t.clearColor(v.r,v.g,v.b,m),t.enable(t.BLEND)}},e.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},e.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int sizeAttenuation;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"}},define("three",function(){});var t=t||function(){var e=[];return{REVISION:"10",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){t=e.indexOf(t),-1!==t&&e.splice(t,1)},update:function(t){if(0===e.length)return!1;for(var n=0,r=e.length,t=void 0!==t?t:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();n<r;)e[n].update(t)?n++:(e.splice(n,1),r--);return!0}}}();t.Tween=function(e){var n={},r={},i={},s=1e3,o=0,u=0,a=null,f=t.Easing.Linear.None,l=t.Interpolation.Linear,c=[],h=null,p=!1,d=null,v=null,m;for(m in e)n[m]=parseFloat(e[m],10);this.to=function(e,t){return void 0!==t&&(s=t),r=e,this},this.start=function(s){t.add(this),p=!1,a=void 0!==s?s:void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),a+=u;for(var o in r){if(r[o]instanceof Array){if(0===r[o].length)continue;r[o]=[e[o]].concat(r[o])}n[o]=e[o],0==n[o]instanceof Array&&(n[o]*=1),i[o]=n[o]||0}return this},this.stop=function(){return t.remove(this),this},this.delay=function(e){return u=e,this},this.repeat=function(e){return o=e,this},this.easing=function(e){return f=e,this},this.interpolation=function(e){return l=e,this},this.chain=function(){return c=arguments,this},this.onStart=function(e){return h=e,this},this.onUpdate=function(e){return d=e,this},this.onComplete=function(e){return v=e,this},this.update=function(t){if(t<a)return!0;!1===p&&(null!==h&&h.call(e),p=!0);var m=(t-a)/s,m=1<m?1:m,y=f(m),w;for(w in r){var E=n[w]||0,S=r[w];S instanceof Array?e[w]=l(S,y):("string"==typeof S&&(S=E+parseFloat(S,10)),e[w]=E+(S-E)*y)}null!==d&&d.call(e,y);if(1==m){if(!(0<o)){null!==v&&v.call(e),m=0;for(y=c.length;m<y;m++)c[m].start(t);return!1}isFinite(o)&&o--;for(w in i)"string"==typeof r[w]&&(i[w]+=parseFloat(r[w],10)),n[w]=i[w];a=t+u}return!0}},t.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return 1>(e*=2)?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:1>(e*=2)?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return 1>(e*=2)?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/.4)))},Out:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/.4)+1)},InOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),1>(e*=2)?-0.5*n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/.4):.5*n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/.4)+1)}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){return 1>(e*=2)?.5*e*e*(3.5949095*e-2.5949095):.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)}},Bounce:{In:function(e){return 1-t.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*t.Easing.Bounce.In(2*e):.5*t.Easing.Bounce.Out(2*e-1)+.5}}},t.Interpolation={Linear:function(e,n){var r=e.length-1,i=r*n,s=Math.floor(i),o=t.Interpolation.Utils.Linear;return 0>n?o(e[0],e[1],i):1<n?o(e[r],e[r-1],r-i):o(e[s],e[s+1>r?r:s+1],i-s)},Bezier:function(e,n){var r=0,i=e.length-1,s=Math.pow,o=t.Interpolation.Utils.Bernstein,u;for(u=0;u<=i;u++)r+=s(1-n,i-u)*s(n,u)*e[u]*o(i,u);return r},CatmullRom:function(e,n){var r=e.length-1,i=r*n,s=Math.floor(i),o=t.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(0>n&&(s=Math.floor(i=r*(1+n))),o(e[(s-1+r)%r],e[s],e[(s+1)%r],e[(s+2)%r],i-s)):0>n?e[0]-(o(e[0],e[0],e[1],e[1],-i)-e[0]):1<n?e[r]-(o(e[r],e[r],e[r-1],e[r-1],i-r)-e[r]):o(e[s?s-1:0],e[s],e[r<s+1?r:s+1],e[r<s+2?r:s+2],i-s)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,n){var r=t.Interpolation.Utils.Factorial;return r(e)/r(n)/r(e-n)},Factorial:function(){var e=[1];return function(t){var n=1,r;if(e[t])return e[t];for(r=t;1<r;r--)n*=r;return e[t]=n}}(),CatmullRom:function(e,t,n,r,i){var e=.5*(n-e),r=.5*(r-t),s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}}},define("tween",function(){}),e.EffectComposer=function(t,n){this.renderer=t;if(n===undefined){var r=window.innerWidth||1,i=window.innerHeight||1,s={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat,stencilBuffer:!1};n=new e.WebGLRenderTarget(r,i,s)}this.renderTarget1=n,this.renderTarget2=n.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],e.CopyShader===undefined&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new e.ShaderPass(e.CopyShader)},e.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(t){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var n=!1,r,i,s=this.passes.length;for(i=0;i<s;i++){r=this.passes[i];if(!r.enabled)continue;r.render(this.renderer,this.writeBuffer,this.readBuffer,t,n);if(r.needsSwap){if(n){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}r instanceof e.MaskPass?n=!0:r instanceof e.ClearMaskPass&&(n=!1)}},reset:function(e){e===undefined&&(e=this.renderTarget1.clone(),e.width=window.innerWidth,e.height=window.innerHeight),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){var n=this.renderTarget1.clone();n.width=e,n.height=t,this.reset(n)}},e.EffectComposer.camera=new e.OrthographicCamera(-1,1,1,-1,0,1),e.EffectComposer.quad=new e.Mesh(new e.PlaneGeometry(2,2),null),e.EffectComposer.scene=new e.Scene,e.EffectComposer.scene.add(e.EffectComposer.quad),define("postprocessing/EffectComposer",function(){}),e.RenderPass=function(t,n,r,i,s){this.scene=t,this.camera=n,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s!==undefined?s:1,this.oldClearColor=new e.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},e.RenderPass.prototype={render:function(e,t,n,r){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.render(this.scene,this.camera,n,this.clear),this.clearColor&&e.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}},define("postprocessing/RenderPass",function(){}),e.MaskPass=function(e,t){this.scene=e,this.camera=t,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},e.MaskPass.prototype={render:function(e,t,n,r){var i=e.context;i.colorMask(!1,!1,!1,!1),i.depthMask(!1);var s,o;this.inverse?(s=0,o=1):(s=1,o=0),i.enable(i.STENCIL_TEST),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),i.stencilFunc(i.ALWAYS,s,4294967295),i.clearStencil(o),e.render(this.scene,this.camera,n,this.clear),e.render(this.scene,this.camera,t,this.clear),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),i.stencilFunc(i.EQUAL,1,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}},e.ClearMaskPass=function(){this.enabled=!0},e.ClearMaskPass.prototype={render:function(e,t,n,r){var i=e.context;i.disable(i.STENCIL_TEST)}},define("postprocessing/MaskPass",function(){}),e.ShaderPass=function(t,n){this.textureID=n!==undefined?n:"tDiffuse",this.uniforms=e.UniformsUtils.clone(t.uniforms),this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1},e.ShaderPass.prototype={render:function(t,n,r,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r),e.EffectComposer.quad.material=this.material,this.renderToScreen?t.render(e.EffectComposer.scene,e.EffectComposer.camera):t.render(e.EffectComposer.scene,e.EffectComposer.camera,n,this.clear)}},define("postprocessing/ShaderPass",function(){}),e.SavePass=function(t){e.CopyShader===undefined&&console.error("THREE.SavePass relies on THREE.CopyShader");var n=e.CopyShader;this.textureID="tDiffuse",this.uniforms=e.UniformsUtils.clone(n.uniforms),this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.renderTarget=t,this.renderTarget===undefined&&(this.renderTargetParameters={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat,stencilBuffer:!1},this.renderTarget=new e.WebGLRenderTarget(window.innerWidth,window.innerHeight,this.renderTargetParameters)),this.enabled=!0,this.needsSwap=!1,this.clear=!1},e.SavePass.prototype={render:function(t,n,r,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r),e.EffectComposer.quad.material=this.material,t.render(e.EffectComposer.scene,e.EffectComposer.camera,this.renderTarget,this.clear)}},define("postprocessing/SavePass",function(){});var n=n||{};n.gui=n.gui||{},n.utils=n.utils||{},n.controllers=n.controllers||{},n.dom=n.dom||{},n.color=n.color||{},n.utils.css=function(){return{load:function(e,t){var t=t||document,n=t.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)}}}(),n.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(t[n])||(e[n]=t[n])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(e[n])&&(e[n]=t[n])},this),e},compose:function(){var e=t.call(arguments);return function(){for(var n=t.call(arguments),r=e.length-1;r>=0;r--)n=[e[r].apply(this,n)];return n[0]}},each:function(t,n,r){if(e&&t.forEach===e)t.forEach(n,r);else if(t.length===t.length+0){for(var i=0,s=t.length;i<s;i++)if(i in t&&n.call(r,t[i],i)===this.BREAK)break}else for(i in t)if(n.call(r,t[i],i)===this.BREAK)break},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"}}}(),n.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onFinishChange=this.__onChange=void 0};return e.extend(t.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),t}(n.utils.common),n.dom.dom=function(e){function t(t){return t==="0"||e.isUndefined(t)?0:(t=t.match(r),e.isNull(t)?0:parseFloat(t[1]))}var n={};e.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,r){e.each(t,function(e){n[e]=r})});var r=/(\d+(\.\d+)?)px/,i={makeSelectable:function(e,t){e!==void 0&&e.style!==void 0&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(t,n,r){e.isUndefined(n)&&(n=!0),e.isUndefined(r)&&(r=!0),t.style.position="absolute",n&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,r,i,s){var i=i||{},o=n[r];if(!o)throw Error("Event type "+r+" not supported.");var u=document.createEvent(o);switch(o){case"MouseEvents":u.initMouseEvent(r,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,i.x||i.clientX||0,i.y||i.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":o=u.initKeyboardEvent||u.initKeyEvent,e.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),o(r,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:u.initEvent(r,i.bubbles||!1,i.cancelable||!0)}e.defaults(u,s),t.dispatchEvent(u)},bind:function(e,t,n,r){return e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent&&e.attachEvent("on"+t,n),i},unbind:function(e,t,n,r){return e.removeEventListener?e.removeEventListener(t,n,r||!1):e.detachEvent&&e.detachEvent("on"+t,n),i},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);n.indexOf(t)==-1&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return i},removeClass:function(e,t){if(t){if(e.className!==void 0)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);r!=-1&&(n.splice(r,1),e.className=n.join(" "))}}else e.className=void 0;return i},hasClass:function(e,t){return RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){return e=getComputedStyle(e),t(e["border-left-width"])+t(e["border-right-width"])+t(e["padding-left"])+t(e["padding-right"])+t(e.width)},getHeight:function(e){return e=getComputedStyle(e),t(e["border-top-width"])+t(e["border-bottom-width"])+t(e["padding-top"])+t(e["padding-bottom"])+t(e.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return i}(n.utils.common),n.controllers.OptionController=function(e,t,n){var r=function(e,i,s){r.superclass.call(this,e,i);var o=this;this.__select=document.createElement("select");if(n.isArray(s)){var u={};n.each(s,function(e){u[e]=e}),s=u}n.each(s,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),o.__select.appendChild(n)}),this.updateDisplay(),t.bind(this.__select,"change",function(){o.setValue(this.options[this.selectedIndex].value)}),this.domElement.appendChild(this.__select)};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){return e=r.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e},updateDisplay:function(){return this.__select.value=this.getValue(),r.superclass.prototype.updateDisplay.call(this)}}),r}(n.controllers.Controller,n.dom.dom,n.utils.common),n.controllers.NumberController=function(e,t){var n=function(e,r,i){n.superclass.call(this,e,r),i=i||{},this.__min=i.min,this.__max=i.max,this.__step=i.step,e=this.__impliedStep=t.isUndefined(this.__step)?this.initialValue==0?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,e=e.toString(),this.__precision=e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0};return n.superclass=e,t.extend(n.prototype,e.prototype,{setValue:function(e){return this.__min!==void 0&&e<this.__min?e=this.__min:this.__max!==void 0&&e>this.__max&&(e=this.__max),this.__step!==void 0&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),n.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),n}(n.controllers.Controller,n.utils.common),n.controllers.NumberControllerBox=function(e,t,n){var r=function(e,i,s){function o(){var e=parseFloat(l.__input.value);n.isNaN(e)||l.setValue(e)}function u(e){var t=h-e.clientY;l.setValue(l.getValue()+t*l.__impliedStep),h=e.clientY}function f(){t.unbind(window,"mousemove",u),t.unbind(window,"mouseup",f)}this.__truncationSuspended=!1,r.superclass.call(this,e,i,s);var l=this,h;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"change",o),t.bind(this.__input,"blur",function(){o(),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}),t.bind(this.__input,"mousedown",function(e){t.bind(window,"mousemove",u),t.bind(window,"mouseup",f),h=e.clientY}),t.bind(this.__input,"keydown",function(e){e.keyCode===13&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){var e=this.__input,t;if(this.__truncationSuspended)t=this.getValue();else{t=this.getValue();var n=Math.pow(10,this.__precision);t=Math.round(t*n)/n}return e.value=t,r.superclass.prototype.updateDisplay.call(this)}}),r}(n.controllers.NumberController,n.dom.dom,n.utils.common),n.controllers.NumberControllerSlider=function(e,t,n,r,i){var s=function(e,n,r,i,o){function u(e){e.preventDefault();var n=t.getOffset(l.__background),r=t.getWidth(l.__background);return l.setValue(l.__min+(l.__max-l.__min)*((e.clientX-n.left)/(n.left+r-n.left))),!1}function f(){t.unbind(window,"mousemove",u),t.unbind(window,"mouseup",f),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}s.superclass.call(this,e,n,{min:r,max:i,step:o});var l=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),t.bind(this.__background,"mousedown",function(e){t.bind(window,"mousemove",u),t.bind(window,"mouseup",f),u(e)}),t.addClass(this.__background,"slider"),t.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return s.superclass=e,s.useDefaultStyles=function(){n.inject(i)},r.extend(s.prototype,e.prototype,{updateDisplay:function(){return this.__foreground.style.width=(this.getValue()-this.__min)/(this.__max-this.__min)*100+"%",s.superclass.prototype.updateDisplay.call(this)}}),s}(n.controllers.NumberController,n.dom.dom,n.utils.css,n.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),n.controllers.FunctionController=function(e,t,n){var r=function(e,n,i){r.superclass.call(this,e,n);var s=this;this.__button=document.createElement("div"),this.__button.innerHTML=i===void 0?"Fire":i,t.bind(this.__button,"click",function(e){return e.preventDefault(),s.fire(),!1}),t.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return r.superclass=e,n.extend(r.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),r}(n.controllers.Controller,n.dom.dom,n.utils.common),n.controllers.BooleanController=function(e,t,n){var r=function(e,n){r.superclass.call(this,e,n);var i=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),t.bind(this.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return r.superclass=e,n.extend(r.prototype,e.prototype,{setValue:function(e){return e=r.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,r.superclass.prototype.updateDisplay.call(this)}}),r}(n.controllers.Controller,n.dom.dom,n.utils.common),n.color.toString=function(e){return function(t){if(t.a==1||e.isUndefined(t.a)){for(t=t.hex.toString(16);t.length<6;)t="0"+t;return"#"+t}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(n.utils.common),n.color.interpret=function(e,t){var n,r,i=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){return e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i),e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){return e=e.match(/^#([A-F0-9]{6})$/i),e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:e},CSS_RGB:{read:function(e){return e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/),e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:e},CSS_RGBA:{read:function(e){return e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/),e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!=3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!=4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return function(){r=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(i,function(i){if(i.litmus(e))return t.each(i.conversions,function(i,s){n=i.read(e);if(r===!1&&n!==!1)return r=n,n.conversionName=s,n.conversion=i,t.BREAK}),t.BREAK}),r}}(n.color.toString,n.utils.common),n.GUI=n.gui.GUI=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function v(e,t,n,s){if(t[n]===void 0)throw Error("Object "+t+' has no property "'+n+'"');s.color?t=new l(t,n):(t=[t,n].concat(s.factoryArgs),t=r.apply(e,t)),s.before instanceof i&&(s.before=s.before.__li),y(e,t),p.addClass(t.domElement,"c"),n=document.createElement("span"),p.addClass(n,"property-name"),n.innerHTML=t.property;var o=document.createElement("div");return o.appendChild(n),o.appendChild(t.domElement),s=m(e,o,s.before),p.addClass(s,P.CLASS_CONTROLLER_ROW),p.addClass(s,typeof t.getValue()),g(e,s,t),e.__controllers.push(t),t}function m(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,params.before):e.__ul.appendChild(r),e.onResize(),r}function g(e,t,n){n.__li=t,n.__gui=e,d.extend(n,{options:function(t){if(arguments.length>1)return n.remove(),v(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[d.toArray(arguments)]});if(d.isArray(t)||d.isObject(t))return n.remove(),v(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[t]})},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}});if(n instanceof a){var r=new u(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});d.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(n,e),i.apply(r,e)}}),p.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof u){var i=function(t){return d.isNumber(n.__min)&&d.isNumber(n.__max)?(n.remove(),v(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})):t};n.min=d.compose(i,n.min),n.max=d.compose(i,n.max)}else n instanceof s?(p.bind(t,"click",function(){p.fakeEvent(n.__checkbox,"click")}),p.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof o?(p.bind(t,"click",function(){p.fakeEvent(n.__button,"click")}),p.bind(t,"mouseover",function(){p.addClass(n.__button,"hover")}),p.bind(t,"mouseout",function(){p.removeClass(n.__button,"hover")})):n instanceof l&&(p.addClass(t,"color"),n.updateDisplay=d.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=d.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&T(e.getRoot(),!0),t},n.setValue)}function y(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(r!=-1){var i=n.__rememberedObjectIndecesToControllers[r];i===void 0&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t;if(n.load&&n.load.remembered){n=n.load.remembered;if(n[e.preset])n=n[e.preset];else{if(!n[C])return;n=n[C]}n[r]&&n[r][t.property]!==void 0&&(r=n[r][t.property],t.initialValue=r,t.setValue(r))}}}function b(e){var t=e.__save_row=document.createElement("li");p.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),p.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",p.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",p.addClass(r,"button"),p.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",p.addClass(i,"button"),p.addClass(i,"save-as");var s=document.createElement("span");s.innerHTML="Revert",p.addClass(s,"button"),p.addClass(s,"revert");var o=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?d.each(e.load.remembered,function(t,n){x(e,n,n==e.preset)}):x(e,C,!1),p.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(o),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(s);if(k){var t=document.getElementById("dg-save-locally"),u=document.getElementById("dg-local-explain");t.style.display="block",t=document.getElementById("dg-local-storage"),localStorage.getItem(document.location.href+".isLocal")==="true"&&t.setAttribute("checked","checked");var a=function(){u.style.display=e.useLocalStorage?"block":"none"};a(),p.bind(t,"change",function(){e.useLocalStorage=!e.useLocalStorage,a()})}var f=document.getElementById("dg-new-constructor");p.bind(f,"keydown",function(e){e.metaKey&&(e.which===67||e.keyCode==67)&&A.hide()}),p.bind(n,"click",function(){f.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),A.show(),f.focus(),f.select()}),p.bind(r,"click",function(){e.save()}),p.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),p.bind(s,"click",function(){e.revert()})}function w(e){function t(t){return t.preventDefault(),i=t.clientX,p.addClass(e.__closeButton,P.CLASS_DRAG),p.bind(window,"mousemove",n),p.bind(window,"mouseup",r),!1}function n(t){return t.preventDefault(),e.width+=i-t.clientX,e.onResize(),i=t.clientX,!1}function r(){p.removeClass(e.__closeButton,P.CLASS_DRAG),p.unbind(window,"mousemove",n),p.unbind(window,"mouseup",r)}e.__resize_handle=document.createElement("div"),d.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var i;p.bind(e.__resize_handle,"mousedown",t),p.bind(e.__closeButton,"mousedown",t),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function E(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function S(e,t){var n={};return d.each(e.__rememberedObjects,function(r,i){var s={};d.each(e.__rememberedObjectIndecesToControllers[i],function(e,n){s[n]=t?e.initialValue:e.getValue()}),n[i]=s}),n}function x(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function T(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function N(e){e.length!=0&&c(function(){N(e)}),d.each(e,function(e){e.updateDisplay()})}e.inject(n);var C="Default",k;try{k="localStorage"in window&&window.localStorage!==null}catch(L){k=!1}var A,O=!0,M,_=!1,D=[],P=function(e){function t(){localStorage.setItem(document.location.href+".gui",JSON.stringify(r.getSaveObject()))}function n(){var e=r.getRoot();e.width+=1,d.defer(function(){e.width-=1})}var r=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),p.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=d.defaults(e,{autoPlace:!0,width:P.DEFAULT_WIDTH}),e=d.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),d.isUndefined(e.load)?e.load={preset:C}:e.preset&&(e.load.preset=e.preset),d.isUndefined(e.parent)&&e.hideable&&D.push(this),e.resizable=d.isUndefined(e.parent)&&e.resizable,e.autoPlace&&d.isUndefined(e.scrollable)&&(e.scrollable=!0);var i=k&&localStorage.getItem(document.location.href+".isLocal")==="true";Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return r.parent?r.getRoot().preset:e.load.preset},set:function(t){r.parent?r.getRoot().preset=t:e.load.preset=t;for(t=0;t<this.__preset_select.length;t++)this.__preset_select[t].value==this.preset&&(this.__preset_select.selectedIndex=t);r.revert()}},width:{get:function(){return e.width},set:function(t){e.width=t,E(r,t)}},name:{get:function(){return e.name},set:function(t){e.name=t,o&&(o.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(t){e.closed=t,e.closed?p.addClass(r.__ul,P.CLASS_CLOSED):p.removeClass(r.__ul,P.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=t?P.TEXT_OPEN:P.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return i},set:function(e){k&&((i=e)?p.bind(window,"unload",t):p.unbind(window,"unload",t),localStorage.setItem(document.location.href+".isLocal",e))}}});if(d.isUndefined(e.parent)){e.closed=!1,p.addClass(this.domElement,P.CLASS_MAIN),p.makeSelectable(this.domElement,!1);if(k&&i){r.useLocalStorage=!0;var s=localStorage.getItem(document.location.href+".gui");s&&(e.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=P.TEXT_CLOSED,p.addClass(this.__closeButton,P.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),p.bind(this.__closeButton,"click",function(){r.closed=!r.closed})}else{e.closed===void 0&&(e.closed=!0);var o=document.createTextNode(e.name);p.addClass(o,"controller-name"),s=m(r,o),p.addClass(this.__ul,P.CLASS_CLOSED),p.addClass(s,"title"),p.bind(s,"click",function(e){return e.preventDefault(),r.closed=!r.closed,!1}),e.closed||(this.closed=!1)}e.autoPlace&&(d.isUndefined(e.parent)&&(O&&(M=document.createElement("div"),p.addClass(M,"dg"),p.addClass(M,P.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(M),O=!1),M.appendChild(this.domElement),p.addClass(this.domElement,P.CLASS_AUTO_PLACE)),this.parent||E(r,e.width)),p.bind(window,"resize",function(){r.onResize()}),p.bind(this.__ul,"webkitTransitionEnd",function(){r.onResize()}),p.bind(this.__ul,"transitionend",function(){r.onResize()}),p.bind(this.__ul,"oTransitionEnd",function(){r.onResize()}),this.onResize(),e.resizable&&w(this),r.getRoot(),e.parent||n()};return P.toggleHide=function(){_=!_,d.each(D,function(e){e.domElement.style.zIndex=_?-999:999,e.domElement.style.opacity=_?0:1})},P.CLASS_AUTO_PLACE="a",P.CLASS_AUTO_PLACE_CONTAINER="ac",P.CLASS_MAIN="main",P.CLASS_CONTROLLER_ROW="cr",P.CLASS_TOO_TALL="taller-than-window",P.CLASS_CLOSED="closed",P.CLASS_CLOSE_BUTTON="close-button",P.CLASS_DRAG="drag",P.DEFAULT_WIDTH=245,P.TEXT_CLOSED="Close Controls",P.TEXT_OPEN="Open Controls",p.bind(window,"keydown",function(e){document.activeElement.type!=="text"&&(e.which===72||e.keyCode==72)&&P.toggleHide()},!1),d.extend(P.prototype,{add:function(e,t){return v(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return v(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;d.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&M.removeChild(this.domElement)},addFolder:function(e){if(this.__folders[e]!==void 0)throw Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};return t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]),t=new P(t),this.__folders[e]=t,e=m(this,t.domElement),p.addClass(e,"folder"),t},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=p.getOffset(e.__ul).top,n=0;d.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=p.getHeight(t))}),window.innerHeight-t-20<n?(p.addClass(e.domElement,P.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(p.removeClass(e.domElement,P.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&d.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){d.isUndefined(A)&&(A=new h,A.domElement.innerHTML=t);if(this.parent)throw Error("You can only call remember on a top level GUI.");var e=this;d.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length==0&&b(e),e.__rememberedObjects.indexOf(t)==-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&E(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=S(this)),e.folders={},d.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=S(this),T(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[C]=S(this,!0)),this.load.remembered[e]=S(this),this.preset=e,x(this,e,!0)},revert:function(e){d.each(this.__controllers,function(t){this.getRoot().load.remembered?y(e||this.getRoot(),t):t.setValue(t.initialValue)},this),d.each(this.__folders,function(e){e.revert(e)}),e||T(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length==0;this.__listening.push(e),t&&N(this.__listening)}}),P}(n.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",n.controllers.factory=function(e,t,n,r,i,s,o){return function(u,l,h,p){var v=u[l];if(o.isArray(h)||o.isObject(h))return new e(u,l,h);if(o.isNumber(v))return o.isNumber(h)&&o.isNumber(p)?new n(u,l,h,p):new t(u,l,{min:h,max:p});if(o.isString(v))return new r(u,l);if(o.isFunction(v))return new i(u,l,"");if(o.isBoolean(v))return new s(u,l)}}(n.controllers.OptionController,n.controllers.NumberControllerBox,n.controllers.NumberControllerSlider,n.controllers.StringController=function(e,t,n){var r=function(e,n){function i(){s.setValue(s.__input.value)}r.superclass.call(this,e,n);var s=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"keyup",i),t.bind(this.__input,"change",i),t.bind(this.__input,"blur",function(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}),t.bind(this.__input,"keydown",function(e){e.keyCode===13&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){return t.isActive(this.__input)||(this.__input.value=this.getValue()),r.superclass.prototype.updateDisplay.call(this)}}),r}(n.controllers.Controller,n.dom.dom,n.utils.common),n.controllers.FunctionController,n.controllers.BooleanController,n.utils.common),n.controllers.Controller,n.controllers.BooleanController,n.controllers.FunctionController,n.controllers.NumberControllerBox,n.controllers.NumberControllerSlider,n.controllers.OptionController,n.controllers.ColorController=function(e,t,n,r,i){function s(e,t,n,r){e.style.background="",i.each(a,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}function o(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var u=function(e,a){function l(e){g(e),t.bind(window,"mousemove",g),t.bind(window,"mouseup",p)}function p(){t.unbind(window,"mousemove",g),t.unbind(window,"mouseup",p)}function v(){var e=r(this.value);e!==!1?(w.__color.__state=e,w.setValue(w.__color.toOriginal())):this.value=w.__color.toString()}function m(){t.unbind(window,"mousemove",y),t.unbind(window,"mouseup",m)}function g(e){e.preventDefault();var n=t.getWidth(w.__saturation_field),r=t.getOffset(w.__saturation_field),i=(e.clientX-r.left+document.body.scrollLeft)/n,e=1-(e.clientY-r.top+document.body.scrollTop)/n;return e>1?e=1:e<0&&(e=0),i>1?i=1:i<0&&(i=0),w.__color.v=e,w.__color.s=i,w.setValue(w.__color.toOriginal()),!1}function y(e){e.preventDefault();var n=t.getHeight(w.__hue_field),r=t.getOffset(w.__hue_field),e=1-(e.clientY-r.top+document.body.scrollTop)/n;return e>1?e=1:e<0&&(e=0),w.__color.h=e*360,w.setValue(w.__color.toOriginal()),!1}u.superclass.call(this,e,a),this.__color=new n(this.getValue()),this.__temp=new n(0);var w=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){e.keyCode===13&&v.call(this)}),t.bind(this.__input,"blur",v),t.bind(this.__selector,"mousedown",function(){t.addClass(this,"drag").bind(window,"mouseup",function(){t.removeClass(w.__selector,"drag")})});var E=document.createElement("div");i.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(E.style,{width:"100%",height:"100%",background:"none"}),s(E,"top","rgba(0,0,0,0)","#000"),i.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),o(this.__hue_field),i.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",l),t.bind(this.__field_knob,"mousedown",l),t.bind(this.__hue_field,"mousedown",function(e){y(e),t.bind(window,"mousemove",y),t.bind(window,"mouseup",m)}),this.__saturation_field.appendChild(E),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};u.superclass=e,i.extend(u.prototype,e.prototype,{updateDisplay:function(){var e=r(this.getValue());if(e!==!1){var t=!1;i.each(n.COMPONENTS,function(n){if(!i.isUndefined(e[n])&&!i.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&i.extend(this.__color.__state,e)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,u=255-o;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,s(this.__saturation_field,"left","#fff",this.__temp.toString()),i.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+u+","+u+","+u+",.7)"})}});var a=["-moz-","-o-","-webkit-","-ms-",""];return u}(n.controllers.Controller,n.dom.dom,n.color.Color=function(e,t,n,r){function i(e,t,n){Object.defineProperty(e,t,{get:function(){return this.__state.space==="RGB"?this.__state[t]:(o(this,t,n),this.__state[t])},set:function(e){this.__state.space!=="RGB"&&(o(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function s(e,t){Object.defineProperty(e,t,{get:function(){return this.__state.space==="HSV"?this.__state[t]:(u(this),this.__state[t])},set:function(e){this.__state.space!=="HSV"&&(u(this),this.__state.space="HSV"),this.__state[t]=e}})}function o(e,n,i){if(e.__state.space==="HEX")e.__state[n]=t.component_from_hex(e.__state.hex,i);else{if(e.__state.space!=="HSV")throw"Corrupted color state";r.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function u(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);r.extend(e.__state,{s:n.s,v:n.v}),r.isNaN(n.h)?r.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var a=function(){this.__state=e.apply(this,arguments);if(this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return a.COMPONENTS="r,g,b,h,s,v,hex,a".split(","),r.extend(a.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),i(a.prototype,"r",2),i(a.prototype,"g",1),i(a.prototype,"b",0),s(a.prototype,"h"),s(a.prototype,"s"),s(a.prototype,"v"),Object.defineProperty(a.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(a.prototype,"hex",{get:function(){return!this.__state.space!=="HEX"&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),a}(n.color.interpret,n.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var r=e/60-Math.floor(e/60),i=n*(1-t),s=n*(1-r*t),t=n*(1-(1-r)*t),e=[[n,t,i],[s,n,i],[i,n,t],[i,s,n],[t,i,n],[n,i,s]][Math.floor(e/60)%6];return{r:e[0]*255,g:e[1]*255,b:e[2]*255}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),r=i-r;return i==0?{h:NaN,s:0,v:0}:(e=e==i?(t-n)/r:t==i?2+(n-e)/r:4+(e-t)/r,e/=6,e<0&&(e+=1),{h:e*360,s:r/i,v:i/255})},rgb_to_hex:function(e,t,n){return e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t),e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(t,n,r){return r<<(e=n*8)|t&~(255<<e)}}}(),n.color.toString,n.utils.common),n.color.interpret,n.utils.common),n.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),n.dom.CenteredDiv=function(e,t){var n=function(){this.backgroundElement=document.createElement("div"),t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};return n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),t.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},n.prototype.hide=function(){var t=this,n=function(){t.domElement.style.display="none",t.backgroundElement.style.display="none",e.unbind(t.domElement,"webkitTransitionEnd",n),e.unbind(t.domElement,"transitionend",n),e.unbind(t.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n),e.bind(this.domElement,"transitionend",n),e.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},n}(n.dom.dom,n.utils.common),n.dom.dom,n.utils.common),define("dat.gui",function(){}),define("image",[],function(){function r(){}function i(n){return n=n.replace(t,""),n+=n.indexOf("?")<0?"?":"&",n+e+"="+Math.round(2147483647*Math.random())}var e="bust",t="!bust",n="!rel";return{load:function(e,t,i,s){var o;s.isBuild?i(null):(o=new Image,o.onerror=function(e){i.error(e)},o.onload=function(e){i(o);try{delete o.onload}catch(t){o.onload=r}},e.indexOf(n)!==-1?o.src=t.toUrl(e.replace(n,"")):o.src=e)},normalize:function(e,n){return e.indexOf(t)===-1?e:i(e)}}}),define("landscape",["image!img/sand.jpg"],function(t){var n,r,i,s=Math.PI*2,o={init:function(n){var r,i,o,u=4e4,a=40;r=new e.PlaneGeometry(u,u,a-1,a-1);for(var f,l,c,h=0;c=r.vertices[h];h++)f=h%a/a*2-1,l=~~(h/a)/a*2-1,c.z=(Math.cos(f*s)+Math.cos(l*s))*-400;var p=new e.Texture(t);p.magFilter=e.LinearMipMapLinearFilter,p.minFilter=e.LinearMipMapNearestFilter,p.wrapS=p.wrapT=e.RepeatWrapping,p.repeat.set(10,10),p.needsUpdate=!0,i=new e.MeshPhongMaterial({color:16777215,map:p}),r.computeFaceNormals(),r.computeVertexNormals(),r.computeTangents(),o=new e.Mesh(r,i),o.position.y=-500,o.rotation.x=-Math.PI/2,n.add(o)}};return o}),define("water",["image!img/water.jpg"],function(t){var n,r,i,s,o=128,u=128,a=o/2,f=u/2,l={roughness:35,height:-1e3},c={init:function(a,f){i=new e.PlaneGeometry(2e4,2e4,o-1,u-1),i.applyMatrix((new e.Matrix4).makeRotationX(-Math.PI/2)),i.dynamic=!0;var c,h,p,d;for(c=0,p=i.vertices.length;c<p;c++)i.vertices[c].y=l.roughness*Math.sin(c/2);i.computeFaceNormals(),i.computeVertexNormals(),r=new e.Texture(t),r.wrapS=r.wrapT=e.RepeatWrapping,r.repeat.set(5,5),r.needsUpdate=!0,s=new e.MeshBasicMaterial({color:17663,map:r}),n=new e.Mesh(i,s),a.add(n);var v=f.addFolder("water");f.remember(l),v.add(l,"roughness",0,60),v.add(l,"height",-1400,100)},render:function(e,t){for(var s=0,o=i.vertices.length;s<o;s++)i.vertices[s].y=l.roughness*Math.sin(s/5+(t*10+s)/7);var u=t%100/100;r.offset.set(u,u),n.geometry.verticesNeedUpdate=!0,n.position.y=l.height}};return c}),define("clouds",["image!img/cloud.png"],function(t,n,r){var i,s={scale:1,height:500,windspeed:.1,dispersion:1},o={init:function(n,r){var o=800;i=new e.Object3D;var u=new e.Texture(t);u.magFilter=e.LinearMipMapLinearFilter,u.minFilter=e.LinearMipMapNearestFilter,u.needsUpdate=!0;var a=new e.SpriteMaterial({map:u,useScreenCoordinates:!1,color:16777215});for(var f=0;f<o;f++){var l=Math.random()-.5,c=(Math.random()-.5)*.001,h=Math.random()-.5,p=new e.Sprite(a);p.position.set(l,c,h),p.rotation.z=Math.random()*Math.PI,p.__scale=Math.random()*Math.random()*2.5+.5,p.position.multiplyScalar(5e3),i.add(p)}n.add(i);var d=r.addFolder("clouds");r.remember(s),d.add(s,"scale",0,4),d.add(s,"dispersion",0,5),d.add(s,"windspeed",0,300),d.add(s,"height",0,1500)},render:function(e){for(var t=0;t<i.children.length;t++){var n=i.children[t],r=n.material,o=1,u=1;r.map&&r.map.image&&r.map.image.width&&(o=r.map.image.width,u=r.map.image.height),n.rotation+=.001*(t/i.children.length),n.scale.set(n.__scale*s.scale*o,n.__scale*s.scale*u,1)}i.position.y=s.height,i.scale.set(s.dispersion,s.dispersion,s.dispersion),i.rotation.y+=e*(s.windspeed/1e3)}};return o}),e.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},define("shaders/CopyShader",function(){}),e.BlendShader={uniforms:{tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},mixRatio:{type:"f",value:.5},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},define("shaders/BlendShader",function(){}),e.EdgeShader={uniforms:{tDiffuse:{type:"t",value:null},aspect:{type:"v2",value:new e.Vector2(512,512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n")},define("shaders/EdgeShader",function(){}),e.VignetteShader={uniforms:{tDiffuse:{type:"t",value:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},define("shaders/VignetteShader",function(){}),e.SepiaShader={uniforms:{tDiffuse:{type:"t",value:null},amount:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},define("shaders/SepiaShader",function(){}),define("fxstuff",["shaders/CopyShader","shaders/BlendShader","shaders/EdgeShader","shaders/VignetteShader","shaders/SepiaShader"],function(){function i(e){r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,t.setSize(window.innerWidth,window.innerHeight),n.setSize(window.innerWidth,window.innerHeight)}function s(e,t){var n=t.addFolder("Effects"),r=n.addFolder("Edge"),i={enabled:!0,savePass:e.savePass,edgeEffect:e.edgeEffect,blend:e.blend};t.remember(i),t.remember(i.blend.uniforms.mixRatio),t.remember(i.blend.uniforms.opacity),r.add(i,"enabled").onFinishChange(function(e){i.savePass.enabled=e,i.edgeEffect.enabled=e,i.blend.enabled=e}),r.add(i.blend.uniforms.mixRatio,"value",-1,1).step(.1).name("mixratio"),r.add(i.blend.uniforms.opacity,"value",0,1).step(.1).name("opacity"),t.remember(e.vignette),t.remember(e.vignette.uniforms.offset),t.remember(e.vignette.uniforms.darkness);var s=n.addFolder("Vignette");s.add(e.vignette,"enabled"),s.add(e.vignette.uniforms.offset,"value",0,100).step(.25).name("offset"),s.add(e.vignette.uniforms.darkness,"value",0,1).step(.1).name("darkness"),t.remember(e.sepia),t.remember(e.sepia.uniforms.amount);var o=n.addFolder("Sepia");o.add(e.sepia,"enabled").name("Sepia"),o.add(e.sepia.uniforms.amount,"value",-1,1).step(.1).name("amount")}function o(o,u,a,f){r=a,t=new e.WebGLRenderer({antialias:!1}),t.setSize(window.innerWidth,window.innerHeight),t.setClearColor("#48b",1);var l={};l.savePass=new e.SavePass,l.edgeEffect=new e.ShaderPass(e.EdgeShader),l.edgeEffect.uniforms.aspect.value.x=window.innerWidth,l.edgeEffect.uniforms.aspect.value.y=window.innerHeight,l.blend=new e.ShaderPass(e.BlendShader,"tDiffuse1"),l.blend.uniforms.tDiffuse2.value=l.savePass.renderTarget,l.blend.uniforms.mixRatio.value=.85,l.vignette=new e.ShaderPass(e.VignetteShader),l.vignette.uniforms.offset.value.x=1,l.vignette.uniforms.darkness.value.x=1,l.sepia=new e.ShaderPass(e.SepiaShader),l.sepia.uniforms.amount.value.x=1,l.final=new e.ShaderPass(e.CopyShader),l.final.renderToScreen=!0,n=new e.EffectComposer(t),n.addPass(new e.RenderPass(u,r)),n.addPass(l.savePass),n.addPass(l.edgeEffect),n.addPass(l.blend),n.addPass(l.sepia),n.addPass(l.vignette),n.addPass(l.final),s(l,f),$(o).append(t.domElement),$(window).on("resize",i)}var t,n,r,u={render:function(){n.render()},initEffects:o};return u}),define("tweenstuff",[],function(){function u(e,n,r,i,s,o){var u=function(){$.each(e,function(e,t){typeof r[e]!="boolean"&&(r[e]=t)})},a=(new t.Tween(e)).to(n,i.duration*1e3).easing(s).onUpdate(u).onComplete(o);a.start()}function a(n){function l(){f||(f=!0,r=!1,$(e.__preset_select).val(n.to),e.preset=n.to)}var i=e.load.remembered,s=$.extend(!0,{},i[n.from]),o=$.extend(!0,{},i[n.to]);$(e.__preset_select).val(n.from),e.preset=n.from,t.removeAll();var a=t.Easing[n.easing.split(".")[0]][n.easing.split(".")[1]];a=typeof a=="undefined"?t.Easing.Linear.None:a;var f=!1;for(var c in s){var h=s[c],p=o[c];if(p){var d=e.__rememberedObjects[c];u(h,p,d,n,a,l)}}}function f(t){var r=n.addFolder(t.name),s=t.name;r.add(t,"name").onFinishChange(function(e){f(t),delete n.__folders[s],$(r.domElement).remove(),delete r,s=e}),r.add(t,"from",Object.keys(e.load.remembered)),r.add(t,"to",Object.keys(e.load.remembered)),r.add(t,"easing",o),r.add(t,"duration",0,120).step(.01),r.add(t,"start"),r.add({"delete":function(){var e=confirm("Are you sure you want to delete this transition?");e==1&&(i.splice(i.indexOf(t),1),delete n.__folders[t.name],$(r.domElement).remove(),delete r)}},"delete")}function l(e){var t={name:"new transition",from:"Default",to:"Default",easing:"Linear",duration:2,start:function(){a(t)}};$.extend(t,e),f(t),i.push(t)}function c(t,r){n=t,e=r,n.add({add:l},"add").name("Add a transition");for(var i in s)l(s[i])}var e,n,r,i=[],s=typeof localStorage.Tweenz=="undefined"?[]:JSON.parse(localStorage.Tweenz),o={};Object.keys(t.Easing).forEach(function(e){Object.keys(t.Easing[e]).forEach(function(t){var n=e+"."+t;o[n]=n})});var h={initTweenz:c,Tweenz:i,save:function(){localStorage.Tweenz=JSON.stringify(i)},queNext:function(){if(!r){r=!0;var e=$("#quequeList").find(".quequed");e.length==0?$("#quequeList").find("li:first").find(".playBtn").click():e.removeClass("quequed").next().addClass(".quequed").find(".playBtn").click()}}};return h}),define("scene",["landscape","water","clouds","fxstuff","tweenstuff"],function(r,i,s,o,u){function w(e,t){e.add(t,"x").listen().__precision=5,e.add(t,"y").listen().__precision=5,e.add(t,"z").listen().__precision=5}function E(e){var t=$("<canvas/>")[0];t.width=32,t.height=window.innerHeight;var n=t.getContext("2d"),r=n.createLinearGradient(0,0,0,t.height);r.addColorStop(0,"#126"),r.addColorStop(.9,"#48b"),n.fillStyle=r,n.fillRect(0,0,t.width,t.height),e.style.background="url("+t.toDataURL("image/png")+")",e.style.backgroundSize="32px 100%"}function S(){a=new e.PerspectiveCamera(30,window.innerWidth/window.innerHeight,1,1e5),a.position.z=8e3,a.lookAt(y),l.remember(a.position),l.remember(a.rotation);var t=l.addFolder("camera");w(t,a.position),w(t,a.rotation),f=new e.Scene;var n=new e.DirectionalLight({color:"#ffae23"});n.position.set(1e3,1e3,0),n.lookAt(y),n.rotation.z=Math.PI/2;var o=l.addFolder("light");l.remember(n),o.add(n,"intensity",0,2),f.add(n),r.init(f,l),i.init(f,l),s.init(f,l)}function x(){function i(){r=[],$.each(u.Tweenz,function(e,t){r.push(t.name)})}if(typeof localStorage===undefined)return console.log("Sorry, localStorage only.");var e=typeof localStorage.mainGUI=="undefined"?{preset:"Default",remembered:{Default:{}}}:JSON.parse(localStorage.mainGUI);l=mg=new n.GUI({name:"mainGUI",load:e}),c=new n.GUI({name:"transitionGUI"});var t={reset:function(){var e=confirm("Are you sure? <b>RESET</b> Everything?");if(e==1){var e=confirm("... Everything? ...\n ... Really?");e==1&&localStorage.clear()}},save:function(){var e=confirm("Overwrite old save?");e==1&&(localStorage.mainGUI=JSON.stringify(l.getSaveObject()),u.save(),a.save())}};c.add(t,"reset").name("Reset it all"),c.add(t,"save").name("Save it all"),h=c.addFolder("Transitions");var r=[],s=c.addFolder("Que"),o=$('<ul id="quequeList">').sortable(),a={addQueItem:function(e){var t=$("<li>"),n=$("<select>"),s=$("<button>").html(">").addClass("playBtn");s.click(function(){o.find("li").removeClass("quequed"),t.addClass("quequed"),$(u.Tweenz).each(function(e,t){t.name==n.val()&&t.start()})}),t.append(s),t.append(n),i();for(var a in r)n.append("<option>"+r[a]+"</option>");n.val(e);var f=$("<button>").html("X");f.click(function(){t.remove()}),t.append(f),o.append(t)},save:function(){var e=[];o.find("select").each(function(t,n){e.push(n.value)}),localStorage.Ques=JSON.stringify(e)}};return s.add(a,"addQueItem").name("Add Que Item"),$(s.__ul).append(o),function(){var e=typeof localStorage.Ques=="undefined"?[]:JSON.parse(localStorage.Ques);for(var t in e)a.addQueItem(e[t])}}function T(){var e=x(),t=$("<div/>")[0];$("body").append(t),E(t),S(),o.initEffects(t,f,a,l),u.initTweenz(h,l),e(),$(t).on("mousemove",O),$(t).on("mousedown",C),$(t).on("mouseup",k),$(t).on("contextmenu",function(e){e.preventDefault(),e.stopPropagation()}),$(document).on("keydown",L),$(document).on("keyup",A),P()}function C(e){N=!0,e.preventDefault(),e.stopPropagation()}function k(e){N=!1,e.preventDefault(),e.stopPropagation()}function L(e){b[e.keyCode]=!0}function A(e){b[e.keyCode]=!1}function O(e){p=(e.clientX-m)/m,d=-(e.clientY-g)/g}function _(t){var n=new e.Vector3,r=b[M.fine];n.x=b[M.left]?1:b[M.right]?-1:0,n.y=b[M.up]?1:b[M.down]?-1:0,n.z=b[M.forward]?1:b[M.backward]?-1:0,n.applyEuler(a.rotation),a.position.add(n.multiplyScalar((r?100:1e3)*t)),b[M.que]&&u.queNext();var i=new e.Vector3(0,0,-1);i.y=N?d/(r?1e3:100):0,i.x=N?p/(r?1e3:100):0,i.applyEuler(a.rotation),i.add(a.position),a.lookAt(i)}function P(){requestAnimationFrame(P);var e=(new Date).getTime()/1e3,n=e-D;_(n),s.render(n),i.render(n,e),o.render(),D=e,t.update()}var a,f,l,c,h,p=0,d=0,v=Date.now(),m=window.innerWidth/2,g=window.innerHeight/2,y=new e.Vector3,b={},N=!1,M={left:68,right:65,forward:83,backward:87,up:81,down:90,fine:16,que:32},D=(new Date).getTime()/1e3;return{init:T}}),require(["scene"],function(e){$(function(){e.init()})})})();